import{d as G,aa as K,r as d,o as Y,al as Q,ab as g,ac as _,a as f,b as w,e as t,f as s,g as n,u as a,R as W,k as D,h as F,a8 as V,m as P,s as T,am as X,an as Z,A as uu,t as k,ae as eu,af as tu,j as y,q as au,ao as su,C as lu,F as nu,x as ou,y as ru,J as iu,v as O,a5 as du,a6 as J,a3 as U,U as Fu,E as o,a7 as cu,n as Eu,V as pu,_ as Du}from"./index.0ed79651.js";import{c as vu}from"./printElementProvider.9510a282.js";const mu={class:"template-designer"},Bu={class:"warning-banner"},Au={class:"banner-content"},gu={class:"banner-icon"},fu={key:0,class:"banner-status"},Cu={class:"designer-header"},hu={class:"header-content"},_u={class:"header-left"},wu={class:"header-icon"},yu={class:"header-actions"},bu={key:0,class:"status-message error"},Su={key:1,class:"loading-overlay"},xu={class:"designer-container"},Pu={class:"toolbar"},Tu={class:"toolbar-section"},Nu={class:"toolbar-section"},Vu={class:"paper-controls"},ku={class:"designer-workspace"},Ou={class:"elements-panel"},Ju={class:"panel-header"},Uu={class:"panel-title"},Mu={class:"canvas-area"},Lu={class:"canvas-header"},zu={class:"canvas-title"},Ru={class:"canvas-info"},Hu={class:"properties-panel"},$u={class:"panel-header"},Iu={class:"panel-title"},ju={class:"dialog-footer"},qu=G({__name:"TemplateDesigner",setup(Gu){K();const m=d(""),C=d(!0);let B=null,r=d(null);const A=d(!1),S=d(!1),x=d([{label:"A4",value:"A4",width:210,height:297},{label:"A5",value:"A5",width:148,height:210},{label:"B5",value:"B5",width:176,height:250},{label:"\u81EA\u5B9A\u4E49",value:"custom",width:100,height:150}]),b=d("A4"),h=d(!1),c=d({width:100,height:150});function N(e){if(!S.value&&A.value){const u='\u60A8\u6709\u672A\u4FDD\u5B58\u7684\u6A21\u677F\u66F4\u6539\uFF01\u8BF7\u4F7F\u7528\u5DE6\u4FA7\u7684"\u4FDD\u5B58\u5E76\u8FD4\u56DE"\u6216"\u8FD4\u56DE"\u6309\u94AE\uFF0C\u5426\u5219\u6570\u636E\u5C06\u4E22\u5931\u3002';return e.preventDefault(),e.returnValue=u,u}}Y(async()=>{try{C.value=!0,m.value="\u6B63\u5728\u52A0\u8F7D\u6570\u636E...",window.addEventListener("beforeunload",N),await M(),await L(),C.value=!1,m.value=""}catch(e){console.error("\u521D\u59CB\u5316\u5931\u8D25:",e),m.value="\u521D\u59CB\u5316\u5931\u8D25: "+(e.message||String(e)),C.value=!1}}),Q(()=>{window.removeEventListener("beforeunload",N)});async function M(){return new Promise((e,u)=>{try{const E=window.location.hash.split("?")[1]||"",i=new URLSearchParams(E).get("data");if(!i){console.error("URL\u4E2D\u672A\u627E\u5230\u6A21\u677F\u6570\u636E"),u(new Error("URL\u4E2D\u672A\u627E\u5230\u6A21\u677F\u6570\u636E\uFF0C\u8BF7\u8FD4\u56DE\u4E0A\u4E00\u9875\u91CD\u8BD5"));return}try{const v=decodeURIComponent(atob(i));r.value=JSON.parse(v),console.log("\u6210\u529F\u4ECEURL\u89E3\u7801\u6A21\u677F\u6570\u636E"),r.value.fields||(console.warn("\u6A21\u677F\u6570\u636E\u4E2D\u7F3A\u5C11\u5B57\u6BB5\u4FE1\u606F\uFF0C\u4F7F\u7528\u7A7A\u6570\u7EC4"),r.value.fields=[]),r.value.testData||(console.warn("\u6A21\u677F\u6570\u636E\u4E2D\u7F3A\u5C11\u6D4B\u8BD5\u6570\u636E\uFF0C\u4F7F\u7528\u7A7A\u5BF9\u8C61"),r.value.testData={}),e(r.value)}catch(v){console.error("\u89E3\u7801\u6A21\u677F\u6570\u636E\u5931\u8D25:",v),u(new Error("\u89E3\u7801\u6A21\u677F\u6570\u636E\u5931\u8D25: "+(v.message||String(v))))}}catch(l){console.error("\u52A0\u8F7D\u6A21\u677F\u6570\u636E\u5931\u8D25:",l),u(new Error("\u52A0\u8F7D\u6A21\u677F\u6570\u636E\u5931\u8D25: "+(l.message||String(l))))}})}async function L(){try{if(!r.value)throw new Error("\u6A21\u677F\u6570\u636E\u4E0D\u5B58\u5728");g("#provider-container").empty(),g("#hiprint-printTemplate").empty(),_.exports.hiprint.init({providers:[_.exports.defaultElementTypeProvider(),vu(r.value.fields,r.value.testData)()]}),_.exports.hiprint.PrintElementTypeManager.build(g("#provider-container"),"defaultModule"),_.exports.hiprint.PrintElementTypeManager.build(g("#provider-container"),"customModule"),B=new _.exports.hiprint.PrintTemplate({template:r.value.template||{},settingContainer:"#PrintElementOptionSetting",paginationContainer:".hiprint-printPagination",fontList:[{title:"\u5FAE\u8F6F\u96C5\u9ED1",value:"Microsoft YaHei"},{title:"\u9ED1\u4F53",value:"STHeitiSC-Light"},{title:"\u601D\u6E90\u9ED1\u4F53",value:"SourceHanSansCN-Normal"},{title:"\u5B8B\u4F53",value:"SimSun"},{title:"\u534E\u4E3A\u6977\u4F53",value:"STKaiti"}],dataMode:1,history:!0,onDataChanged:(e,u)=>{console.log("\u6A21\u677F\u53D8\u66F4\u7C7B\u578B:",e),console.log("\u6A21\u677F\u6570\u636E:",u),A.value=!0},onUpdateError:e=>{console.error("\u66F4\u65B0\u5931\u8D25:",e)}}),B.design("#hiprint-printTemplate",{grid:!0}),setTimeout(()=>{g(".ep-draggable-item-group").each(function(){const e=g(this).children(".ep-draggable-item");e.length>0&&e.wrapAll('<div class="ep-draggable-item-list"></div>')})},500)}catch(e){throw console.error("\u521D\u59CB\u5316\u6253\u5370\u7EC4\u4EF6\u5931\u8D25:",e),m.value="\u521D\u59CB\u5316\u6253\u5370\u7EC4\u4EF6\u5931\u8D25: "+(e.message||String(e)),e}}function z(){const e=B.getJson();return console.log("\u6A21\u677FJSON:",e),e}function R(e){try{const u=x.value.find(l=>l.value===e);if(!u)return;B.setPaper(e),o.success(`\u5DF2\u8BBE\u7F6E\u7EB8\u5F20\u5927\u5C0F: ${u.label}`)}catch(u){console.error("\u8BBE\u7F6E\u7EB8\u5F20\u5927\u5C0F\u5931\u8D25:",u),o.error("\u8BBE\u7F6E\u7EB8\u5F20\u5927\u5C0F\u5931\u8D25: "+(u.message||String(u)))}}function H(){try{const e=parseFloat(c.value.width.toString()),u=parseFloat(c.value.height.toString());if(isNaN(e)||e<=0||isNaN(u)||u<=0){o.error("\u8BF7\u8F93\u5165\u6709\u6548\u7684\u7EB8\u5F20\u5C3A\u5BF8");return}B.setPaper(e,u),o.success(`\u5DF2\u8BBE\u7F6E\u81EA\u5B9A\u4E49\u7EB8\u5F20\u5927\u5C0F: ${e}mm x ${u}mm`),h.value=!1}catch(e){console.error("\u8BBE\u7F6E\u81EA\u5B9A\u4E49\u7EB8\u5F20\u5931\u8D25:",e),o.error("\u8BBE\u7F6E\u81EA\u5B9A\u4E49\u7EB8\u5F20\u5931\u8D25: "+(e.message||String(e)))}}function $(e){b.value=e,e==="custom"?(c.value={width:100,height:150},h.value=!0):R(e)}function I(){try{S.value=!0,A.value=!1;const e=z(),u=JSON.parse(JSON.stringify(e)),l={type:"TEMPLATE_SAVED",template:u,timestamp:new Date().getTime()};if(window.opener&&!window.opener.closed)try{window.opener.postMessage(l,"*"),console.log("\u6A21\u677F\u6570\u636E\u5DF2\u53D1\u9001\u5230\u7236\u7A97\u53E3"),setTimeout(()=>{window.close()},500),o.success("\u6A21\u677F\u5DF2\u4FDD\u5B58")}catch(E){console.error("\u53D1\u9001\u6570\u636E\u5230\u7236\u7A97\u53E3\u5931\u8D25:",E);const p=JSON.stringify(u),i=document.createElement("textarea");i.value=p,document.body.appendChild(i),i.select();try{document.execCommand("copy"),o({message:"\u65E0\u6CD5\u81EA\u52A8\u53D1\u9001\u6570\u636E\uFF0C\u6A21\u677FJSON\u5DF2\u590D\u5236\u5230\u526A\u8D34\u677F\uFF0C\u8BF7\u5728\u539F\u7A97\u53E3\u4E2D\u7C98\u8D34\u5E76\u5BFC\u5165",duration:0,showClose:!0,type:"warning"})}catch(v){console.error("\u590D\u5236\u5230\u526A\u8D34\u677F\u5931\u8D25:",v),o({message:"\u65E0\u6CD5\u81EA\u52A8\u53D1\u9001\u6570\u636E\uFF0C\u8BF7\u624B\u52A8\u4FDD\u5B58\u6A21\u677FJSON\uFF1A"+p.substring(0,100)+"...",duration:0,showClose:!0,type:"error"})}finally{document.body.removeChild(i)}}else{const E=JSON.stringify(u),p=document.createElement("textarea");p.value=E,document.body.appendChild(p),p.select();try{document.execCommand("copy"),o({message:"\u672A\u68C0\u6D4B\u5230\u7236\u7A97\u53E3\uFF0C\u6A21\u677FJSON\u5DF2\u590D\u5236\u5230\u526A\u8D34\u677F\uFF0C\u8BF7\u5728\u539F\u7A97\u53E3\u4E2D\u7C98\u8D34\u5E76\u5BFC\u5165",duration:0,showClose:!0,type:"warning"})}catch(i){console.error("\u590D\u5236\u5230\u526A\u8D34\u677F\u5931\u8D25:",i),o({message:"\u672A\u68C0\u6D4B\u5230\u7236\u7A97\u53E3\uFF0C\u8BF7\u624B\u52A8\u4FDD\u5B58\u6A21\u677FJSON\uFF1A"+E.substring(0,100)+"...",duration:0,showClose:!0,type:"error"})}finally{document.body.removeChild(p)}}}catch(e){console.error("\u4FDD\u5B58\u6A21\u677F\u5931\u8D25:",e),o.error("\u4FDD\u5B58\u6A21\u677F\u5931\u8D25: "+(e.message||String(e)))}}function j(){const e=A.value?"\u786E\u5B9A\u8981\u8FD4\u56DE\u5417\uFF1F\u60A8\u6709\u672A\u4FDD\u5B58\u7684\u66F4\u6539\u5C06\u4E22\u5931\uFF01":"\u786E\u5B9A\u8981\u8FD4\u56DE\u5417\uFF1F";cu.confirm(e,"\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>{S.value=!0,A.value=!1,window.close()}).catch(()=>{})}function q(){try{const e=r.value.testData||{};B.print(e),o.success("\u6253\u5370\u9884\u89C8\u5DF2\u751F\u6210")}catch(e){console.error("\u6253\u5370\u9884\u89C8\u5931\u8D25:",e),o.error("\u6253\u5370\u9884\u89C8\u5931\u8D25")}}return(e,u)=>(f(),w("div",mu,[t("div",Bu,[t("div",Au,[t("div",gu,[s(a(D),null,{default:n(()=>[s(a(W))]),_:1})]),u[6]||(u[6]=t("div",{class:"banner-text"},[t("strong",null,"\u26A0\uFE0F \u91CD\u8981\u63D0\u793A\uFF1A"),F(' \u8BF7\u52FF\u76F4\u63A5\u5173\u95ED\u6D4F\u89C8\u5668\uFF01\u4F7F\u7528\u5DE6\u4FA7\u7684"\u4FDD\u5B58\u5E76\u8FD4\u56DE"\u6216"\u8FD4\u56DE"\u6309\u94AE\uFF0C\u5426\u5219\u6570\u636E\u5C06\u4E22\u5931\u3002 ')],-1)),A.value?(f(),w("div",fu,[s(a(P),{type:"warning",size:"small"},{default:n(()=>[s(a(D),null,{default:n(()=>[s(a(V))]),_:1}),u[5]||(u[5]=F(" \u6709\u672A\u4FDD\u5B58\u66F4\u6539 "))]),_:1,__:[5]})])):T("",!0)])]),t("div",Cu,[t("div",hu,[t("div",_u,[t("div",wu,[s(a(D),null,{default:n(()=>[s(a(X))]),_:1})]),u[7]||(u[7]=t("div",{class:"header-text"},[t("h1",null,"\u72EC\u7ACB\u6A21\u677F\u8BBE\u8BA1\u5668"),t("p",{class:"header-subtitle"},"\u4E13\u4E1A\u7684\u6253\u5370\u6A21\u677F\u8BBE\u8BA1\u73AF\u5883")],-1))]),t("div",yu,[s(a(P),{type:"success",size:"large",effect:"dark"},{default:n(()=>[s(a(D),null,{default:n(()=>[s(a(Z))]),_:1}),u[8]||(u[8]=F(" \u5168\u5C4F\u8BBE\u8BA1\u6A21\u5F0F "))]),_:1,__:[8]})])])]),m.value?(f(),w("div",bu,[s(a(D),null,{default:n(()=>[s(a(uu))]),_:1}),t("span",null,k(m.value),1)])):T("",!0),C.value?(f(),w("div",Su,u[9]||(u[9]=[t("div",{class:"loading-content"},[t("div",{class:"loading-spinner"}),t("div",{class:"loading-text"},"\u8BBE\u8BA1\u5668\u521D\u59CB\u5316\u4E2D..."),t("div",{class:"loading-subtitle"},"\u6B63\u5728\u52A0\u8F7D\u6A21\u677F\u6570\u636E\u548C\u8BBE\u8BA1\u7EC4\u4EF6")],-1)]))):T("",!0),eu(t("div",xu,[t("div",Pu,[t("div",Tu,[s(a(lu),null,{default:n(()=>[s(a(y),{type:"primary",onClick:I,icon:a(au)},{default:n(()=>u[10]||(u[10]=[F(" \u4FDD\u5B58\u5E76\u8FD4\u56DE ")])),_:1,__:[10]},8,["icon"]),s(a(y),{onClick:j,icon:a(su)},{default:n(()=>u[11]||(u[11]=[F(" \u8FD4\u56DE ")])),_:1,__:[11]},8,["icon"])]),_:1})]),t("div",Nu,[t("div",Vu,[u[12]||(u[12]=t("label",null,"\u7EB8\u5F20\u8BBE\u7F6E\uFF1A",-1)),s(a(ru),{modelValue:b.value,"onUpdate:modelValue":u[0]||(u[0]=l=>b.value=l),placeholder:"\u9009\u62E9\u7EB8\u5F20\u5927\u5C0F",size:"small",onChange:$,style:{width:"120px"}},{default:n(()=>[(f(!0),w(nu,null,ou(x.value,l=>(f(),Eu(a(pu),{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),s(a(y),{type:"success",size:"small",onClick:q,icon:a(iu)},{default:n(()=>u[13]||(u[13]=[F(" \u6253\u5370\u9884\u89C8 ")])),_:1,__:[13]},8,["icon"])])]),t("div",ku,[t("div",Ou,[t("div",Ju,[t("div",Uu,[s(a(D),null,{default:n(()=>[s(a(O))]),_:1}),u[14]||(u[14]=t("span",null,"\u5143\u7D20\u5E93",-1))]),u[15]||(u[15]=t("div",{class:"panel-subtitle"},"\u62D6\u62FD\u5143\u7D20\u5230\u753B\u5E03\u8FDB\u884C\u8BBE\u8BA1",-1))]),u[16]||(u[16]=t("div",{class:"panel-content"},[t("div",{id:"provider-container",class:"provider-container"})],-1))]),t("div",Mu,[t("div",Lu,[t("div",zu,[s(a(D),null,{default:n(()=>[s(a(V))]),_:1}),u[17]||(u[17]=t("span",null,"\u8BBE\u8BA1\u753B\u5E03",-1))]),t("div",Ru,[s(a(P),{size:"small",type:"info"},{default:n(()=>{var l;return[F(" \u5F53\u524D\u7EB8\u5F20: "+k(((l=x.value.find(E=>E.value===b.value))==null?void 0:l.label)||"A4"),1)]}),_:1})])]),u[18]||(u[18]=t("div",{class:"canvas-content"},[t("div",{id:"hiprint-printTemplate",class:"template-container"})],-1)),u[19]||(u[19]=t("div",{class:"pagination-area"},[t("div",{class:"hiprint-printPagination"})],-1))]),t("div",Hu,[t("div",$u,[t("div",Iu,[s(a(D),null,{default:n(()=>[s(a(O))]),_:1}),u[20]||(u[20]=t("span",null,"\u5C5E\u6027\u8BBE\u7F6E",-1))]),u[21]||(u[21]=t("div",{class:"panel-subtitle"},"\u9009\u62E9\u5143\u7D20\u540E\u5728\u6B64\u8BBE\u7F6E\u5C5E\u6027",-1))]),u[22]||(u[22]=t("div",{class:"panel-content"},[t("div",{id:"PrintElementOptionSetting",class:"setting-container"})],-1))])])],512),[[tu,!C.value]]),s(a(Fu),{modelValue:h.value,"onUpdate:modelValue":u[4]||(u[4]=l=>h.value=l),title:"\u81EA\u5B9A\u4E49\u7EB8\u5F20\u5927\u5C0F",width:"400px","close-on-click-modal":!1,"show-close":!0},{footer:n(()=>[t("span",ju,[s(a(y),{onClick:u[3]||(u[3]=l=>h.value=!1)},{default:n(()=>u[23]||(u[23]=[F("\u53D6\u6D88")])),_:1,__:[23]}),s(a(y),{type:"primary",onClick:H},{default:n(()=>u[24]||(u[24]=[F("\u786E\u8BA4")])),_:1,__:[24]})])]),default:n(()=>[s(a(du),{model:c.value,"label-width":"100px"},{default:n(()=>[s(a(J),{label:"\u5BBD\u5EA6 (mm)"},{default:n(()=>[s(a(U),{modelValue:c.value.width,"onUpdate:modelValue":u[1]||(u[1]=l=>c.value.width=l),type:"number",min:"1",placeholder:"\u8BF7\u8F93\u5165\u7EB8\u5F20\u5BBD\u5EA6"},null,8,["modelValue"])]),_:1}),s(a(J),{label:"\u9AD8\u5EA6 (mm)"},{default:n(()=>[s(a(U),{modelValue:c.value.height,"onUpdate:modelValue":u[2]||(u[2]=l=>c.value.height=l),type:"number",min:"1",placeholder:"\u8BF7\u8F93\u5165\u7EB8\u5F20\u9AD8\u5EA6"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])]))}});const Qu=Du(qu,[["__scopeId","data-v-7df5edf4"]]);export{Qu as default};
