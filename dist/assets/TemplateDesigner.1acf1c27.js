import{d as Q,aa as Y,r as F,o as W,am as X,E as r,ac as m,ad as h,a as g,b as _,e as t,f as s,g as n,u as a,Q as Z,k as p,h as i,a8 as k,m as P,s as T,an as uu,ao as eu,A as tu,t as V,af as au,ag as su,j as f,q as lu,ap as nu,C as ou,F as ru,x as iu,y as du,J as Fu,K as cu,v as N,a5 as Eu,a6 as O,a3 as z,U as pu,a7 as Du,n as vu,V as Bu,_ as mu}from"./index.6449b499.js";import{d as gu,b as fu,c as M}from"./windowMessenger.ef61f220.js";const Au={class:"template-designer"},Cu={class:"warning-banner"},hu={class:"banner-content"},_u={class:"banner-icon"},yu={key:0,class:"banner-status"},wu={class:"designer-header"},bu={class:"header-content"},Su={class:"header-left"},Pu={class:"header-icon"},Tu={class:"header-actions"},xu={key:0,class:"status-message error"},ku={key:1,class:"loading-overlay"},Vu={class:"designer-container"},Nu={class:"toolbar"},Ou={class:"toolbar-section"},zu={class:"toolbar-section"},Mu={class:"paper-controls"},Ju={class:"designer-workspace"},Uu={class:"elements-panel"},$u={class:"panel-header"},ju={class:"panel-title"},Lu={class:"canvas-area"},Hu={class:"canvas-header"},Iu={class:"canvas-title"},Ru={class:"canvas-info"},Ku={class:"properties-panel"},qu={class:"panel-header"},Gu={class:"panel-title"},Qu={class:"dialog-footer"},Yu=Q({__name:"TemplateDesigner",setup(Wu){Y();const d=F(""),c=F(!0);let D=null,o=F(null),A=null;const v=F(!1),b=F(!1),S=F([{label:"A4",value:"A4",width:210,height:297},{label:"A5",value:"A5",width:148,height:210},{label:"B5",value:"B5",width:176,height:250},{label:"\u81EA\u5B9A\u4E49",value:"custom",width:100,height:150}]),y=F("A4"),C=F(!1),E=F({width:100,height:150});function x(e){if(!b.value&&v.value){const u='\u60A8\u6709\u672A\u4FDD\u5B58\u7684\u6A21\u677F\u66F4\u6539\uFF01\u8BF7\u4F7F\u7528\u5DE6\u4FA7\u7684"\u4FDD\u5B58\u5E76\u8FD4\u56DE"\u6216"\u8FD4\u56DE"\u6309\u94AE\uFF0C\u5426\u5219\u6570\u636E\u5C06\u4E22\u5931\u3002';return e.preventDefault(),e.returnValue=u,u}}W(async()=>{try{c.value=!0,d.value="\u7B49\u5F85\u63A5\u6536\u6570\u636E...",window.addEventListener("beforeunload",x),A=gu();try{A.initialize(J,{timeout:12e3})}catch(e){console.error("\u521D\u59CB\u5316\u901A\u4FE1\u5931\u8D25:",e),d.value=e.message||"\u8BF7\u4ECE\u4E3B\u9875\u9762\u6253\u5F00\u8BBE\u8BA1\u5668",c.value=!1;return}}catch(e){console.error("\u521D\u59CB\u5316\u5931\u8D25:",e),d.value="\u521D\u59CB\u5316\u5931\u8D25: "+(e.message||String(e)),c.value=!1}}),X(()=>{window.removeEventListener("beforeunload",x),A&&A.destroy()});function J(e){try{console.log("\u63A5\u6536\u5230\u521D\u59CB\u5316\u6A21\u677F\u6570\u636E"),o.value=e,o.value.fields||(console.warn("\u6A21\u677F\u6570\u636E\u4E2D\u7F3A\u5C11\u5B57\u6BB5\u4FE1\u606F\uFF0C\u4F7F\u7528\u7A7A\u6570\u7EC4"),o.value.fields=[]),o.value.testData||(console.warn("\u6A21\u677F\u6570\u636E\u4E2D\u7F3A\u5C11\u6D4B\u8BD5\u6570\u636E\uFF0C\u4F7F\u7528\u7A7A\u5BF9\u8C61"),o.value.testData={}),o.value.recordsData||(console.warn("\u6A21\u677F\u6570\u636E\u4E2D\u7F3A\u5C11\u8BB0\u5F55\u6570\u636E\uFF0C\u4F7F\u7528\u7A7A\u6570\u7EC4"),o.value.recordsData=[]),console.log("\u5B8C\u6574\u6A21\u677F\u6570\u636E\u5DF2\u63A5\u6536:",{fieldsCount:o.value.fields.length,hasTestData:Object.keys(o.value.testData).length>0,recordsCount:o.value.recordsData.length,hasTemplate:!!o.value.template}),d.value="\u6B63\u5728\u521D\u59CB\u5316\u8BBE\u8BA1\u5668...",U().then(()=>{c.value=!1,d.value="",r.success("\u8BBE\u8BA1\u5668\u5DF2\u51C6\u5907\u5C31\u7EEA\uFF0C\u5B8C\u6574\u6570\u636E\u52A0\u8F7D\u6210\u529F")}).catch(u=>{console.error("\u521D\u59CB\u5316\u6253\u5370\u7EC4\u4EF6\u5931\u8D25:",u),d.value="\u521D\u59CB\u5316\u6253\u5370\u7EC4\u4EF6\u5931\u8D25: "+(u.message||String(u)),c.value=!1})}catch(u){console.error("\u5904\u7406\u6570\u636E\u5931\u8D25:",u),r.error("\u5904\u7406\u6570\u636E\u5931\u8D25: "+(u.message||String(u))),c.value=!1}}async function U(){try{if(!o.value)throw new Error("\u6A21\u677F\u6570\u636E\u4E0D\u5B58\u5728");m("#provider-container").empty(),m("#hiprint-printTemplate").empty(),h.exports.hiprint.init({providers:[h.exports.defaultElementTypeProvider(),fu(o.value.fields,o.value.testData)()]}),h.exports.hiprint.PrintElementTypeManager.build(m("#provider-container"),"defaultModule"),h.exports.hiprint.PrintElementTypeManager.build(m("#provider-container"),"customModule"),D=new h.exports.hiprint.PrintTemplate({template:o.value.template||{},settingContainer:"#PrintElementOptionSetting",paginationContainer:".hiprint-printPagination",fontList:[{title:"\u5FAE\u8F6F\u96C5\u9ED1",value:"Microsoft YaHei"},{title:"\u9ED1\u4F53",value:"STHeitiSC-Light"},{title:"\u601D\u6E90\u9ED1\u4F53",value:"SourceHanSansCN-Normal"},{title:"\u5B8B\u4F53",value:"SimSun"},{title:"\u534E\u4E3A\u6977\u4F53",value:"STKaiti"}],dataMode:1,history:!0,onDataChanged:(e,u)=>{console.log("\u6A21\u677F\u53D8\u66F4\u7C7B\u578B:",e),console.log("\u6A21\u677F\u6570\u636E:",u),v.value=!0},onUpdateError:e=>{console.error("\u66F4\u65B0\u5931\u8D25:",e)}}),D.design("#hiprint-printTemplate",{grid:!0}),setTimeout(()=>{m(".ep-draggable-item-group").each(function(){const e=m(this).children(".ep-draggable-item");e.length>0&&e.wrapAll('<div class="ep-draggable-item-list"></div>')})},500)}catch(e){throw console.error("\u521D\u59CB\u5316\u6253\u5370\u7EC4\u4EF6\u5931\u8D25:",e),d.value="\u521D\u59CB\u5316\u6253\u5370\u7EC4\u4EF6\u5931\u8D25: "+(e.message||String(e)),e}}function $(){const e=D.getJson();return console.log("\u6A21\u677FJSON:",e),e}function j(e){try{const u=S.value.find(l=>l.value===e);if(!u)return;D.setPaper(e),r.success(`\u5DF2\u8BBE\u7F6E\u7EB8\u5F20\u5927\u5C0F: ${u.label}`)}catch(u){console.error("\u8BBE\u7F6E\u7EB8\u5F20\u5927\u5C0F\u5931\u8D25:",u),r.error("\u8BBE\u7F6E\u7EB8\u5F20\u5927\u5C0F\u5931\u8D25: "+(u.message||String(u)))}}function L(){try{const e=parseFloat(E.value.width.toString()),u=parseFloat(E.value.height.toString());if(isNaN(e)||e<=0||isNaN(u)||u<=0){r.error("\u8BF7\u8F93\u5165\u6709\u6548\u7684\u7EB8\u5F20\u5C3A\u5BF8");return}D.setPaper(e,u),r.success(`\u5DF2\u8BBE\u7F6E\u81EA\u5B9A\u4E49\u7EB8\u5F20\u5927\u5C0F: ${e}mm x ${u}mm`),C.value=!1}catch(e){console.error("\u8BBE\u7F6E\u81EA\u5B9A\u4E49\u7EB8\u5F20\u5931\u8D25:",e),r.error("\u8BBE\u7F6E\u81EA\u5B9A\u4E49\u7EB8\u5F20\u5931\u8D25: "+(e.message||String(e)))}}function H(e){y.value=e,e==="custom"?(E.value={width:100,height:150},C.value=!0):j(e)}async function I(){try{b.value=!0,v.value=!1;const e=$(),u=JSON.parse(JSON.stringify(e));try{const l=await A.sendDataToParent({template:u});console.log("\u6A21\u677F\u6570\u636E\u53D1\u9001\u7ED3\u679C:",l),r.success("\u6A21\u677F\u5DF2\u4FDD\u5B58"),setTimeout(()=>{window.close()},500)}catch(l){console.error("\u53D1\u9001\u6570\u636E\u5230\u7236\u7A97\u53E3\u5931\u8D25:",l);const B=JSON.stringify(u),w=document.createElement("textarea");w.value=B,document.body.appendChild(w),w.select();try{document.execCommand("copy"),r({message:"\u65E0\u6CD5\u81EA\u52A8\u53D1\u9001\u6570\u636E\uFF0C\u6A21\u677FJSON\u5DF2\u590D\u5236\u5230\u526A\u8D34\u677F\uFF0C\u8BF7\u5728\u539F\u7A97\u53E3\u4E2D\u7C98\u8D34\u5E76\u5BFC\u5165",duration:0,showClose:!0,type:"warning"})}catch(G){console.error("\u590D\u5236\u5230\u526A\u8D34\u677F\u5931\u8D25:",G),r({message:"\u65E0\u6CD5\u81EA\u52A8\u53D1\u9001\u6570\u636E\uFF0C\u8BF7\u624B\u52A8\u4FDD\u5B58\u6A21\u677FJSON\uFF1A"+B.substring(0,100)+"...",duration:0,showClose:!0,type:"error"})}finally{document.body.removeChild(w)}}}catch(e){console.error("\u4FDD\u5B58\u6A21\u677F\u5931\u8D25:",e),r.error("\u4FDD\u5B58\u6A21\u677F\u5931\u8D25: "+(e.message||String(e)))}}function R(){const e=v.value?"\u786E\u5B9A\u8981\u8FD4\u56DE\u5417\uFF1F\u60A8\u6709\u672A\u4FDD\u5B58\u7684\u66F4\u6539\u5C06\u4E22\u5931\uFF01":"\u786E\u5B9A\u8981\u8FD4\u56DE\u5417\uFF1F";Du.confirm(e,"\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>{b.value=!0,v.value=!1,window.close()}).catch(()=>{})}function K(){try{const e=M(!0),u=e.prepareSinglePrintData(o.value,{includeTableData:!0,preferTestData:!0}),l=e.validatePrintData(u);if(!l.isValid){console.error("\u6253\u5370\u6570\u636E\u9A8C\u8BC1\u5931\u8D25:",l.errors),r.error("\u6253\u5370\u6570\u636E\u65E0\u6548: "+l.errors.join(", "));return}l.warnings.length>0&&console.warn("\u6253\u5370\u6570\u636E\u8B66\u544A:",l.warnings),console.log("\u51C6\u5907\u7684\u6253\u5370\u6570\u636E:",u),console.log("\u6570\u636E\u9A8C\u8BC1\u7ED3\u679C:",l),D.print(u),r.success("\u6253\u5370\u9884\u89C8\u5DF2\u751F\u6210\uFF0C\u4F7F\u7528\u4E86\u771F\u5B9E\u7684\u8868\u683C\u6570\u636E")}catch(e){console.error("\u6253\u5370\u9884\u89C8\u5931\u8D25:",e),r.error("\u6253\u5370\u9884\u89C8\u5931\u8D25: "+(e.message||String(e)))}}function q(){try{const e=M(!0),u=e.prepareSinglePrintData(o.value,{includeTableData:!0,preferTestData:!0}),l=e.validatePrintData(u);if(!l.isValid){console.error("\u6253\u5370\u6570\u636E\u9A8C\u8BC1\u5931\u8D25:",l.errors),r.error("\u6253\u5370\u6570\u636E\u65E0\u6548: "+l.errors.join(", "));return}console.log("\u51C6\u5907\u7684PDF\u5BFC\u51FA\u6570\u636E:",u);const B=`\u6A21\u677F\u9884\u89C8_${new Date().toISOString().split("T")[0]}.pdf`;D.toPdf(u,B),r.success("PDF\u5BFC\u51FA\u6210\u529F\uFF0C\u4F7F\u7528\u4E86\u771F\u5B9E\u7684\u8868\u683C\u6570\u636E")}catch(e){console.error("\u5BFC\u51FAPDF\u5931\u8D25:",e),r.error("\u5BFC\u51FAPDF\u5931\u8D25: "+(e.message||String(e)))}}return(e,u)=>(g(),_("div",Au,[t("div",Cu,[t("div",hu,[t("div",_u,[s(a(p),null,{default:n(()=>[s(a(Z))]),_:1})]),u[6]||(u[6]=t("div",{class:"banner-text"},[t("strong",null,"\u26A0\uFE0F \u91CD\u8981\u63D0\u793A\uFF1A"),i(' \u8BF7\u52FF\u76F4\u63A5\u5173\u95ED\u6D4F\u89C8\u5668\uFF01\u4F7F\u7528\u5DE6\u4FA7\u7684"\u4FDD\u5B58\u5E76\u8FD4\u56DE"\u6216"\u8FD4\u56DE"\u6309\u94AE\uFF0C\u5426\u5219\u6570\u636E\u5C06\u4E22\u5931\u3002 ')],-1)),v.value?(g(),_("div",yu,[s(a(P),{type:"warning",size:"small"},{default:n(()=>[s(a(p),null,{default:n(()=>[s(a(k))]),_:1}),u[5]||(u[5]=i(" \u6709\u672A\u4FDD\u5B58\u66F4\u6539 "))]),_:1,__:[5]})])):T("",!0)])]),t("div",wu,[t("div",bu,[t("div",Su,[t("div",Pu,[s(a(p),null,{default:n(()=>[s(a(uu))]),_:1})]),u[7]||(u[7]=t("div",{class:"header-text"},[t("h1",null,"\u72EC\u7ACB\u6A21\u677F\u8BBE\u8BA1\u5668"),t("p",{class:"header-subtitle"},"\u4E13\u4E1A\u7684\u6253\u5370\u6A21\u677F\u8BBE\u8BA1\u73AF\u5883")],-1))]),t("div",Tu,[s(a(P),{type:"success",size:"large",effect:"dark"},{default:n(()=>[s(a(p),null,{default:n(()=>[s(a(eu))]),_:1}),u[8]||(u[8]=i(" \u5168\u5C4F\u8BBE\u8BA1\u6A21\u5F0F "))]),_:1,__:[8]})])])]),d.value?(g(),_("div",xu,[s(a(p),null,{default:n(()=>[s(a(tu))]),_:1}),t("span",null,V(d.value),1)])):T("",!0),c.value?(g(),_("div",ku,u[9]||(u[9]=[t("div",{class:"loading-content"},[t("div",{class:"loading-spinner"}),t("div",{class:"loading-text"},"\u8BBE\u8BA1\u5668\u521D\u59CB\u5316\u4E2D..."),t("div",{class:"loading-subtitle"},"\u6B63\u5728\u52A0\u8F7D\u6A21\u677F\u6570\u636E\u548C\u8BBE\u8BA1\u7EC4\u4EF6")],-1)]))):T("",!0),au(t("div",Vu,[t("div",Nu,[t("div",Ou,[s(a(ou),null,{default:n(()=>[s(a(f),{type:"primary",onClick:I,icon:a(lu)},{default:n(()=>u[10]||(u[10]=[i(" \u4FDD\u5B58\u5E76\u8FD4\u56DE ")])),_:1,__:[10]},8,["icon"]),s(a(f),{onClick:R,icon:a(nu)},{default:n(()=>u[11]||(u[11]=[i(" \u8FD4\u56DE ")])),_:1,__:[11]},8,["icon"])]),_:1})]),t("div",zu,[t("div",Mu,[u[12]||(u[12]=t("label",null,"\u7EB8\u5F20\u8BBE\u7F6E\uFF1A",-1)),s(a(du),{modelValue:y.value,"onUpdate:modelValue":u[0]||(u[0]=l=>y.value=l),placeholder:"\u9009\u62E9\u7EB8\u5F20\u5927\u5C0F",size:"small",onChange:H,style:{width:"120px"}},{default:n(()=>[(g(!0),_(ru,null,iu(S.value,l=>(g(),vu(a(Bu),{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),s(a(f),{type:"success",size:"small",onClick:K,icon:a(Fu)},{default:n(()=>u[13]||(u[13]=[i(" \u6253\u5370\u9884\u89C8 ")])),_:1,__:[13]},8,["icon"]),s(a(f),{type:"primary",size:"small",onClick:q,icon:a(cu)},{default:n(()=>u[14]||(u[14]=[i(" \u5BFC\u51FAPDF ")])),_:1,__:[14]},8,["icon"])])]),t("div",Ju,[t("div",Uu,[t("div",$u,[t("div",ju,[s(a(p),null,{default:n(()=>[s(a(N))]),_:1}),u[15]||(u[15]=t("span",null,"\u5143\u7D20\u5E93",-1))]),u[16]||(u[16]=t("div",{class:"panel-subtitle"},"\u62D6\u62FD\u5143\u7D20\u5230\u753B\u5E03\u8FDB\u884C\u8BBE\u8BA1",-1))]),u[17]||(u[17]=t("div",{class:"panel-content"},[t("div",{id:"provider-container",class:"provider-container"})],-1))]),t("div",Lu,[t("div",Hu,[t("div",Iu,[s(a(p),null,{default:n(()=>[s(a(k))]),_:1}),u[18]||(u[18]=t("span",null,"\u8BBE\u8BA1\u753B\u5E03",-1))]),t("div",Ru,[s(a(P),{size:"small",type:"info"},{default:n(()=>{var l;return[i(" \u5F53\u524D\u7EB8\u5F20: "+V(((l=S.value.find(B=>B.value===y.value))==null?void 0:l.label)||"A4"),1)]}),_:1})])]),u[19]||(u[19]=t("div",{class:"canvas-content"},[t("div",{id:"hiprint-printTemplate",class:"template-container"})],-1)),u[20]||(u[20]=t("div",{class:"pagination-area"},[t("div",{class:"hiprint-printPagination"})],-1))]),t("div",Ku,[t("div",qu,[t("div",Gu,[s(a(p),null,{default:n(()=>[s(a(N))]),_:1}),u[21]||(u[21]=t("span",null,"\u5C5E\u6027\u8BBE\u7F6E",-1))]),u[22]||(u[22]=t("div",{class:"panel-subtitle"},"\u9009\u62E9\u5143\u7D20\u540E\u5728\u6B64\u8BBE\u7F6E\u5C5E\u6027",-1))]),u[23]||(u[23]=t("div",{class:"panel-content"},[t("div",{id:"PrintElementOptionSetting",class:"setting-container"})],-1))])])],512),[[su,!c.value]]),s(a(pu),{modelValue:C.value,"onUpdate:modelValue":u[4]||(u[4]=l=>C.value=l),title:"\u81EA\u5B9A\u4E49\u7EB8\u5F20\u5927\u5C0F",width:"400px","close-on-click-modal":!1,"show-close":!0},{footer:n(()=>[t("span",Qu,[s(a(f),{onClick:u[3]||(u[3]=l=>C.value=!1)},{default:n(()=>u[24]||(u[24]=[i("\u53D6\u6D88")])),_:1,__:[24]}),s(a(f),{type:"primary",onClick:L},{default:n(()=>u[25]||(u[25]=[i("\u786E\u8BA4")])),_:1,__:[25]})])]),default:n(()=>[s(a(Eu),{model:E.value,"label-width":"100px"},{default:n(()=>[s(a(O),{label:"\u5BBD\u5EA6 (mm)"},{default:n(()=>[s(a(z),{modelValue:E.value.width,"onUpdate:modelValue":u[1]||(u[1]=l=>E.value.width=l),type:"number",min:"1",placeholder:"\u8BF7\u8F93\u5165\u7EB8\u5F20\u5BBD\u5EA6"},null,8,["modelValue"])]),_:1}),s(a(O),{label:"\u9AD8\u5EA6 (mm)"},{default:n(()=>[s(a(z),{modelValue:E.value.height,"onUpdate:modelValue":u[2]||(u[2]=l=>E.value.height=l),type:"number",min:"1",placeholder:"\u8BF7\u8F93\u5165\u7EB8\u5F20\u9AD8\u5EA6"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])]))}});const ue=mu(Yu,[["__scopeId","data-v-ec56d7a2"]]);export{ue as default};
