import{d as U,K as z,r as F,o as H,L as v,M as B,f as h,g as y,t as R,q as _,h as p,G as I,N as $,i as r,j as n,m as C,u as a,n as f,F as j,k as q,l as K,T as G,H as Y,I as x,D as b,y as Q,E as o,J as W,z as X,A as Z,_ as uu}from"./index.2a2c50c9.js";import{c as eu}from"./printElementProvider.242eb2b9.js";const tu={class:"template-designer"},au={key:0,class:"message"},ou={key:1,class:"loading-overlay"},ru={class:"designer-container"},lu={class:"designer-header"},nu={class:"designer-actions"},su={class:"dialog-footer"},iu=U({__name:"TemplateDesigner",setup(du){z();const E=F(""),g=F(!0);let m=null,l=F(null);const S=F([{label:"A4",value:"A4",width:210,height:297},{label:"A5",value:"A5",width:148,height:210},{label:"B5",value:"B5",width:176,height:250},{label:"\u81EA\u5B9A\u4E49",value:"custom",width:100,height:150}]),w=F("A4"),A=F(!1),i=F({width:100,height:150});H(async()=>{try{g.value=!0,E.value="\u6B63\u5728\u52A0\u8F7D\u6570\u636E...",await T(),await P(),g.value=!1,E.value=""}catch(e){console.error("\u521D\u59CB\u5316\u5931\u8D25:",e),E.value="\u521D\u59CB\u5316\u5931\u8D25: "+(e.message||String(e)),g.value=!1}});async function T(){return new Promise((e,u)=>{try{const D=window.location.hash.split("?")[1]||"",s=new URLSearchParams(D).get("data");if(!s){console.error("URL\u4E2D\u672A\u627E\u5230\u6A21\u677F\u6570\u636E"),u(new Error("URL\u4E2D\u672A\u627E\u5230\u6A21\u677F\u6570\u636E\uFF0C\u8BF7\u8FD4\u56DE\u4E0A\u4E00\u9875\u91CD\u8BD5"));return}try{const c=decodeURIComponent(atob(s));l.value=JSON.parse(c),console.log("\u6210\u529F\u4ECEURL\u89E3\u7801\u6A21\u677F\u6570\u636E"),l.value.fields||(console.warn("\u6A21\u677F\u6570\u636E\u4E2D\u7F3A\u5C11\u5B57\u6BB5\u4FE1\u606F\uFF0C\u4F7F\u7528\u7A7A\u6570\u7EC4"),l.value.fields=[]),l.value.testData||(console.warn("\u6A21\u677F\u6570\u636E\u4E2D\u7F3A\u5C11\u6D4B\u8BD5\u6570\u636E\uFF0C\u4F7F\u7528\u7A7A\u5BF9\u8C61"),l.value.testData={}),e(l.value)}catch(c){console.error("\u89E3\u7801\u6A21\u677F\u6570\u636E\u5931\u8D25:",c),u(new Error("\u89E3\u7801\u6A21\u677F\u6570\u636E\u5931\u8D25: "+(c.message||String(c))))}}catch(t){console.error("\u52A0\u8F7D\u6A21\u677F\u6570\u636E\u5931\u8D25:",t),u(new Error("\u52A0\u8F7D\u6A21\u677F\u6570\u636E\u5931\u8D25: "+(t.message||String(t))))}})}async function P(){try{if(!l.value)throw new Error("\u6A21\u677F\u6570\u636E\u4E0D\u5B58\u5728");v("#provider-container").empty(),v("#hiprint-printTemplate").empty(),B.exports.hiprint.init({providers:[B.exports.defaultElementTypeProvider(),eu(l.value.fields,l.value.testData)()]}),B.exports.hiprint.PrintElementTypeManager.build(v("#provider-container"),"defaultModule"),B.exports.hiprint.PrintElementTypeManager.build(v("#provider-container"),"customModule"),m=new B.exports.hiprint.PrintTemplate({template:l.value.template||{},settingContainer:"#PrintElementOptionSetting",paginationContainer:".hiprint-printPagination",fontList:[{title:"\u5FAE\u8F6F\u96C5\u9ED1",value:"Microsoft YaHei"},{title:"\u9ED1\u4F53",value:"STHeitiSC-Light"},{title:"\u601D\u6E90\u9ED1\u4F53",value:"SourceHanSansCN-Normal"},{title:"\u5B8B\u4F53",value:"SimSun"},{title:"\u534E\u4E3A\u6977\u4F53",value:"STKaiti"}],dataMode:1,history:!0,onDataChanged:(e,u)=>{console.log("\u6A21\u677F\u53D8\u66F4\u7C7B\u578B:",e),console.log("\u6A21\u677F\u6570\u636E:",u)},onUpdateError:e=>{console.error("\u66F4\u65B0\u5931\u8D25:",e)}}),m.design("#hiprint-printTemplate",{grid:!0}),setTimeout(()=>{v(".ep-draggable-item-group").each(function(){const e=v(this).children(".ep-draggable-item");e.length>0&&e.wrapAll('<div class="ep-draggable-item-list"></div>')})},500)}catch(e){throw console.error("\u521D\u59CB\u5316\u6253\u5370\u7EC4\u4EF6\u5931\u8D25:",e),E.value="\u521D\u59CB\u5316\u6253\u5370\u7EC4\u4EF6\u5931\u8D25: "+(e.message||String(e)),e}}function N(){const e=m.getJson();return console.log("\u6A21\u677FJSON:",e),e}function V(e){try{const u=S.value.find(t=>t.value===e);if(!u)return;m.setPaper(e),o.success(`\u5DF2\u8BBE\u7F6E\u7EB8\u5F20\u5927\u5C0F: ${u.label}`)}catch(u){console.error("\u8BBE\u7F6E\u7EB8\u5F20\u5927\u5C0F\u5931\u8D25:",u),o.error("\u8BBE\u7F6E\u7EB8\u5F20\u5927\u5C0F\u5931\u8D25: "+(u.message||String(u)))}}function O(){try{const e=parseFloat(i.value.width.toString()),u=parseFloat(i.value.height.toString());if(isNaN(e)||e<=0||isNaN(u)||u<=0){o.error("\u8BF7\u8F93\u5165\u6709\u6548\u7684\u7EB8\u5F20\u5C3A\u5BF8");return}m.setPaper(e,u),o.success(`\u5DF2\u8BBE\u7F6E\u81EA\u5B9A\u4E49\u7EB8\u5F20\u5927\u5C0F: ${e}mm x ${u}mm`),A.value=!1}catch(e){console.error("\u8BBE\u7F6E\u81EA\u5B9A\u4E49\u7EB8\u5F20\u5931\u8D25:",e),o.error("\u8BBE\u7F6E\u81EA\u5B9A\u4E49\u7EB8\u5F20\u5931\u8D25: "+(e.message||String(e)))}}function k(e){w.value=e,e==="custom"?(i.value={width:100,height:150},A.value=!0):V(e)}function J(){try{const e=N(),u=JSON.parse(JSON.stringify(e)),t={type:"TEMPLATE_SAVED",template:u,timestamp:new Date().getTime()};if(window.opener&&!window.opener.closed)try{window.opener.postMessage(t,"*"),console.log("\u6A21\u677F\u6570\u636E\u5DF2\u53D1\u9001\u5230\u7236\u7A97\u53E3"),setTimeout(()=>{window.close()},500),o.success("\u6A21\u677F\u5DF2\u4FDD\u5B58")}catch(D){console.error("\u53D1\u9001\u6570\u636E\u5230\u7236\u7A97\u53E3\u5931\u8D25:",D);const d=JSON.stringify(u),s=document.createElement("textarea");s.value=d,document.body.appendChild(s),s.select();try{document.execCommand("copy"),o({message:"\u65E0\u6CD5\u81EA\u52A8\u53D1\u9001\u6570\u636E\uFF0C\u6A21\u677FJSON\u5DF2\u590D\u5236\u5230\u526A\u8D34\u677F\uFF0C\u8BF7\u5728\u539F\u7A97\u53E3\u4E2D\u7C98\u8D34\u5E76\u5BFC\u5165",duration:0,showClose:!0,type:"warning"})}catch(c){console.error("\u590D\u5236\u5230\u526A\u8D34\u677F\u5931\u8D25:",c),o({message:"\u65E0\u6CD5\u81EA\u52A8\u53D1\u9001\u6570\u636E\uFF0C\u8BF7\u624B\u52A8\u4FDD\u5B58\u6A21\u677FJSON\uFF1A"+d.substring(0,100)+"...",duration:0,showClose:!0,type:"error"})}finally{document.body.removeChild(s)}}else{const D=JSON.stringify(u),d=document.createElement("textarea");d.value=D,document.body.appendChild(d),d.select();try{document.execCommand("copy"),o({message:"\u672A\u68C0\u6D4B\u5230\u7236\u7A97\u53E3\uFF0C\u6A21\u677FJSON\u5DF2\u590D\u5236\u5230\u526A\u8D34\u677F\uFF0C\u8BF7\u5728\u539F\u7A97\u53E3\u4E2D\u7C98\u8D34\u5E76\u5BFC\u5165",duration:0,showClose:!0,type:"warning"})}catch(s){console.error("\u590D\u5236\u5230\u526A\u8D34\u677F\u5931\u8D25:",s),o({message:"\u672A\u68C0\u6D4B\u5230\u7236\u7A97\u53E3\uFF0C\u8BF7\u624B\u52A8\u4FDD\u5B58\u6A21\u677FJSON\uFF1A"+D.substring(0,100)+"...",duration:0,showClose:!0,type:"error"})}finally{document.body.removeChild(d)}}}catch(e){console.error("\u4FDD\u5B58\u6A21\u677F\u5931\u8D25:",e),o.error("\u4FDD\u5B58\u6A21\u677F\u5931\u8D25: "+(e.message||String(e)))}}function M(){W.confirm("\u786E\u5B9A\u8981\u8FD4\u56DE\u5417\uFF1F\u672A\u4FDD\u5B58\u7684\u66F4\u6539\u5C06\u4E22\u5931","\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>{window.close()}).catch(()=>{})}function L(){try{const e=l.value.testData||{};m.print(e),o.success("\u6253\u5370\u9884\u89C8\u5DF2\u751F\u6210")}catch(e){console.error("\u6253\u5370\u9884\u89C8\u5931\u8D25:",e),o.error("\u6253\u5370\u9884\u89C8\u5931\u8D25")}}return(e,u)=>(h(),y("div",tu,[E.value?(h(),y("div",au,R(E.value),1)):_("",!0),g.value?(h(),y("div",ou,u[5]||(u[5]=[p("div",{class:"loading-spinner"},null,-1),p("div",{class:"loading-text"},"\u52A0\u8F7D\u4E2D...",-1)]))):_("",!0),I(p("div",ru,[p("div",lu,[u[9]||(u[9]=p("div",{class:"designer-title"},"\u72EC\u7ACB\u6A21\u677F\u8BBE\u8BA1\u5668",-1)),p("div",nu,[r(a(f),{type:"primary",onClick:J},{default:n(()=>u[6]||(u[6]=[C("\u4FDD\u5B58\u6A21\u677F\u5E76\u8FD4\u56DE")])),_:1,__:[6]}),r(a(f),{onClick:M},{default:n(()=>u[7]||(u[7]=[C("\u8FD4\u56DE")])),_:1,__:[7]}),r(a(K),{modelValue:w.value,"onUpdate:modelValue":u[0]||(u[0]=t=>w.value=t),placeholder:"\u9009\u62E9\u7EB8\u5F20\u5927\u5C0F",size:"small",onChange:k,style:{width:"120px","margin-right":"10px"}},{default:n(()=>[(h(!0),y(j,null,q(S.value,t=>(h(),X(a(Z),{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),r(a(f),{type:"success",size:"small",onClick:L},{default:n(()=>u[8]||(u[8]=[C("\u6253\u5370\u9884\u89C8")])),_:1,__:[8]})])]),u[10]||(u[10]=G('<div class="designer-content" data-v-50029744><div id="provider-container" class="provider-container" data-v-50029744></div><div class="template-wrapper" data-v-50029744><div id="hiprint-printTemplate" class="template-container" data-v-50029744></div></div><div id="PrintElementOptionSetting" class="setting-container" data-v-50029744></div></div><div class="hiprint-printPagination" data-v-50029744></div>',2))],512),[[$,!g.value]]),r(a(Q),{modelValue:A.value,"onUpdate:modelValue":u[4]||(u[4]=t=>A.value=t),title:"\u81EA\u5B9A\u4E49\u7EB8\u5F20\u5927\u5C0F",width:"400px","close-on-click-modal":!1,"show-close":!0},{footer:n(()=>[p("span",su,[r(a(f),{onClick:u[3]||(u[3]=t=>A.value=!1)},{default:n(()=>u[11]||(u[11]=[C("\u53D6\u6D88")])),_:1,__:[11]}),r(a(f),{type:"primary",onClick:O},{default:n(()=>u[12]||(u[12]=[C("\u786E\u8BA4")])),_:1,__:[12]})])]),default:n(()=>[r(a(Y),{model:i.value,"label-width":"100px"},{default:n(()=>[r(a(x),{label:"\u5BBD\u5EA6 (mm)"},{default:n(()=>[r(a(b),{modelValue:i.value.width,"onUpdate:modelValue":u[1]||(u[1]=t=>i.value.width=t),type:"number",min:"1",placeholder:"\u8BF7\u8F93\u5165\u7EB8\u5F20\u5BBD\u5EA6"},null,8,["modelValue"])]),_:1}),r(a(x),{label:"\u9AD8\u5EA6 (mm)"},{default:n(()=>[r(a(b),{modelValue:i.value.height,"onUpdate:modelValue":u[2]||(u[2]=t=>i.value.height=t),type:"number",min:"1",placeholder:"\u8BF7\u8F93\u5165\u7EB8\u5F20\u9AD8\u5EA6"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])]))}});const pu=uu(iu,[["__scopeId","data-v-50029744"]]);export{pu as default};
