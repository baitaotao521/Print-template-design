import{p as Q,d as Ke,r as D,c as be,w as Le,o as Ve,E as i,a as w,b as S,e as a,f as l,g as s,h as A,u as e,i as De,j as k,k as _,l as Be,t as L,m as Se,n as ae,q as uu,s as G,v as ge,F as ie,x as de,y as Te,z as du,A as Bu,B as Eu,C as cu,D as Fe,G as pu,H as Du,I as Au,J as pe,K as Ae,L as Ee,M as We,N as wu,O as hu,P as tu,Q as Fu,R as Xe,S as Ye,T as yu,U as Qe,V as $e,_ as xe,W as je,X as fu,Y as vu,Z as Ue,$ as Cu,a0 as mu,a1 as _u,a2 as Me,a3 as fe,a4 as au,a5 as gu,a6 as ke,a7 as He,a8 as re,a9 as bu,aa as Su,ab as ee,ac as oe,ad as Tu,ae as lu,af as su,ag as $u,ah as nu,ai as ku,aj as Iu,ak as ou}from"./index.0ed79651.js";import{c as Vu}from"./printElementProvider.9510a282.js";async function Ze(F,v){try{const p=await Q.base.getTableById(F),g=await(await p.getViewById(v)).getVisibleFieldIdList();return await Promise.all(g.map(async m=>{const B=await p.getFieldById(m);return{id:m,name:await B.getName(),type:B.type}}))}catch(p){throw console.error("\u83B7\u53D6\u5B57\u6BB5\u4FE1\u606F\u65F6\u51FA\u9519:",p),p}}const me=F=>{if(Array.isArray(F)&&F.length>0){const v=F[0];if(!v||typeof v!="object")return v;if(v.type&&v.type.includes("image"))return v.token;if("id"in v||v.type==="text")return v.text}return F},ru=(F,v)=>{if(F===null)return"\u7A7A";switch(v){case 1:return me(F);case 2:return F;case 3:return F.text;case 4:return F.text;case 5:return new Date(F).toLocaleString();case 7:return F;case 11:return F;case 13:return F;case 15:return F;case 17:return me(F);case 18:return F.text;case 19:return me(F);case 20:return me(F);case 21:return F;case 22:return F;case 23:return F;case 1001:return new Date(F).toLocaleString();case 1002:return new Date(F).toLocaleString();case 1003:return F.map(p=>p.name).join(",");case 1004:return F.map(p=>p.name).join(",");case 1005:return F&&F.status==="completed"?F.value:F;case 99001:return me(F);case 99002:return F;case 99003:return F;case 99004:return F;case 99005:return F;default:return F}};async function Ge(F,v=3,p=1e3){try{return await F()}catch(y){if(v===0)throw y;return await new Promise(g=>setTimeout(g,p)),Ge(F,v-1,p)}}async function Ie(F,v,p=null,y=!1,g=null){try{const E=await Q.base.getTableById(F),B=await(await E.getViewById(v)).getVisibleFieldIdList(),N=await Promise.all(B.map(async P=>{const $=await E.getFieldById(P);return{id:P,name:await $.getName(),type:$.type}}));if(p){const P=[];for(const h of N)try{const T=await E.getFieldById(h.id),M=await Ge(async()=>{try{return await T.getValue(p)}catch(X){throw console.warn(`\u83B7\u53D6\u5B57\u6BB5 ${h.id} \u7684\u503C\u5931\u8D25\uFF0C\u6B63\u5728\u91CD\u8BD5...`,X),X}}),W=y?ru(M,h.type):null;P.push({name:h.name,value:y?W:M,type:h.type,field:h.id})}catch(T){console.warn(`\u83B7\u53D6\u5B57\u6BB5 ${h.id} \u7684\u503C\u5931\u8D25:`,T),P.push({name:h.name,value:null,type:h.type,field:h.id})}const $=[{recordId:p,field:P}];return g&&typeof g=="function"&&g($),$}const C=[];let I=null,z=!0,J=0;for(;z;){J++;const P=await E.getRecords({pageSize:200,pageToken:I,viewId:v}),{records:$,pageToken:h}=P,T=$.map(async X=>{try{const U=[];for(const j of N)try{const ue=await E.getFieldById(j.id),H=await Ge(async()=>{try{return await ue.getValue(X.recordId)}catch(o){throw console.warn(`\u83B7\u53D6\u5B57\u6BB5 ${j.id} \u7684\u503C\u5931\u8D25\uFF0C\u6B63\u5728\u91CD\u8BD5...`,o),o}}),c=y?ru(H,j.type):null;U.push({name:j.name,value:y?c:H,type:j.type,field:j.id})}catch(ue){console.warn(`\u83B7\u53D6\u5B57\u6BB5 ${j.id} \u7684\u503C\u5931\u8D25:`,ue),U.push({name:j.name,value:null,type:j.type,field:j.id})}return{recordId:X.recordId,field:U}}catch(U){return console.warn("\u5904\u7406\u8BB0\u5F55\u65F6\u51FA\u9519:",U),null}}),W=(await Promise.all(T)).filter(Boolean);C.push(...W),g&&typeof g=="function"&&g(C.slice(),J,!h),z=!!h,I=h}return C}catch(E){throw console.error("\u83B7\u53D6\u8BB0\u5F55\u548C\u5B57\u6BB5\u503C\u65F6\u51FA\u9519:",E),E}}async function xu(F){try{return(await(await Q.base.getTableById(F)).getFieldMetaList()).filter(g=>g.type===17)}catch(v){throw console.error("\u83B7\u53D6\u9644\u4EF6\u5B57\u6BB5\u5931\u8D25:",v),v}}async function Pu(F,v=1){try{if(!window.pdfjsLib)throw new Error("PDF.js \u5E93\u672A\u52A0\u8F7D");const p=await F.arrayBuffer(),g=await window.pdfjsLib.getDocument({data:p}).promise;if(v<1||v>g.numPages)throw new Error(`\u65E0\u6548\u7684\u9875\u7801: ${v}\uFF0C\u6587\u6863\u5171\u6709 ${g.numPages} \u9875`);const E=await g.getPage(v),m=window.devicePixelRatio||2,B=E.getViewport({scale:m}),N=document.createElement("canvas"),C=N.getContext("2d");N.width=B.width,N.height=B.height;const I={canvasContext:C,viewport:B};return await E.render(I).promise,new Promise((z,J)=>{try{N.toBlob(P=>{P?z(P):J(new Error("\u8F6C\u6362\u4E3ABlob\u5931\u8D25"))},"image/jpeg",1)}catch(P){J(P)}})}catch(p){throw console.error("PDF\u8F6C\u56FE\u7247\u5931\u8D25:",p),p}}async function Ou(F,v,p=1){try{const y=await Pu(F,p);return new File([y],`${v}.jpg`,{type:"image/jpeg"})}catch(y){throw console.error("PDF\u8F6C\u56FE\u7247\u6587\u4EF6\u5931\u8D25:",y),y}}const Nu={class:"print-data-selector"},Ju={class:"toolbar"},zu={class:"toolbar-section"},Ru={key:0,class:"data-stats"},Lu={class:"field-selection-card"},ju={class:"card-header"},Uu={key:0,class:"data-preview-card"},Mu={class:"card-header"},Hu={class:"selection-controls"},Gu={class:"data-table-wrapper"},qu={class:"field-value"},Ku={class:"pagination-container"},Wu={class:"action-buttons-card"},Xu={class:"card-header"},Yu={class:"button-grid"},Qu={key:1,class:"empty-state"},Zu={key:0,class:"export-dialog-content"},et={class:"field-selection-section"},ut={class:"section-header"},tt={class:"format-selection-section"},at={class:"section-header"},lt={class:"tips-section"},st={class:"tip-item"},nt={class:"tip-item"},ot={key:1,class:"export-progress-container"},rt={class:"progress-header"},it={class:"progress-info"},dt={class:"progress-text"},ct={class:"progress-percentage"},pt={class:"dialog-footer"},Re=200,Ft=Ke({__name:"PrintDataSelector",props:{hiprintTemplate:{},initialFields:{},initialRecords:{}},emits:["print"],setup(F,{emit:v}){const p=F,y=v,g=D([]),E=D([]),m=D([]),B=D([]),N=D(!1),C=D(null),I=D(1),z=D(20),J=be(()=>{const r=(I.value-1)*z.value;return m.value.slice(r,r+z.value)}),P=be(()=>E.value.length===0?g.value.slice(0,4):g.value.filter(r=>E.value.includes(r.id)));Le(()=>p.initialFields,r=>{r&&r.length>0&&(g.value=r,E.value=r.slice(0,4).map(n=>n.id))},{immediate:!0}),Le(()=>p.initialRecords,r=>{r&&r.length>0&&(m.value=r)},{immediate:!0}),Ve(async()=>{(!p.initialFields||p.initialFields.length===0)&&await h()});function $(r){return r==null?"":Array.isArray(r)?r.join(", "):typeof r=="object"?JSON.stringify(r):String(r)}async function h(){try{const r=await Q.base.getActiveTable(),n=await r.getActiveView(),f=r.id,t=n.id;g.value=await Ze(f,t),E.value=g.value.slice(0,4).map(u=>u.id)}catch(r){console.error("\u83B7\u53D6\u5B57\u6BB5\u4FE1\u606F\u5931\u8D25:",r),i.error("\u83B7\u53D6\u5B57\u6BB5\u4FE1\u606F\u5931\u8D25: "+(r.message||String(r)))}}async function T(){N.value=!0,m.value=[],B.value=[],I.value=1;try{const r=await Q.base.getActiveTable(),n=await r.getActiveView(),f=r.id,t=n.id,u=await Ie(f,t,Re,!0);m.value=u.map(d=>{const R={recordId:d.recordId,field:d.field};return d.field&&d.field.forEach(O=>{R[O.field]=O.value}),R}),u.length>=Re?i.warning(`\u5DF2\u83B7\u53D6 ${u.length} \u6761\u8BB0\u5F55\uFF0C\u8FBE\u5230\u6700\u5927\u9650\u5236 ${Re} \u6761`):i.success(`\u5DF2\u83B7\u53D6 ${u.length} \u6761\u8BB0\u5F55`)}catch(r){console.error("\u83B7\u53D6\u8BB0\u5F55\u6570\u636E\u5931\u8D25:",r),i.error("\u83B7\u53D6\u8BB0\u5F55\u6570\u636E\u5931\u8D25: "+(r.message||String(r)))}finally{N.value=!1}}function M(r){B.value=r}function W(r){z.value=r,I.value=1,C.value&&C.value.clearSelection()}function X(r){I.value=r,C.value&&setTimeout(()=>{C.value.clearSelection(),J.value.forEach(n=>{B.value.some(f=>f.recordId===n.recordId)&&C.value.toggleRowSelection(n,!0)})},0)}function U(){if(B.value.length===0){i.warning("\u8BF7\u5148\u9009\u62E9\u8981\u6253\u5370\u7684\u6570\u636E");return}try{const r=ue();y("print",r),i.success("\u5DF2\u53D1\u9001\u6253\u5370\u8BF7\u6C42")}catch(r){console.error("\u51C6\u5907\u6253\u5370\u6570\u636E\u5931\u8D25:",r),i.error("\u51C6\u5907\u6253\u5370\u6570\u636E\u5931\u8D25: "+(r.message||String(r)))}}function j(){if(B.value.length===0){i.warning("\u8BF7\u5148\u9009\u62E9\u8981\u5BFC\u51FA\u7684\u6570\u636E");return}try{const r=ue();y("print",r,!0),i.success("\u5DF2\u53D1\u9001PDF\u5BFC\u51FA\u8BF7\u6C42")}catch(r){console.error("\u51C6\u5907\u5BFC\u51FA\u6570\u636E\u5931\u8D25:",r),i.error("\u51C6\u5907\u5BFC\u51FA\u6570\u636E\u5931\u8D25: "+(r.message||String(r)))}}function ue(){return B.value.map(r=>{const n={...r};delete n.recordId,delete n.field;const f={};return Object.keys(n).forEach(t=>{f[t]=n[t]}),f.table=[n],f})}function H(){C.value&&(C.value.clearSelection(),m.value.forEach(r=>{C.value.toggleRowSelection(r,!0)}),B.value=[...m.value])}function c(){if(C.value){J.value.forEach(n=>{C.value.toggleRowSelection(n,!1)}),J.value.forEach(n=>{C.value.toggleRowSelection(n,!0)});const r=B.value.filter(n=>!J.value.some(f=>f.recordId===n.recordId));B.value=[...r,...J.value]}}function o(){C.value&&(C.value.clearSelection(),B.value=[])}function b(){if(C.value){C.value.clearSelection(),J.value.forEach(t=>{const u=B.value.some(d=>d.recordId===t.recordId);C.value.toggleRowSelection(t,!u)});const r=J.value,n=B.value.filter(t=>!r.some(u=>u.recordId===t.recordId)),f=r.filter(t=>!B.value.some(u=>u.recordId===t.recordId));B.value=[...n,...f]}}const x=D([]),V=D(""),q=D(!1),le=D(0),ve=D(0),ne=D(0),te=D(!1),ce=D("pdf");async function we(){try{const n=(await Q.base.getActiveTable()).id,f=await xu(n);x.value=f,f.length>0&&(V.value=f[0].id)}catch(r){console.error("\u83B7\u53D6\u9644\u4EF6\u5B57\u6BB5\u5931\u8D25:",r),i.error("\u83B7\u53D6\u9644\u4EF6\u5B57\u6BB5\u5931\u8D25: "+(r.message||String(r)))}}async function Pe(){if(B.value.length===0){i.warning("\u8BF7\u5148\u9009\u62E9\u8981\u5BFC\u51FA\u7684\u6570\u636E");return}if(await we(),x.value.length===0){i.warning("\u5F53\u524D\u8868\u683C\u4E2D\u6CA1\u6709\u9644\u4EF6\u7C7B\u578B\u5B57\u6BB5\uFF0C\u8BF7\u5148\u6DFB\u52A0\u9644\u4EF6\u5B57\u6BB5");return}q.value=!0}async function Oe(){if(!V.value){i.warning("\u8BF7\u9009\u62E9\u4E00\u4E2A\u9644\u4EF6\u5B57\u6BB5");return}try{te.value=!0,le.value=0,ve.value=B.value.length,ne.value=0;const n=await(await Q.base.getActiveTable()).getFieldById(V.value);for(const f of B.value){ne.value++;try{const t=Ne(f),u=await he(t);if(!u)throw new Error("\u751F\u6210PDF\u5931\u8D25");const d=`\u8BB0\u5F55_${f.recordId}_${new Date().toISOString().split("T")[0]}`;let R;ce.value==="pdf"?R=new File([u],`${d}.pdf`,{type:"application/pdf"}):R=await Ou(u,d),await n.setValue(f.recordId,R),le.value=ne.value/ve.value*100,await new Promise(O=>setTimeout(O,300))}catch(t){console.error(`\u5904\u7406\u8BB0\u5F55 ${f.recordId} \u5931\u8D25:`,t),i.warning(`\u5904\u7406\u8BB0\u5F55 ${f.recordId} \u5931\u8D25: ${t.message||String(t)}`)}}i.success(`\u5DF2\u6210\u529F\u5BFC\u51FA ${ne.value} \u6761\u8BB0\u5F55\u7684${ce.value==="pdf"?"PDF":"JPEG\u56FE\u7247"}\u5230\u591A\u7EF4\u8868\u683C`),q.value=!1}catch(r){console.error("\u5BFC\u51FA\u81F3\u591A\u7EF4\u8868\u683C\u5931\u8D25:",r),i.error("\u5BFC\u51FA\u81F3\u591A\u7EF4\u8868\u683C\u5931\u8D25: "+(r.message||String(r)))}finally{te.value=!1}}function Ne(r){const n={...r};delete n.recordId,delete n.field;const f={};return Object.keys(n).forEach(t=>{f[t]=n[t]}),f.table=[n],f}async function he(r){return new Promise((n,f)=>{try{if(!p.hiprintTemplate){f(new Error("\u6253\u5370\u6A21\u677F\u672A\u521D\u59CB\u5316"));return}const t=`\u8BB0\u5F55_${new Date().toISOString().split("T")[0]}`;p.hiprintTemplate.toPdf([r],t,{isDownload:!1,type:"blob"}).then(u=>{u instanceof Blob?n(u):(console.error("PDF\u751F\u6210\u7ED3\u679C\u4E0D\u662FBlob\u5BF9\u8C61:",u),f(new Error("\u751F\u6210PDF\u5931\u8D25\uFF0C\u672A\u8FD4\u56DEBlob\u5BF9\u8C61")))}).catch(u=>{console.error("\u751F\u6210PDF\u5931\u8D25:",u),f(u||new Error("\u751F\u6210PDF\u5931\u8D25"))})}catch(t){console.error("\u751F\u6210PDF\u8FC7\u7A0B\u51FA\u9519:",t),f(t)}})}return(r,n)=>(w(),S("div",Nu,[a("div",Ju,[a("div",zu,[l(e(k),{type:"primary",onClick:T,loading:N.value,icon:e(De),size:"default"},{default:s(()=>n[7]||(n[7]=[A(" \u83B7\u53D6\u6570\u636E ")])),_:1,__:[7]},8,["loading","icon"]),m.value.length>0?(w(),S("div",Ru,[l(e(Se),{type:"info",size:"small"},{default:s(()=>[l(e(_),null,{default:s(()=>[l(e(Be))]),_:1}),A(" \u603B\u8BB0\u5F55: "+L(m.value.length),1)]),_:1}),B.value.length>0?(w(),ae(e(Se),{key:0,type:"success",size:"small"},{default:s(()=>[l(e(_),null,{default:s(()=>[l(e(uu))]),_:1}),A(" \u5DF2\u9009\u62E9: "+L(B.value.length),1)]),_:1})):G("",!0)])):G("",!0)])]),a("div",Lu,[a("div",ju,[a("h4",null,[l(e(_),null,{default:s(()=>[l(e(ge))]),_:1}),n[8]||(n[8]=A(" \u9009\u62E9\u663E\u793A\u5B57\u6BB5 "))]),n[9]||(n[9]=a("p",null,"\u9009\u62E9\u8981\u5728\u6570\u636E\u8868\u683C\u4E2D\u663E\u793A\u7684\u5B57\u6BB5",-1))]),l(e(Te),{modelValue:E.value,"onUpdate:modelValue":n[0]||(n[0]=f=>E.value=f),multiple:"","collapse-tags":"","collapse-tags-tooltip":"",placeholder:"\u8BF7\u9009\u62E9\u8981\u663E\u793A\u7684\u5B57\u6BB5",class:"field-select"},{default:s(()=>[(w(!0),S(ie,null,de(g.value,f=>(w(),ae(e($e),{key:f.id,label:f.name,value:f.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),m.value.length>0?(w(),S("div",Uu,[a("div",Mu,[a("h4",null,[l(e(_),null,{default:s(()=>[l(e(du))]),_:1}),n[10]||(n[10]=A(" \u9009\u62E9\u6253\u5370\u8BB0\u5F55 "))]),a("div",Hu,[l(e(cu),{size:"default"},{default:s(()=>[l(e(k),{onClick:H,icon:e(uu),size:"default"},{default:s(()=>n[11]||(n[11]=[A("\u5168\u9009")])),_:1,__:[11]},8,["icon"]),l(e(k),{onClick:c,icon:e(Be),size:"default"},{default:s(()=>n[12]||(n[12]=[A("\u5F53\u524D\u9875")])),_:1,__:[12]},8,["icon"]),l(e(k),{onClick:o,icon:e(Bu),size:"default"},{default:s(()=>n[13]||(n[13]=[A("\u6E05\u7A7A")])),_:1,__:[13]},8,["icon"]),l(e(k),{onClick:b,icon:e(Eu),size:"default"},{default:s(()=>n[14]||(n[14]=[A("\u53CD\u9009")])),_:1,__:[14]},8,["icon"])]),_:1})])]),a("div",Gu,[l(e(pu),{ref_key:"dataTable",ref:C,data:J.value,class:"data-table",stripe:"",border:"",size:"small",onSelectionChange:M,"header-cell-style":{background:"transparent",color:"white"}},{default:s(()=>[l(e(Fe),{type:"selection",width:"50"}),(w(!0),S(ie,null,de(P.value,f=>(w(),ae(e(Fe),{key:f.id,prop:f.id,label:f.name,"min-width":f.width||120,"show-overflow-tooltip":""},{default:s(t=>[a("span",qu,L($(t.row[f.id])),1)]),_:2},1032,["prop","label","min-width"]))),128))]),_:1},8,["data"])]),a("div",Ku,[l(e(Du),{"current-page":I.value,"onUpdate:currentPage":n[1]||(n[1]=f=>I.value=f),"page-size":z.value,"onUpdate:pageSize":n[2]||(n[2]=f=>z.value=f),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next",total:m.value.length,onSizeChange:W,onCurrentChange:X,small:""},null,8,["current-page","page-size","total"])])])):G("",!0),a("div",Wu,[a("div",Xu,[a("h4",null,[l(e(_),null,{default:s(()=>[l(e(Au))]),_:1}),n[15]||(n[15]=A(" \u6253\u5370\u64CD\u4F5C "))]),n[16]||(n[16]=a("p",null,"\u9009\u62E9\u64CD\u4F5C\u7C7B\u578B\u5E76\u6267\u884C\u6253\u5370",-1))]),a("div",Yu,[l(e(k),{type:"success",onClick:U,disabled:B.value.length===0,icon:e(pe),class:"action-btn",size:"default"},{default:s(()=>n[17]||(n[17]=[A(" \u6253\u5370\u9009\u4E2D\u6570\u636E ")])),_:1,__:[17]},8,["disabled","icon"]),l(e(k),{type:"warning",onClick:j,disabled:B.value.length===0,icon:e(Ae),class:"action-btn",size:"default"},{default:s(()=>n[18]||(n[18]=[A(" \u5BFC\u51FAPDF ")])),_:1,__:[18]},8,["disabled","icon"]),l(e(k),{type:"info",onClick:Pe,disabled:B.value.length===0,icon:e(Ee),class:"action-btn",size:"default"},{default:s(()=>n[19]||(n[19]=[A(" \u5BFC\u51FA\u81F3\u591A\u7EF4\u8868\u683C ")])),_:1,__:[19]},8,["disabled","icon"])])]),!N.value&&m.value.length===0?(w(),S("div",Qu,[l(e(We),{description:"\u6682\u65E0\u6570\u636E"},{default:s(()=>[l(e(k),{type:"primary",onClick:T,icon:e(De),size:"default"},{default:s(()=>n[20]||(n[20]=[A(" \u83B7\u53D6\u6570\u636E ")])),_:1,__:[20]},8,["icon"])]),_:1})])):G("",!0),l(e(Qe),{modelValue:q.value,"onUpdate:modelValue":n[6]||(n[6]=f=>q.value=f),title:"\u5BFC\u51FA\u81F3\u591A\u7EF4\u8868\u683C",width:"520px","close-on-click-modal":!1,"close-on-press-escape":!1,class:"export-dialog","align-center":""},{footer:s(()=>[a("div",pt,[l(e(k),{onClick:n[5]||(n[5]=f=>q.value=!1),disabled:te.value,class:"cancel-btn",size:"default"},{default:s(()=>n[31]||(n[31]=[A(" \u53D6\u6D88 ")])),_:1,__:[31]},8,["disabled"]),l(e(k),{type:"primary",onClick:Oe,loading:te.value,disabled:te.value,class:"export-btn",size:"default"},wu({default:s(()=>[A(" "+L(te.value?"\u5BFC\u51FA\u4E2D...":"\u5F00\u59CB\u5BFC\u51FA"),1)]),_:2},[te.value?void 0:{name:"icon",fn:s(()=>[l(e(_),null,{default:s(()=>[l(e(Ee))]),_:1})]),key:"0"}]),1032,["loading","disabled"])])]),default:s(()=>[te.value?(w(),S("div",ot,[a("div",rt,[l(e(_),{class:"progress-icon"},{default:s(()=>[l(e(Ye))]),_:1}),n[29]||(n[29]=a("h4",null,"\u6B63\u5728\u5BFC\u51FA\u81F3\u591A\u7EF4\u8868\u683C",-1))]),a("div",it,[a("span",dt,"\u8FDB\u5EA6: "+L(ne.value)+"/"+L(ve.value),1),a("span",ct,L(Math.round(le.value))+"%",1)]),l(e(yu),{percentage:le.value,"stroke-width":8,"show-text":!1,class:"custom-progress"},null,8,["percentage"]),n[30]||(n[30]=a("p",{class:"progress-tip"},"\u8BF7\u8010\u5FC3\u7B49\u5F85\uFF0C\u6B63\u5728\u5904\u7406\u60A8\u7684\u6570\u636E...",-1))])):(w(),S("div",Zu,[a("div",et,[a("div",ut,[l(e(_),{class:"section-icon"},{default:s(()=>[l(e(Ee))]),_:1}),n[21]||(n[21]=a("h4",null,"\u9009\u62E9\u9644\u4EF6\u5B57\u6BB5",-1))]),n[22]||(n[22]=a("p",{class:"section-description"},"\u8BF7\u9009\u62E9\u8981\u5C06\u6587\u4EF6\u5BFC\u51FA\u5230\u7684\u9644\u4EF6\u5B57\u6BB5:",-1)),l(e(Te),{modelValue:V.value,"onUpdate:modelValue":n[3]||(n[3]=f=>V.value=f),placeholder:"\u9009\u62E9\u9644\u4EF6\u5B57\u6BB5",class:"field-selector",size:"large"},{default:s(()=>[(w(!0),S(ie,null,de(x.value,f=>(w(),ae(e($e),{key:f.id,label:f.name,value:f.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),a("div",tt,[a("div",at,[l(e(_),{class:"section-icon"},{default:s(()=>[l(e(Be))]),_:1}),n[23]||(n[23]=a("h4",null,"\u9009\u62E9\u5BFC\u51FA\u683C\u5F0F",-1))]),n[26]||(n[26]=a("p",{class:"section-description"},"\u8BF7\u9009\u62E9\u5BFC\u51FA\u683C\u5F0F:",-1)),l(e(hu),{modelValue:ce.value,"onUpdate:modelValue":n[4]||(n[4]=f=>ce.value=f),class:"format-radio-group"},{default:s(()=>[l(e(tu),{label:"pdf",class:"format-radio"},{default:s(()=>n[24]||(n[24]=[a("div",{class:"radio-content"},[a("strong",null,"PDF\u683C\u5F0F"),a("span",{class:"radio-desc"},"\u63A8\u8350\u683C\u5F0F\uFF0C\u4FDD\u6301\u539F\u59CB\u8D28\u91CF")],-1)])),_:1,__:[24]}),l(e(tu),{label:"jpeg",class:"format-radio"},{default:s(()=>n[25]||(n[25]=[a("div",{class:"radio-content"},[a("strong",null,"JPEG\u56FE\u7247\u683C\u5F0F"),a("span",{class:"radio-desc"},"\u56FE\u7247\u683C\u5F0F\uFF0C\u4FBF\u4E8E\u9884\u89C8")],-1)])),_:1,__:[25]})]),_:1},8,["modelValue"])]),a("div",lt,[a("div",st,[l(e(_),{class:"tip-icon"},{default:s(()=>[l(e(Fu))]),_:1}),n[27]||(n[27]=a("span",null,"\u6BCF\u6761\u8BB0\u5F55\u5C06\u751F\u6210\u4E00\u4E2A\u5355\u72EC\u7684\u6587\u4EF6\uFF0C\u5E76\u4E0A\u4F20\u5230\u5BF9\u5E94\u8BB0\u5F55\u7684\u9644\u4EF6\u5B57\u6BB5\u4E2D",-1))]),a("div",nt,[l(e(_),{class:"tip-icon"},{default:s(()=>[l(e(Xe))]),_:1}),n[28]||(n[28]=a("span",null,"JPEG\u683C\u5F0F\u4F1A\u4F7F\u7528\u6D4F\u89C8\u5668\u8FDB\u884C\u8F6C\u6362\uFF0C\u53EF\u80FD\u5F71\u54CD\u56FE\u7247\u8D28\u91CF\u548C\u7CFB\u7EDF\u6027\u80FD\uFF0C\u5EFA\u8BAE\u6839\u636E\u5B9E\u9645\u9700\u6C42\u9009\u62E9\u5408\u9002\u7684\u683C\u5F0F",-1))])])]))]),_:1},8,["modelValue"])]))}}),ft=xe(Ft,[["__scopeId","data-v-df8c3585"]]),vt={class:"field-info-viewer"},mt={class:"toolbar"},gt={class:"toolbar-section"},Bt={key:1,class:"stats-cards"},Et={class:"stat-card"},Dt={class:"stat-icon"},At={class:"stat-content"},wt={class:"stat-number"},ht={key:0,class:"stat-card"},yt={class:"stat-icon"},Ct={class:"stat-content"},_t={class:"stat-number"},bt={key:2,class:"record-selector"},St={class:"selector-header"},Tt={key:3,class:"fields-container"},$t={class:"table-header"},kt={class:"field-value"},It={key:0},Vt={key:1,class:"empty-value"},xt={key:4,class:"empty-state"},Pt={__name:"FieldInfoViewer",setup(F){const v=D(""),p=D("info"),y=D(!1),g=D([]),E=D([]),m=D(""),B=D([]),N=D({}),C=be(()=>{switch(p.value){case"success":return mu;case"error":return Xe;default:return Ye}});function I($){return{Text:"primary",Number:"success",SingleSelect:"warning",MultiSelect:"info",DateTime:"danger",Checkbox:"success",User:"primary",Phone:"warning",Email:"info",Url:"primary",Attachment:"danger",SingleLink:"warning",Formula:"info",CreatedTime:"danger",ModifiedTime:"danger",CreatedUser:"primary",ModifiedUser:"primary"}[$]||"default"}Ve(async()=>{await z(),await J()});async function z(){y.value=!0,v.value="\u6B63\u5728\u83B7\u53D6\u5B57\u6BB5\u4FE1\u606F...",p.value="info",g.value=[],B.value=[],N.value={};try{const $=await Q.base.getActiveTable(),h=await $.getActiveView(),T=$.id,M=h.id;g.value=await Ze(T,M),v.value=`\u6210\u529F\u83B7\u53D6 ${g.value.length} \u4E2A\u5B57\u6BB5\u4FE1\u606F`,p.value="success"}catch($){v.value=`\u83B7\u53D6\u5B57\u6BB5\u4FE1\u606F\u5931\u8D25: ${$.message}`,p.value="error",console.error("\u83B7\u53D6\u5B57\u6BB5\u4FE1\u606F\u65F6\u51FA\u9519:",$)}finally{y.value=!1}}async function J(){v.value="\u6B63\u5728\u83B7\u53D6\u8BB0\u5F55\u5217\u8868...",p.value="info",E.value=[];try{const $=await Q.base.getActiveTable(),h=await $.getActiveView(),T=$.id,M=h.id,W=await Ie(T,M,null,!0);E.value=W,v.value=`\u6210\u529F\u83B7\u53D6 ${E.value.length} \u6761\u8BB0\u5F55`,p.value="success"}catch($){v.value=`\u83B7\u53D6\u8BB0\u5F55\u5217\u8868\u5931\u8D25: ${$.message}`,p.value="error",console.error("\u83B7\u53D6\u8BB0\u5F55\u5217\u8868\u65F6\u51FA\u9519:",$)}}async function P(){if(!m.value){v.value="\u8BF7\u5148\u9009\u62E9\u4E00\u6761\u8BB0\u5F55",p.value="error";return}v.value="\u6B63\u5728\u83B7\u53D6\u8BB0\u5F55\u503C...",p.value="info",B.value=[],N.value={};try{const $=await Q.base.getActiveTable(),h=await $.getActiveView(),T=$.id,M=h.id,W=await Ie(T,M,m.value,!0);if(W.length>0){const X=W[0];B.value=X.field.map(U=>({fieldId:U.field,value:U.value})),N.value=X.field.reduce((U,j)=>(U[j.field]=j.value,U),{}),v.value=`\u6210\u529F\u83B7\u53D6\u8BB0\u5F55\u7684 ${B.value.length} \u4E2A\u5B57\u6BB5\u503C`,p.value="success"}else v.value="\u672A\u627E\u5230\u6307\u5B9A\u8BB0\u5F55",p.value="error"}catch($){v.value=`\u83B7\u53D6\u8BB0\u5F55\u503C\u5931\u8D25: ${$.message}`,p.value="error",console.error("\u83B7\u53D6\u8BB0\u5F55\u503C\u65F6\u51FA\u9519:",$)}}return($,h)=>(w(),S("div",vt,[a("div",mt,[a("div",gt,[l(e(k),{type:"primary",onClick:z,icon:e(De),loading:y.value},{default:s(()=>h[1]||(h[1]=[A(" \u83B7\u53D6\u5B57\u6BB5\u4FE1\u606F ")])),_:1,__:[1]},8,["icon","loading"]),l(e(k),{type:"success",onClick:P,disabled:!m.value||g.value.length===0,icon:e(je)},{default:s(()=>h[2]||(h[2]=[A(" \u83B7\u53D6\u8BB0\u5F55\u503C ")])),_:1,__:[2]},8,["disabled","icon"])])]),v.value?(w(),S("div",{key:0,class:fu(["status-message",p.value])},[l(e(_),null,{default:s(()=>[(w(),ae(vu(C.value)))]),_:1}),a("span",null,L(v.value),1)],2)):G("",!0),g.value.length>0?(w(),S("div",Bt,[a("div",Et,[a("div",Dt,[l(e(_),null,{default:s(()=>[l(e(Ue))]),_:1})]),a("div",At,[a("div",wt,L(g.value.length),1),h[3]||(h[3]=a("div",{class:"stat-label"},"\u5B57\u6BB5\u603B\u6570",-1))])]),E.value.length>0?(w(),S("div",ht,[a("div",yt,[l(e(_),null,{default:s(()=>[l(e(Be))]),_:1})]),a("div",Ct,[a("div",_t,L(E.value.length),1),h[4]||(h[4]=a("div",{class:"stat-label"},"\u8BB0\u5F55\u603B\u6570",-1))])])):G("",!0)])):G("",!0),E.value.length>0?(w(),S("div",bt,[a("div",St,[a("h4",null,[l(e(_),null,{default:s(()=>[l(e(Cu))]),_:1}),h[5]||(h[5]=A(" \u9009\u62E9\u8BB0\u5F55\u67E5\u770B\u8BE6\u7EC6\u503C "))])]),l(e(Te),{modelValue:m.value,"onUpdate:modelValue":h[0]||(h[0]=T=>m.value=T),placeholder:"\u8BF7\u9009\u62E9\u8BB0\u5F55",filterable:"",clearable:"",onChange:P,class:"record-select"},{default:s(()=>[(w(!0),S(ie,null,de(E.value,T=>{var M;return w(),ae(e($e),{key:T.recordId,label:((M=T.field[0])==null?void 0:M.value)||T.recordId,value:T.recordId},null,8,["label","value"])}),128))]),_:1},8,["modelValue"])])):G("",!0),g.value.length>0?(w(),S("div",Tt,[a("div",$t,[a("h4",null,[l(e(_),null,{default:s(()=>[l(e(du))]),_:1}),h[6]||(h[6]=A(" \u5B57\u6BB5\u8BE6\u7EC6\u4FE1\u606F "))])]),l(e(pu),{data:g.value,class:"fields-table",stripe:"",border:"",size:"small","header-cell-style":{background:"#f8f9fa",color:"#303133"}},{default:s(()=>[l(e(Fe),{prop:"id",label:"\u5B57\u6BB5ID","min-width":"200","show-overflow-tooltip":""}),l(e(Fe),{prop:"name",label:"\u5B57\u6BB5\u540D\u79F0","min-width":"120","show-overflow-tooltip":""}),l(e(Fe),{prop:"type",label:"\u5B57\u6BB5\u7C7B\u578B","min-width":"100"},{default:s(T=>[l(e(Se),{type:I(T.row.type),size:"small"},{default:s(()=>[A(L(T.row.type),1)]),_:2},1032,["type"])]),_:1}),B.value.length>0?(w(),ae(e(Fe),{key:0,label:"\u5B57\u6BB5\u503C","min-width":"200"},{default:s(T=>[a("div",kt,[N.value[T.row.id]?(w(),S("pre",It,L(N.value[T.row.id]),1)):(w(),S("span",Vt,"\u6682\u65E0\u6570\u636E"))])]),_:1})):G("",!0)]),_:1},8,["data"])])):G("",!0),!y.value&&g.value.length===0?(w(),S("div",xt,[l(e(We),{description:"\u6682\u65E0\u5B57\u6BB5\u4FE1\u606F"},{default:s(()=>[l(e(k),{type:"primary",onClick:z,icon:e(De)},{default:s(()=>h[7]||(h[7]=[A(" \u83B7\u53D6\u5B57\u6BB5\u4FE1\u606F ")])),_:1,__:[7]},8,["icon"])]),_:1})])):G("",!0)]))}},Ot=xe(Pt,[["__scopeId","data-v-45ae9614"]]),Nt="hiprintDB",se="templates",Jt=1;function eu(){return new Promise((F,v)=>{const p=window.indexedDB.open(Nt,Jt);p.onerror=y=>v(y.target.error),p.onsuccess=y=>F(y.target.result),p.onupgradeneeded=y=>{const g=y.target.result;g.objectStoreNames.contains(se)||g.createObjectStore(se,{keyPath:"id"}).createIndex("description","description",{unique:!1})}})}async function _e(F,v,p=""){const y=await eu();return new Promise((g,E)=>{try{const m=JSON.parse(JSON.stringify(v)),B=y.transaction(se,"readwrite");B.objectStore(se).put({id:F,data:m,description:p,createdAt:new Date().toISOString()}),B.oncomplete=()=>g(),B.onerror=C=>E(C.target.error)}catch(m){E(m)}})}async function qe(){const F=await eu();return new Promise((v,p)=>{const E=F.transaction(se,"readonly").objectStore(se).getAll();E.onsuccess=()=>v(E.result||[]),E.onerror=m=>p(m.target.error)})}async function iu(F){const v=await eu();return new Promise((p,y)=>{const g=v.transaction(se,"readwrite");g.objectStore(se).delete(F),g.oncomplete=()=>p(),g.onerror=m=>y(m.target.error)})}const zt={class:"template-manager"},Rt={class:"stats-cards"},Lt={class:"stat-card"},jt={class:"stat-icon"},Ut={class:"stat-content"},Mt={class:"stat-number"},Ht={key:0,class:"stat-card"},Gt={class:"stat-icon"},qt={class:"stat-content"},Kt={class:"stat-number"},Wt={class:"toolbar"},Xt={class:"toolbar-section"},Yt={class:"toolbar-section"},Qt={class:"template-list-container"},Zt={key:0,class:"empty-state"},ea={key:1,class:"template-cards"},ua={class:"card-header"},ta={class:"template-info"},aa={class:"template-name"},la={class:"template-description"},sa={class:"template-status"},na={class:"card-meta"},oa={class:"meta-item"},ra={class:"meta-value"},ia={class:"card-actions"},da={class:"dialog-footer"},ca=Ke({__name:"TemplateManager",props:{hiprintTemplate:Object},emits:["load-template"],setup(F,{emit:v}){const p=F,y=v,g=D([]),E=D(!1),m=D(""),B=D(!1),N=D("\u65B0\u589E\u6A21\u677F"),C=D(!1),I=D({id:"",name:"",description:"",data:null});D(!1),D("");async function z(){try{E.value=!0;const c=await qe();g.value=c}catch(c){console.error("\u52A0\u8F7D\u6A21\u677F\u5217\u8868\u5931\u8D25:",c),i.error("\u52A0\u8F7D\u6A21\u677F\u5217\u8868\u5931\u8D25: "+(c.message||String(c)))}finally{E.value=!1}}function J(){C.value=!1,N.value="\u65B0\u589E\u6A21\u677F",I.value={id:"",name:"",description:"",data:p.hiprintTemplate?p.hiprintTemplate.getJson():null},B.value=!0}function P(c){C.value=!0,N.value="\u7F16\u8F91\u6A21\u677F",I.value={id:c.id,name:c.id,description:c.description||"",data:c.data},B.value=!0}async function $(){try{if(!I.value.name){i.warning("\u8BF7\u8F93\u5165\u6A21\u677F\u540D\u79F0");return}C.value&&I.value.id!==I.value.name&&await iu(I.value.id);const c=JSON.parse(JSON.stringify(I.value.data));await _e(I.value.name,c,I.value.description||I.value.name),i.success("\u6A21\u677F\u4FDD\u5B58\u6210\u529F"),B.value=!1,await z()}catch(c){console.error("\u4FDD\u5B58\u6A21\u677F\u5931\u8D25:",c),i.error("\u4FDD\u5B58\u6A21\u677F\u5931\u8D25: "+(c.message||String(c)))}}async function h(c){try{await He.confirm("\u786E\u5B9A\u8981\u5220\u9664\u8FD9\u4E2A\u6A21\u677F\u5417\uFF1F","\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}),await iu(c),i.success("\u6A21\u677F\u5DF2\u5220\u9664"),await z()}catch(o){o!=="cancel"&&(console.error("\u5220\u9664\u6A21\u677F\u5931\u8D25:",o),i.error("\u5220\u9664\u6A21\u677F\u5931\u8D25: "+(o.message||String(o))))}}function T(c){y("load-template",c.data),i.success("\u6A21\u677F\u5DF2\u52A0\u8F7D\u5230\u8BBE\u8BA1\u5668")}function M(c){try{const o=JSON.stringify(c.data,null,2),b=new Blob([o],{type:"application/json"}),x=URL.createObjectURL(b),V=document.createElement("a");V.href=x,V.download=`${c.id}_${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(V),V.click(),document.body.removeChild(V),URL.revokeObjectURL(x),i.success("\u6A21\u677F\u5BFC\u51FA\u6210\u529F")}catch(o){console.error("\u5BFC\u51FA\u6A21\u677F\u5931\u8D25:",o),i.error("\u5BFC\u51FA\u6A21\u677F\u5931\u8D25: "+(o.message||String(o)))}}function W(){try{if(g.value.length===0){i.warning("\u6CA1\u6709\u53EF\u5BFC\u51FA\u7684\u6A21\u677F");return}const c={};g.value.forEach(q=>{c[q.id]=q.data});const o=JSON.stringify(c,null,2),b=new Blob([o],{type:"application/json"}),x=URL.createObjectURL(b),V=document.createElement("a");V.href=x,V.download=`\u6240\u6709\u6A21\u677F_${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(V),V.click(),document.body.removeChild(V),URL.revokeObjectURL(x),i.success(`\u5DF2\u5BFC\u51FA ${g.value.length} \u4E2A\u6A21\u677F`)}catch(c){console.error("\u5BFC\u51FA\u6240\u6709\u6A21\u677F\u5931\u8D25:",c),i.error("\u5BFC\u51FA\u6240\u6709\u6A21\u677F\u5931\u8D25: "+(c.message||String(c)))}}function X(){const c=document.createElement("input");c.type="file",c.accept="application/json",c.style.display="none",document.body.appendChild(c),c.addEventListener("change",async o=>{const b=o.target.files[0];if(!b){document.body.removeChild(c);return}try{const x=await U(b);await ue(x)}catch(x){console.error("\u5BFC\u5165\u6A21\u677F\u5931\u8D25:",x),i.error("\u5BFC\u5165\u6A21\u677F\u5931\u8D25: "+(x.message||String(x)))}finally{document.body.removeChild(c)}}),c.click()}function U(c){return new Promise((o,b)=>{const x=new FileReader;x.onload=V=>{try{const q=JSON.parse(V.target.result);o(q)}catch{b(new Error("\u65E0\u6548\u7684JSON\u6587\u4EF6"))}},x.onerror=()=>b(new Error("\u8BFB\u53D6\u6587\u4EF6\u5931\u8D25")),x.readAsText(c)})}function j(c){return!c||typeof c!="object"?!1:!!(Array.isArray(c.panels)||c.width!==void 0&&c.height!==void 0||c.printElements!==void 0)}async function ue(c){try{if(typeof c=="object"&&!Array.isArray(c))if(j(c))await He.prompt("\u8BF7\u8F93\u5165\u6A21\u677F\u540D\u79F0","\u5BFC\u5165\u6A21\u677F",{confirmButtonText:"\u786E\u8BA4",cancelButtonText:"\u53D6\u6D88",inputPattern:/.+/,inputErrorMessage:"\u6A21\u677F\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A"}).then(async({value:o})=>{const b={...c,panels:c.panels||[],width:c.width||210,height:c.height||297,paperType:c.paperType||"A4",paperHeader:c.paperHeader||0,paperFooter:c.paperFooter||0,printElements:c.printElements||[]},x=JSON.parse(JSON.stringify(b));await _e(o,x,o),i.success("\u6A21\u677F\u5BFC\u5165\u6210\u529F")});else{let o=0,b=!1;for(const[x,V]of Object.entries(c))if(j(V)){b=!0;const q={...V,panels:V.panels||[],width:V.width||210,height:V.height||297,paperType:V.paperType||"A4",paperHeader:V.paperHeader||0,paperFooter:V.paperFooter||0,printElements:V.printElements||[]},le=JSON.parse(JSON.stringify(q));await _e(x,le,x),o++}if(b)i.success(`\u6210\u529F\u5BFC\u5165 ${o} \u4E2A\u6A21\u677F`);else{i.error("\u672A\u627E\u5230\u6709\u6548\u7684\u6A21\u677F\u6570\u636E");return}}else{i.error("\u65E0\u6548\u7684\u6A21\u677F\u6570\u636E\u683C\u5F0F");return}await z()}catch(o){o!=="cancel"&&(console.error("\u5BFC\u5165\u6A21\u677F\u5931\u8D25:",o),i.error("\u5BFC\u5165\u6A21\u677F\u5931\u8D25: "+(o.message||String(o))))}}const H=be(()=>{if(!m.value)return g.value;const c=m.value.toLowerCase();return g.value.filter(o=>o.id.toLowerCase().includes(c)||o.description&&o.description.toLowerCase().includes(c))});return Ve(()=>{z()}),(c,o)=>(w(),S("div",zt,[l(e(_u),{title:"\u6A21\u677F\u6570\u636E\u4FDD\u5B58\u5728\u6D4F\u89C8\u5668\u672C\u5730\u5B58\u50A8\u4E2D\uFF0C\u5EFA\u8BAE\u5B9A\u671F\u5BFC\u51FA\u5907\u4EFD",type:"warning",closable:!1,"show-icon":"",class:"warning-alert"}),a("div",Rt,[a("div",Lt,[a("div",jt,[l(e(_),null,{default:s(()=>[l(e(Me))]),_:1})]),a("div",Ut,[a("div",Mt,L(g.value.length),1),o[5]||(o[5]=a("div",{class:"stat-label"},"\u6A21\u677F\u603B\u6570",-1))])]),H.value.length!==g.value.length?(w(),S("div",Ht,[a("div",Gt,[l(e(_),null,{default:s(()=>[l(e(je))]),_:1})]),a("div",qt,[a("div",Kt,L(H.value.length),1),o[6]||(o[6]=a("div",{class:"stat-label"},"\u641C\u7D22\u7ED3\u679C",-1))])])):G("",!0)]),a("div",Wt,[a("div",Xt,[l(e(fe),{modelValue:m.value,"onUpdate:modelValue":o[0]||(o[0]=b=>m.value=b),placeholder:"\u641C\u7D22\u6A21\u677F\u540D\u79F0...","prefix-icon":e(je),clearable:"",class:"search-input"},null,8,["modelValue","prefix-icon"])]),a("div",Yt,[l(e(cu),null,{default:s(()=>[l(e(k),{type:"primary",onClick:J,icon:e(au)},{default:s(()=>o[7]||(o[7]=[A(" \u4FDD\u5B58\u5F53\u524D\u6A21\u677F ")])),_:1,__:[7]},8,["icon"]),l(e(k),{type:"success",onClick:W,icon:e(Ae)},{default:s(()=>o[8]||(o[8]=[A(" \u5BFC\u51FA\u6240\u6709 ")])),_:1,__:[8]},8,["icon"]),l(e(k),{type:"info",onClick:X,icon:e(Ee)},{default:s(()=>o[9]||(o[9]=[A(" \u5BFC\u5165\u6A21\u677F ")])),_:1,__:[9]},8,["icon"]),l(e(k),{onClick:z,icon:e(De)},{default:s(()=>o[10]||(o[10]=[A(" \u5237\u65B0 ")])),_:1,__:[10]},8,["icon"])]),_:1})])]),a("div",Qt,[H.value.length===0&&!E.value?(w(),S("div",Zt,[l(e(We),{description:"\u6682\u65E0\u6A21\u677F\u6570\u636E"},{default:s(()=>[l(e(k),{type:"primary",onClick:J,icon:e(au)},{default:s(()=>o[11]||(o[11]=[A(" \u4FDD\u5B58\u5F53\u524D\u6A21\u677F ")])),_:1,__:[11]},8,["icon"])]),_:1})])):(w(),S("div",ea,[(w(!0),S(ie,null,de(H.value,b=>(w(),S("div",{key:b.id,class:"template-card"},[a("div",ua,[a("div",ta,[a("h4",aa,[l(e(_),null,{default:s(()=>[l(e(Be))]),_:1}),A(" "+L(b.id),1)]),a("p",la,L(b.description||"\u6682\u65E0\u63CF\u8FF0"),1)]),a("div",sa,[l(e(Se),{type:"success",size:"small"},{default:s(()=>[l(e(_),null,{default:s(()=>[l(e(mu))]),_:1}),o[12]||(o[12]=A(" \u5DF2\u4FDD\u5B58 "))]),_:1,__:[12]})])]),a("div",na,[a("div",oa,[o[13]||(o[13]=a("span",{class:"meta-label"},"\u521B\u5EFA\u65F6\u95F4\uFF1A",-1)),a("span",ra,L(b.createdAt?new Date(b.createdAt).toLocaleString():"\u672A\u77E5"),1)])]),a("div",ia,[l(e(k),{type:"primary",size:"small",onClick:x=>T(b),icon:e(re),class:"action-btn"},{default:s(()=>o[14]||(o[14]=[A(" \u52A0\u8F7D\u5230\u8BBE\u8BA1\u5668 ")])),_:2,__:[14]},1032,["onClick","icon"]),l(e(k),{type:"success",size:"small",onClick:x=>M(b),icon:e(Ae),class:"action-btn"},{default:s(()=>o[15]||(o[15]=[A(" \u5BFC\u51FA ")])),_:2,__:[15]},1032,["onClick","icon"]),l(e(k),{type:"warning",size:"small",onClick:x=>P(b),icon:e(re),class:"action-btn"},{default:s(()=>o[16]||(o[16]=[A(" \u7F16\u8F91 ")])),_:2,__:[16]},1032,["onClick","icon"]),l(e(k),{type:"danger",size:"small",onClick:x=>h(b.id),icon:e(bu),class:"action-btn"},{default:s(()=>o[17]||(o[17]=[A(" \u5220\u9664 ")])),_:2,__:[17]},1032,["onClick","icon"])])]))),128))]))]),l(e(Qe),{modelValue:B.value,"onUpdate:modelValue":o[4]||(o[4]=b=>B.value=b),title:N.value,width:"500px"},{footer:s(()=>[a("span",da,[l(e(k),{onClick:o[3]||(o[3]=b=>B.value=!1)},{default:s(()=>o[18]||(o[18]=[A("\u53D6\u6D88")])),_:1,__:[18]}),l(e(k),{type:"primary",onClick:$},{default:s(()=>o[19]||(o[19]=[A("\u786E\u8BA4")])),_:1,__:[19]})])]),default:s(()=>[l(e(gu),{model:I.value,"label-width":"100px"},{default:s(()=>[l(e(ke),{label:"\u6A21\u677F\u540D\u79F0"},{default:s(()=>[l(e(fe),{modelValue:I.value.name,"onUpdate:modelValue":o[1]||(o[1]=b=>I.value.name=b),placeholder:"\u8BF7\u8F93\u5165\u6A21\u677F\u540D\u79F0"},null,8,["modelValue"])]),_:1}),l(e(ke),{label:"\u6A21\u677F\u63CF\u8FF0"},{default:s(()=>[l(e(fe),{modelValue:I.value.description,"onUpdate:modelValue":o[2]||(o[2]=b=>I.value.description=b),type:"textarea",placeholder:"\u8BF7\u8F93\u5165\u6A21\u677F\u63CF\u8FF0"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])]))}}),pa=xe(ca,[["__scopeId","data-v-7e5ab442"]]),Fa={class:"hiprint-viewer"},fa={class:"viewer-header"},va={class:"header-content"},ma={class:"header-left"},ga={class:"header-actions"},Ba={key:0,class:"status-message error"},Ea={key:1,class:"status-message info"},Da={key:2,class:"loading-overlay"},Aa={class:"hiprint-container"},wa={class:"nav-tabs"},ha={class:"tab-buttons"},ya=["data-tab","onClick"],Ca={class:"tab-icon"},_a={key:1,class:"emoji-icon"},ba={class:"tab-content"},Sa={key:0,class:"tab-panel"},Ta={class:"panel-header"},$a={class:"recommendation-banner"},ka={class:"banner-content"},Ia={class:"banner-icon"},Va={class:"banner-actions"},xa={class:"toolbar"},Pa={class:"toolbar-container"},Oa={class:"toolbar-group template-group"},Na={class:"group-header"},Ja={class:"group-content"},za={class:"input-group"},Ra={class:"toolbar-group operations-group"},La={class:"group-header"},ja={class:"group-content"},Ua={class:"paper-size-group"},Ma={class:"toolbar-group preview-group"},Ha={class:"group-header"},Ga={class:"group-content"},qa={class:"design-workspace"},Ka={class:"elements-panel"},Wa={class:"panel-title"},Xa={class:"properties-panel"},Ya={class:"panel-title"},Qa={key:1,class:"tab-panel"},Za={class:"panel-header"},el={key:2,class:"tab-panel"},ul={class:"panel-header"},tl={key:3,class:"tab-panel"},al={class:"panel-header"},ll={class:"hiprint-printPagination"},sl={class:"dialog-footer"},nl=Ke({__name:"hiprintViewer",setup(F){const v=Su(),p=D(""),y=D([]),g=D([]),E=D("design");let m=null,B=D(!0);const N=D(!1),C=D(""),I=D([{label:"A4",value:"A4",width:210,height:297},{label:"A5",value:"A5",width:148,height:210},{label:"B5",value:"B5",width:176,height:250},{label:"\u81EA\u5B9A\u4E49",value:"custom",width:100,height:150}]),z=D("A4"),J=D(!1),P=D({width:100,height:150}),$=D([]),h=D(""),T=D(""),M=D([{name:"design",label:"\u8BBE\u8BA1\u6A21\u677F",icon:re,emoji:"\u{1F3A8}"},{name:"print",label:"\u6570\u636E\u6253\u5370",icon:pe,emoji:"\u{1F5A8}\uFE0F"},{name:"template-manager",label:"\u6A21\u677F\u7BA1\u7406",icon:Me,emoji:"\u{1F4C1}"},{name:"field-info",label:"\u5B57\u6BB5\u4FE1\u606F",icon:Ue,emoji:"\u{1F4CA}"}]);Le(E,async(t,u)=>{t==="design"&&u!=="design"&&m&&(console.log("\u5207\u6362\u5230\u8BBE\u8BA1\u6807\u7B7E\u9875\uFF0C\u51C6\u5907\u91CD\u65B0\u6E32\u67D3hiprint\u7EC4\u4EF6"),await ou(),setTimeout(()=>{U()},150))}),Ve(async()=>{try{B.value=!0,p.value="\u6B63\u5728\u521D\u59CB\u5316...",window.addEventListener("message",Oe),p.value="\u6B63\u5728\u52A0\u8F7D\u5B57\u6BB5\u4FE1\u606F...",await W(),p.value="\u6B63\u5728\u521D\u59CB\u5316\u6253\u5370\u7EC4\u4EF6...",await j(),await Pe()||(p.value="\u6B63\u5728\u52A0\u8F7D\u9ED8\u8BA4\u6A21\u677F...",await n()),await he(),B.value=!1,p.value="",X()}catch(t){console.error("\u521D\u59CB\u5316\u5931\u8D25:",t),p.value="\u521D\u59CB\u5316\u5931\u8D25: "+(t.message||String(t)),B.value=!1}});async function W(){try{const t=await Q.base.getActiveTable(),u=await t.getActiveView(),d=t.id,R=u.id;return y.value=await Ze(d,R),{fields:y.value,tableId:d,viewId:R}}catch(t){throw console.error("\u83B7\u53D6\u5B57\u6BB5\u5931\u8D25:",t),t}}async function X(){try{N.value=!0,C.value="\u6B63\u5728\u52A0\u8F7D\u8BB0\u5F55\u6570\u636E\uFF0C\u8FD9\u53EF\u80FD\u9700\u8981\u4E00\u4E9B\u65F6\u95F4...";const t=await Q.base.getActiveTable(),u=await t.getActiveView(),d=t.id,R=u.id;await Ie(d,R,null,!0,(O,K,ye)=>{if(g.value=O.map(Y=>{const Z={recordId:Y.recordId,field:Y.field};return Y.field&&Y.field.forEach(Ce=>{Z[Ce.field]=Ce.value}),Z}),O.length>0){const Y=O[0];window.fieldTestData={},Y&&Y.field&&Y.field.forEach(Z=>{window.fieldTestData[Z.field]=Z.value})}ye?(C.value=`\u5DF2\u6210\u529F\u52A0\u8F7D ${O.length} \u6761\u8BB0\u5F55`,setTimeout(()=>{C.value=""},3e3)):C.value=`\u5DF2\u52A0\u8F7D ${O.length} \u6761\u8BB0\u5F55\uFF0C\u6B63\u5728\u7EE7\u7EED\u52A0\u8F7D...\uFF08\u6279\u6B21 ${K}\uFF09`})}catch(t){console.error("\u83B7\u53D6\u8BB0\u5F55\u5931\u8D25:",t),C.value="\u83B7\u53D6\u8BB0\u5F55\u5931\u8D25: "+(t.message||String(t)),setTimeout(()=>{C.value=""},5e3)}finally{N.value=!1}}function U(){try{if(!m){console.warn("hiprintTemplate\u672A\u521D\u59CB\u5316\uFF0C\u65E0\u6CD5\u91CD\u65B0\u6E32\u67D3");return}const t=ee("#hiprint-printTemplate"),u=ee("#provider-container");if(t.length===0){console.warn("\u6A21\u677F\u5BB9\u5668\u4E0D\u5B58\u5728\uFF0C\u65E0\u6CD5\u91CD\u65B0\u6E32\u67D3");return}m.design("#hiprint-printTemplate",{grid:!0}),u.length>0&&(u.empty(),oe.exports.hiprint.PrintElementTypeManager.build(u,"defaultModule"),oe.exports.hiprint.PrintElementTypeManager.build(u,"customModule"),setTimeout(()=>{ee(".ep-draggable-item-group").each(function(){const d=ee(this).children(".ep-draggable-item");d.length>0&&d.wrapAll('<div class="ep-draggable-item-list"></div>')})},200)),console.log("hiprint\u7EC4\u4EF6\u91CD\u65B0\u6E32\u67D3\u5B8C\u6210")}catch(t){console.error("\u91CD\u65B0\u6E32\u67D3hiprint\u7EC4\u4EF6\u5931\u8D25:",t)}}async function j(){try{ee("#provider-container").empty(),ee("#hiprint-printTemplate").empty(),oe.exports.hiprint.init({providers:[oe.exports.defaultElementTypeProvider(),Vu(y.value,window.fieldTestData)()]}),oe.exports.hiprint.PrintElementTypeManager.build(ee("#provider-container"),"defaultModule"),oe.exports.hiprint.PrintElementTypeManager.build(ee("#provider-container"),"customModule"),m=new oe.exports.hiprint.PrintTemplate({template:{},settingContainer:"#PrintElementOptionSetting",paginationContainer:".hiprint-printPagination",fontList:[{title:"\u5FAE\u8F6F\u96C5\u9ED1",value:"Microsoft YaHei"},{title:"\u9ED1\u4F53",value:"STHeitiSC-Light"},{title:"\u601D\u6E90\u9ED1\u4F53",value:"SourceHanSansCN-Normal"},{title:"\u5B8B\u4F53",value:"SimSun"},{title:"\u534E\u4E3A\u6977\u4F53",value:"STKaiti"}],dataMode:1,history:!0,onDataChanged:(t,u)=>{console.log("\u6A21\u677F\u53D8\u66F4\u7C7B\u578B:",t),console.log("\u6A21\u677F\u6570\u636E:",u)},onUpdateError:t=>{console.error("\u66F4\u65B0\u5931\u8D25:",t)}}),m.design("#hiprint-printTemplate",{grid:!0}),setTimeout(()=>{ee(".ep-draggable-item-group").each(function(){const t=ee(this).children(".ep-draggable-item");t.length>0&&t.wrapAll('<div class="ep-draggable-item-list"></div>')})},500)}catch(t){throw console.error("\u521D\u59CB\u5316\u6253\u5370\u7EC4\u4EF6\u5931\u8D25:",t),p.value="\u521D\u59CB\u5316\u6253\u5370\u7EC4\u4EF6\u5931\u8D25: "+(t.message||String(t)),t}}function ue(){const t=m.getJson();return console.log("\u6A21\u677FJSON:",t),t}function H(t){try{ee("#hiprint-printTemplate").empty(),m.update(t),m.design("#hiprint-printTemplate",{grid:!0}),E.value==="design"&&setTimeout(()=>{U()},100),i.success("\u6A21\u677F\u5BFC\u5165\u6210\u529F")}catch(u){console.error("\u5BFC\u5165\u6A21\u677F\u5931\u8D25:",u),i.error("\u5BFC\u5165\u6A21\u677F\u5931\u8D25: "+(u.message||String(u)))}}function c(t){try{const u=I.value.find(d=>d.value===t);if(!u)return;m.setPaper(t),i.success(`\u5DF2\u8BBE\u7F6E\u7EB8\u5F20\u5927\u5C0F: ${u.label}`)}catch(u){console.error("\u8BBE\u7F6E\u7EB8\u5F20\u5927\u5C0F\u5931\u8D25:",u),i.error("\u8BBE\u7F6E\u7EB8\u5F20\u5927\u5C0F\u5931\u8D25: "+(u.message||String(u)))}}function o(){try{const t=parseFloat(P.value.width.toString()),u=parseFloat(P.value.height.toString());if(isNaN(t)||t<=0||isNaN(u)||u<=0){i.error("\u8BF7\u8F93\u5165\u6709\u6548\u7684\u7EB8\u5F20\u5C3A\u5BF8");return}m.setPaper(t,u),i.success(`\u5DF2\u8BBE\u7F6E\u81EA\u5B9A\u4E49\u7EB8\u5F20\u5927\u5C0F: ${t}mm x ${u}mm`),J.value=!1}catch(t){console.error("\u8BBE\u7F6E\u81EA\u5B9A\u4E49\u7EB8\u5F20\u5931\u8D25:",t),i.error("\u8BBE\u7F6E\u81EA\u5B9A\u4E49\u7EB8\u5F20\u5931\u8D25: "+(t.message||String(t)))}}function b(t){z.value=t,t==="custom"?(P.value={width:100,height:150},J.value=!0):c(t)}function x(t){switch(t){case"export":ne();break;case"import":V();break;case"paste":q();break}}function V(){const t=document.createElement("input");t.type="file",t.accept="application/json",t.style.display="none",document.body.appendChild(t),t.addEventListener("change",u=>{const d=u.target.files[0];if(!d){document.body.removeChild(t);return}const R=new FileReader;R.onload=O=>{try{const K=JSON.parse(O.target.result);H(K),i.success("\u6A21\u677F\u5BFC\u5165\u6210\u529F")}catch(K){console.error("\u89E3\u6790JSON\u5931\u8D25:",K),i.error("\u65E0\u6548\u7684\u6A21\u677F\u6587\u4EF6")}},R.onerror=()=>{i.error("\u8BFB\u53D6\u6587\u4EF6\u5931\u8D25")},R.readAsText(d),document.body.removeChild(t)}),t.click()}function q(){He.prompt("\u8BF7\u7C98\u8D34\u6A21\u677FJSON\u6570\u636E","\u5BFC\u5165\u6A21\u677F",{confirmButtonText:"\u5BFC\u5165",cancelButtonText:"\u53D6\u6D88",inputType:"textarea",inputPlaceholder:"\u7C98\u8D34JSON\u6570\u636E..."}).then(({value:t})=>{try{if(!t){i.warning("\u672A\u63D0\u4F9BJSON\u6570\u636E");return}const u=JSON.parse(t);H(u),i.success("\u6A21\u677F\u5BFC\u5165\u6210\u529F")}catch(u){console.error("\u5BFC\u5165JSON\u5931\u8D25:",u),i.error("\u65E0\u6548\u7684JSON\u6570\u636E: "+(u.message||String(u)))}}).catch(()=>{})}function le(t){m.print(t)}function ve(t,u){m.toPdf(t,u)}function ne(){try{const t=ue(),u=JSON.stringify(t,null,2),d=new Blob([u],{type:"application/json"}),R=URL.createObjectURL(d),O=document.createElement("a");O.href=R,O.download=`\u6253\u5370\u6A21\u677F_${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(O),O.click(),document.body.removeChild(O),URL.revokeObjectURL(R),i.success("\u6A21\u677F\u5BFC\u51FA\u6210\u529F")}catch(t){console.error("\u5BFC\u51FA\u6A21\u677F\u5931\u8D25:",t),i.error("\u5BFC\u51FA\u6A21\u677F\u5931\u8D25")}}function te(){try{const t=y.value.length>0?{fields:y.value}:{};le(t),i.success("\u6253\u5370\u9884\u89C8\u5DF2\u751F\u6210")}catch(t){console.error("\u6253\u5370\u9884\u89C8\u5931\u8D25:",t),i.error("\u6253\u5370\u9884\u89C8\u5931\u8D25")}}function ce(t,u=!1){try{if(!t||Array.isArray(t)&&t.length===0){i.warning("\u6CA1\u6709\u53EF\u6253\u5370\u7684\u6570\u636E");return}if(u){const d=`\u6253\u5370\u6570\u636E_${new Date().toISOString().split("T")[0]}.pdf`;ve(t,d),i.success("PDF\u5BFC\u51FA\u6210\u529F")}else le(t),i.success("\u6253\u5370\u9884\u89C8\u5DF2\u751F\u6210");console.log("\u6253\u5370\u6570\u636E\u7ED3\u6784:",JSON.stringify(t))}catch(d){console.error("\u6253\u5370\u5904\u7406\u5931\u8D25:",d),i.error("\u6253\u5370\u5904\u7406\u5931\u8D25: "+(d.message||String(d)))}}function we(){try{const t=m?m.getJson():{},u=JSON.parse(JSON.stringify(y.value||[])).map(K=>({id:K.id,name:K.name,type:K.type,displayName:K.displayName||K.name})),d=JSON.parse(JSON.stringify(window.fieldTestData||{})),R={template:t,fields:u,testData:d},O=JSON.stringify(R);try{const K=btoa(encodeURIComponent(O)),Y=window.location.origin+window.location.pathname+"#/template-designer?data="+K;if(Y.length>2e3)throw new Error("URL too long");const Z=window.open(Y,"_blank","width=1200,height=800");if(!Z||Z.closed||typeof Z.closed>"u"){i.error("\u5F39\u7A97\u88AB\u6D4F\u89C8\u5668\u963B\u6B62\uFF0C\u8BF7\u5141\u8BB8\u5F39\u7A97\u540E\u91CD\u8BD5");return}i.success("\u6B63\u5728\u6253\u5F00\u6A21\u677F\u8BBE\u8BA1\u5668")}catch(K){console.warn("URL\u6570\u636E\u8FC7\u5927\uFF0C\u5C1D\u8BD5\u7B80\u5316\u6570\u636E:",K);const ye={template:t,fields:u.map(ze=>({id:ze.id,name:ze.name,type:ze.type}))},Y=JSON.stringify(ye),Z=btoa(encodeURIComponent(Y)),Ce=window.location.origin+window.location.pathname+"#/template-designer?data="+Z,Je=window.open(Ce,"_blank","width=1200,height=800");if(!Je||Je.closed||typeof Je.closed>"u"){i.error("\u5F39\u7A97\u88AB\u6D4F\u89C8\u5668\u963B\u6B62\uFF0C\u8BF7\u5141\u8BB8\u5F39\u7A97\u540E\u91CD\u8BD5");return}i.success("\u6B63\u5728\u6253\u5F00\u6A21\u677F\u8BBE\u8BA1\u5668\uFF08\u6570\u636E\u5DF2\u7B80\u5316\uFF09")}}catch(t){console.error("\u6253\u5F00\u6A21\u677F\u8BBE\u8BA1\u5668\u5931\u8D25:",t),i.error("\u6253\u5F00\u6A21\u677F\u8BBE\u8BA1\u5668\u5931\u8D25: "+(t.message||String(t)))}}async function Pe(){return new Promise(t=>{try{const u=localStorage.getItem("templateDesignerData");if(!u){console.log("\u6CA1\u6709\u627E\u5230\u4FDD\u5B58\u7684\u6A21\u677F\u6570\u636E"),t(!1);return}try{const d=JSON.parse(u);console.log("\u53D1\u73B0\u4FDD\u5B58\u7684\u6A21\u677F\u6570\u636E"),d&&d.template?(console.log("\u6B63\u5728\u5BFC\u5165\u6A21\u677F..."),H(d.template),localStorage.removeItem("templateDesignerData"),console.log("\u5DF2\u5220\u9664\u4FDD\u5B58\u7684\u6A21\u677F\u6570\u636E"),i.success("\u5DF2\u6210\u529F\u5BFC\u5165\u6A21\u677F\u8BBE\u8BA1\u5668\u4E2D\u4FDD\u5B58\u7684\u6A21\u677F"),t(!0)):(console.warn("\u4FDD\u5B58\u7684\u6A21\u677F\u6570\u636E\u4E0D\u5B8C\u6574"),t(!1))}catch(d){console.error("\u89E3\u6790\u4FDD\u5B58\u7684\u6A21\u677F\u6570\u636E\u5931\u8D25:",d),i.error("\u89E3\u6790\u4FDD\u5B58\u7684\u6A21\u677F\u6570\u636E\u5931\u8D25: "+(d.message||String(d))),t(!1)}}catch(u){console.error("\u68C0\u67E5\u4FDD\u5B58\u7684\u6A21\u677F\u5931\u8D25:",u),t(!1)}})}function Oe(t){try{t.data&&t.data.type==="TEMPLATE_SAVED"&&(console.log("\u6536\u5230\u6A21\u677F\u8BBE\u8BA1\u9875\u9762\u53D1\u9001\u7684\u6A21\u677F\u6570\u636E"),t.data.template?(H(t.data.template),i.success("\u5DF2\u6210\u529F\u5BFC\u5165\u6A21\u677F\u8BBE\u8BA1\u5668\u4E2D\u4FDD\u5B58\u7684\u6A21\u677F")):(console.warn("\u6536\u5230\u7684\u6A21\u677F\u6570\u636E\u4E0D\u5B8C\u6574"),i.warning("\u6536\u5230\u7684\u6A21\u677F\u6570\u636E\u4E0D\u5B8C\u6574")))}catch(u){console.error("\u5904\u7406\u6A21\u677F\u8BBE\u8BA1\u9875\u9762\u6D88\u606F\u5931\u8D25:",u),i.error("\u5904\u7406\u6A21\u677F\u8BBE\u8BA1\u9875\u9762\u6D88\u606F\u5931\u8D25: "+(u.message||String(u)))}}async function Ne(){try{if(!T.value){i.warning("\u8BF7\u8F93\u5165\u6A21\u677F\u540D\u79F0");return}const t=m.getJson(),u=JSON.parse(JSON.stringify(t));await _e(T.value,u,T.value),i.success("\u6A21\u677F\u5DF2\u4FDD\u5B58\u5230\u672C\u5730\u6570\u636E\u5E93"),await he()}catch(t){console.error("\u4FDD\u5B58\u6A21\u677F\u5931\u8D25:",t),i.error("\u4FDD\u5B58\u6A21\u677F\u5931\u8D25: "+(t.message||String(t)))}}async function he(){try{const t=await qe();$.value=t}catch(t){console.error("\u52A0\u8F7D\u6A21\u677F\u5217\u8868\u5931\u8D25:",t),i.error("\u52A0\u8F7D\u6A21\u677F\u5217\u8868\u5931\u8D25: "+(t.message||String(t)))}}function r(t){try{if(!t){i.warning("\u6A21\u677F\u6570\u636E\u4E3A\u7A7A");return}console.log("\u4ECE\u6A21\u677F\u7BA1\u7406\u5668\u52A0\u8F7D\u6A21\u677F\u6570\u636E:",t),E.value="design",ou(()=>{try{if(!document.getElementById("hiprint-printTemplate")){console.error("\u627E\u4E0D\u5230\u6A21\u677F\u5BB9\u5668\u5143\u7D20"),i.error("\u6A21\u677F\u5BB9\u5668\u672A\u51C6\u5907\u597D\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5");return}let d=t;typeof t=="string"&&(d=JSON.parse(t)),console.log("\u51C6\u5907\u5BFC\u5165\u7684\u539F\u59CB\u6A21\u677F\u6570\u636E:",d),H(d),setTimeout(()=>{U()},200),i.success("\u6A21\u677F\u5DF2\u6210\u529F\u52A0\u8F7D\u5230\u8BBE\u8BA1\u5668")}catch(u){console.error("\u5BFC\u5165\u6A21\u677F\u65F6\u53D1\u751F\u9519\u8BEF:",u),i.error("\u5BFC\u5165\u6A21\u677F\u5931\u8D25: "+(u.message||String(u)))}})}catch(u){console.error("\u52A0\u8F7D\u6A21\u677F\u5931\u8D25:",u),i.error("\u52A0\u8F7D\u6A21\u677F\u5931\u8D25: "+(u.message||String(u)))}}async function n(){try{const t=m.getJson();if(t&&Object.keys(t).length>0&&(t.printElements||[]).length>0){console.log("\u5DF2\u6709\u6A21\u677F\u6570\u636E\uFF0C\u4E0D\u9700\u8981\u52A0\u8F7D\u9ED8\u8BA4\u6A21\u677F");return}const d=await qe();if(d&&d.length>0){const O=d[0];console.log(`\u4ECE\u6570\u636E\u5E93\u52A0\u8F7D\u6A21\u677F: ${O.id}`),H(O.data),h.value=O.id,T.value=O.description||O.id,i.success(`\u5DF2\u81EA\u52A8\u52A0\u8F7D\u6A21\u677F: ${O.id}`);return}console.log("\u6570\u636E\u5E93\u4E2D\u6CA1\u6709\u6A21\u677F\uFF0C\u4F7F\u7528\u9ED8\u8BA4\u7A7A\u767D\u6A21\u677F");const R={width:210,height:297,paperHeader:0,paperFooter:0,printElements:[]};m.clear(),m.setPaper("A4"),m.design("#hiprint-printTemplate",{grid:!0})}catch(t){console.error("\u52A0\u8F7D\u9ED8\u8BA4\u6A21\u677F\u5931\u8D25:",t)}}function f(){v.push("/help")}return(t,u)=>(w(),S("div",Fa,[a("div",fa,[a("div",va,[a("div",ma,[l(e(_),{class:"header-icon"},{default:s(()=>[l(e(pe))]),_:1}),u[6]||(u[6]=a("div",{class:"header-text"},[a("h1",null,"\u6253\u5370\u6A21\u677F\u8BBE\u8BA1\u7CFB\u7EDF"),a("p",{class:"header-subtitle"},"\u4E13\u4E1A\u7684\u6A21\u677F\u8BBE\u8BA1\u4E0E\u6570\u636E\u6253\u5370\u5DE5\u5177")],-1))]),a("div",ga,[l(e(k),{onClick:f,type:"primary",size:"small",icon:e(Tu)},{default:s(()=>u[7]||(u[7]=[A(" \u4F7F\u7528\u5E2E\u52A9 ")])),_:1,__:[7]},8,["icon"])])])]),p.value?(w(),S("div",Ba,[l(e(_),null,{default:s(()=>[l(e(Xe))]),_:1}),a("span",null,L(p.value),1)])):G("",!0),C.value?(w(),S("div",Ea,[l(e(_),null,{default:s(()=>[l(e(Ye))]),_:1}),a("span",null,L(C.value),1)])):G("",!0),e(B)?(w(),S("div",Da,u[8]||(u[8]=[a("div",{class:"loading-content"},[a("div",{class:"loading-spinner"}),a("div",{class:"loading-text"},"\u7CFB\u7EDF\u521D\u59CB\u5316\u4E2D..."),a("div",{class:"loading-subtitle"},"\u8BF7\u7A0D\u5019\uFF0C\u6B63\u5728\u52A0\u8F7D\u7EC4\u4EF6\u548C\u6570\u636E")],-1)]))):G("",!0),lu(a("div",Aa,[a("div",wa,[a("div",ha,[(w(!0),S(ie,null,de(M.value,d=>(w(),S("button",{key:d.name,class:fu(["tab-button",{active:E.value===d.name}]),"data-tab":d.name,onClick:R=>E.value=d.name},[a("div",Ca,[d.icon?(w(),ae(e(_),{key:0},{default:s(()=>[(w(),ae(vu(d.icon)))]),_:2},1024)):(w(),S("span",_a,L(d.emoji),1))]),a("span",null,L(d.label),1)],10,ya))),128))])]),a("div",ba,[E.value==="design"?(w(),S("div",Sa,[a("div",Ta,[a("h3",null,[l(e(_),null,{default:s(()=>[l(e(re))]),_:1}),u[9]||(u[9]=A(" \u6A21\u677F\u8BBE\u8BA1 "))]),u[10]||(u[10]=a("p",null,"\u62D6\u62FD\u5143\u7D20\u5230\u753B\u5E03\uFF0C\u8BBE\u8BA1\u60A8\u7684\u6253\u5370\u6A21\u677F",-1))]),a("div",$a,[a("div",ka,[a("div",Ia,[l(e(_),null,{default:s(()=>[l(e(Fu))]),_:1})]),u[12]||(u[12]=a("div",{class:"banner-text"},[a("h4",null,"\u{1F4A1} \u63A8\u8350\u4F7F\u7528\u72EC\u7ACB\u8BBE\u8BA1\u5668"),a("p",null,"\u4E3A\u4E86\u83B7\u5F97\u66F4\u597D\u7684\u8BBE\u8BA1\u4F53\u9A8C\uFF0C\u5EFA\u8BAE\u4F7F\u7528\u72EC\u7ACB\u8BBE\u8BA1\u5668\u8FDB\u884C\u6A21\u677F\u8BBE\u8BA1\uFF0C\u529F\u80FD\u66F4\u5B8C\u6574\uFF0C\u64CD\u4F5C\u66F4\u6D41\u7545\uFF01")],-1)),a("div",Va,[l(e(k),{type:"primary",size:"small",onClick:we,class:"recommend-button"},{default:s(()=>[l(e(_),null,{default:s(()=>[l(e(re))]),_:1}),u[11]||(u[11]=A(" \u7ACB\u5373\u4F7F\u7528 "))]),_:1,__:[11]})])])]),a("div",xa,[a("div",Pa,[a("div",Oa,[a("div",Na,[l(e(_),{class:"group-icon"},{default:s(()=>[l(e(re))]),_:1}),u[13]||(u[13]=a("span",{class:"group-title"},"\u6A21\u677F\u7BA1\u7406",-1))]),a("div",Ja,[a("div",za,[u[14]||(u[14]=a("label",{class:"input-label"},"\u6A21\u677F\u540D\u79F0",-1)),l(e(fe),{modelValue:T.value,"onUpdate:modelValue":u[0]||(u[0]=d=>T.value=d),placeholder:"\u8F93\u5165\u6A21\u677F\u540D\u79F0",size:"small",class:"template-name-input"},null,8,["modelValue"])]),l(e(k),{type:"primary",size:"small",onClick:Ne,icon:e(Ae),class:"action-button save-button"},{default:s(()=>u[15]||(u[15]=[A(" \u4FDD\u5B58\u6A21\u677F ")])),_:1,__:[15]},8,["icon"])])]),u[24]||(u[24]=a("div",{class:"toolbar-divider"},null,-1)),a("div",Ra,[a("div",La,[l(e(_),{class:"group-icon"},{default:s(()=>[l(e(ge))]),_:1}),u[16]||(u[16]=a("span",{class:"group-title"},"\u6A21\u677F\u64CD\u4F5C",-1))]),a("div",ja,[l(e(Iu),{onCommand:x,trigger:"click",class:"operation-dropdown"},{dropdown:s(()=>[l(e($u),{class:"custom-dropdown-menu"},{default:s(()=>[l(e(nu),{command:"export",icon:e(Ae)},{default:s(()=>u[18]||(u[18]=[a("span",{class:"dropdown-item-text"},"\u5BFC\u51FAJSON",-1)])),_:1,__:[18]},8,["icon"]),l(e(nu),{command:"import",icon:e(Ee)},{default:s(()=>u[19]||(u[19]=[a("span",{class:"dropdown-item-text"},"\u5BFC\u5165\u6A21\u677F",-1)])),_:1,__:[19]},8,["icon"])]),_:1})]),default:s(()=>[l(e(k),{type:"info",size:"small",icon:e(ge),class:"action-button"},{default:s(()=>[u[17]||(u[17]=A(" \u6A21\u677F\u64CD\u4F5C ")),l(e(_),{class:"el-icon--right"},{default:s(()=>[l(e(ku))]),_:1})]),_:1,__:[17]},8,["icon"])]),_:1}),a("div",Ua,[u[20]||(u[20]=a("label",{class:"input-label"},"\u7EB8\u5F20\u5927\u5C0F",-1)),l(e(Te),{modelValue:z.value,"onUpdate:modelValue":u[1]||(u[1]=d=>z.value=d),placeholder:"\u9009\u62E9\u7EB8\u5F20",size:"small",onChange:b,class:"paper-select"},{default:s(()=>[(w(!0),S(ie,null,de(I.value,d=>(w(),ae(e($e),{key:d.value,label:d.label,value:d.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])])]),u[25]||(u[25]=a("div",{class:"toolbar-divider"},null,-1)),a("div",Ma,[a("div",Ha,[l(e(_),{class:"group-icon"},{default:s(()=>[l(e(pe))]),_:1}),u[21]||(u[21]=a("span",{class:"group-title"},"\u9884\u89C8\u4E0E\u8BBE\u8BA1",-1))]),a("div",Ga,[l(e(k),{type:"success",size:"small",onClick:we,class:"action-button designer-button"},{default:s(()=>[l(e(_),null,{default:s(()=>[l(e(re))]),_:1}),u[22]||(u[22]=A(" \u72EC\u7ACB\u8BBE\u8BA1\u5668 "))]),_:1,__:[22]}),l(e(k),{type:"warning",size:"small",onClick:te,class:"action-button preview-button"},{default:s(()=>[l(e(_),null,{default:s(()=>[l(e(pe))]),_:1}),u[23]||(u[23]=A(" \u6253\u5370\u9884\u89C8 "))]),_:1,__:[23]})])])])]),a("div",qa,[a("div",Ka,[a("div",Wa,[l(e(_),null,{default:s(()=>[l(e(ge))]),_:1}),u[26]||(u[26]=a("span",null,"\u5143\u7D20\u5E93",-1))]),u[27]||(u[27]=a("div",{id:"provider-container",class:"provider-container"},null,-1))]),u[30]||(u[30]=a("div",{class:"canvas-panel"},[a("div",{class:"canvas-header"},[a("span",null,"\u8BBE\u8BA1\u753B\u5E03")]),a("div",{id:"hiprint-printTemplate",class:"template-container"})],-1)),a("div",Xa,[a("div",Ya,[l(e(_),null,{default:s(()=>[l(e(ge))]),_:1}),u[28]||(u[28]=a("span",null,"\u5C5E\u6027\u8BBE\u7F6E",-1))]),u[29]||(u[29]=a("div",{id:"PrintElementOptionSetting",class:"setting-container"},null,-1))])])])):E.value==="print"?(w(),S("div",Qa,[a("div",Za,[a("h3",null,[l(e(_),null,{default:s(()=>[l(e(pe))]),_:1}),u[31]||(u[31]=A(" \u6570\u636E\u6253\u5370 "))]),u[32]||(u[32]=a("p",null,"\u9009\u62E9\u6570\u636E\u5E76\u6267\u884C\u6253\u5370\u64CD\u4F5C",-1))]),l(ft,{hiprintTemplate:e(m),initialFields:y.value,initialRecords:g.value,onPrint:ce},null,8,["hiprintTemplate","initialFields","initialRecords"])])):E.value==="template-manager"?(w(),S("div",el,[a("div",ul,[a("h3",null,[l(e(_),null,{default:s(()=>[l(e(Me))]),_:1}),u[33]||(u[33]=A(" \u6A21\u677F\u7BA1\u7406 "))]),u[34]||(u[34]=a("p",null,"\u7BA1\u7406\u60A8\u7684\u6253\u5370\u6A21\u677F",-1))]),l(pa,{hiprintTemplate:e(m),onLoadTemplate:r},null,8,["hiprintTemplate"])])):E.value==="field-info"?(w(),S("div",tl,[a("div",al,[a("h3",null,[l(e(_),null,{default:s(()=>[l(e(Ue))]),_:1}),u[35]||(u[35]=A(" \u5B57\u6BB5\u4FE1\u606F "))]),u[36]||(u[36]=a("p",null,"\u67E5\u770B\u5F53\u524D\u8868\u683C\u7684\u5B57\u6BB5\u4FE1\u606F",-1))]),l(Ot)])):G("",!0)])],512),[[su,!e(B)]]),lu(a("div",ll,null,512),[[su,!e(B)&&E.value==="design"]]),l(e(Qe),{modelValue:J.value,"onUpdate:modelValue":u[5]||(u[5]=d=>J.value=d),title:"\u81EA\u5B9A\u4E49\u7EB8\u5F20\u5927\u5C0F",width:"400px","close-on-click-modal":!1,"show-close":!0},{footer:s(()=>[a("span",sl,[l(e(k),{onClick:u[4]||(u[4]=d=>J.value=!1)},{default:s(()=>u[37]||(u[37]=[A("\u53D6\u6D88")])),_:1,__:[37]}),l(e(k),{type:"primary",onClick:o},{default:s(()=>u[38]||(u[38]=[A("\u786E\u8BA4")])),_:1,__:[38]})])]),default:s(()=>[l(e(gu),{model:P.value,"label-width":"100px"},{default:s(()=>[l(e(ke),{label:"\u5BBD\u5EA6 (mm)"},{default:s(()=>[l(e(fe),{modelValue:P.value.width,"onUpdate:modelValue":u[2]||(u[2]=d=>P.value.width=d),type:"number",min:"1",placeholder:"\u8BF7\u8F93\u5165\u7EB8\u5F20\u5BBD\u5EA6"},null,8,["modelValue"])]),_:1}),l(e(ke),{label:"\u9AD8\u5EA6 (mm)"},{default:s(()=>[l(e(fe),{modelValue:P.value.height,"onUpdate:modelValue":u[3]||(u[3]=d=>P.value.height=d),type:"number",min:"1",placeholder:"\u8BF7\u8F93\u5165\u7EB8\u5F20\u9AD8\u5EA6"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])]))}}),il=xe(nl,[["__scopeId","data-v-7c633a07"]]);export{il as default};
