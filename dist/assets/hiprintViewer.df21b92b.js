import{p as Q,d as Ye,r as A,c as Se,w as Me,o as Ie,E as c,a as C,b as $,e as u,f as a,g as n,h as w,u as e,i as we,j as I,k as T,l as De,t as M,m as $e,n as ne,q as lu,s as W,v as Ee,F as Fe,x as pe,y as ke,z as pu,A as Au,B as wu,C as fu,D as ve,G as vu,H as Cu,I as hu,J as fe,K as Ce,L as Ae,M as Ze,N as yu,O as _u,P as je,Q as Qe,R as gu,S as eu,T as bu,U as uu,V as Pe,_ as xe,W as Ue,X as mu,Y as Bu,Z as Ge,$ as Tu,a0 as Eu,a1 as Su,a2 as He,a3 as ge,a4 as ou,a5 as Du,a6 as Ve,a7 as qe,a8 as ie,a9 as $u,aa as ku,ab as _e,ac as ae,ad as de,ae as Pu,af as ru,ag as iu,ah as Vu,ai as Le,aj as Iu,ak as xu,al as cu}from"./index.6449b499.js";import{c as du,a as Ou,b as Nu,C as be}from"./windowMessenger.ef61f220.js";async function tu(f,v){try{const i=await Q.base.getTableById(f),g=await(await i.getViewById(v)).getVisibleFieldIdList();return await Promise.all(g.map(async p=>{const m=await i.getFieldById(p);return{id:p,name:await m.getName(),type:m.type}}))}catch(i){throw console.error("\u83B7\u53D6\u5B57\u6BB5\u4FE1\u606F\u65F6\u51FA\u9519:",i),i}}const Be=f=>{if(Array.isArray(f)&&f.length>0){const v=f[0];if(!v||typeof v!="object")return v;if(v.type&&v.type.includes("image"))return v.token;if("id"in v||v.type==="text")return v.text}return f},Ke=(f,v)=>{if(f===null)return"\u7A7A";switch(v){case 1:return Be(f);case 2:return f;case 3:return f.text;case 4:return f.text;case 5:return new Date(f).toLocaleString();case 7:return f;case 11:return f;case 13:return f;case 15:return f;case 17:return Be(f);case 18:return f.text;case 19:return Be(f);case 20:return Be(f);case 21:return f;case 22:return f;case 23:return f;case 1001:return new Date(f).toLocaleString();case 1002:return new Date(f).toLocaleString();case 1003:return f.map(i=>i.name).join(",");case 1004:return f.map(i=>i.name).join(",");case 1005:return f&&f.status==="completed"?f.value:f;case 99001:return Be(f);case 99002:return f;case 99003:return f;case 99004:return f;case 99005:return f;default:return f}};async function We(f,v=3,i=1e3){try{return await f()}catch(D){if(v===0)throw D;return await new Promise(g=>setTimeout(g,i)),We(f,v-1,i)}}async function he(f,v,i=null,D=!1,g=null,B=null){try{const p=await Q.base.getTableById(f),N=await(await p.getViewById(v)).getVisibleFieldIdList(),y=await Promise.all(N.map(async k=>{const S=await p.getFieldById(k);return{id:k,name:await S.getName(),type:S.type}}));if(i){const k=[];for(const h of y)try{const R=await p.getFieldById(h.id),X=await We(async()=>{try{return await R.getValue(i)}catch(q){throw console.warn(`\u83B7\u53D6\u5B57\u6BB5 ${h.id} \u7684\u503C\u5931\u8D25\uFF0C\u6B63\u5728\u91CD\u8BD5...`,q),q}}),ee=D?Ke(X,h.type):null;k.push({name:h.name,value:D?ee:X,type:h.type,field:h.id})}catch(R){console.warn(`\u83B7\u53D6\u5B57\u6BB5 ${h.id} \u7684\u503C\u5931\u8D25:`,R),k.push({name:h.name,value:null,type:h.type,field:h.id})}const S=[{recordId:i,field:k}];return g&&typeof g=="function"&&g(S),S}const _=[];let j=null,z=!0,J=0;for(;z;){J++;let k=200;if(B&&B>0){const U=B-_.length;if(U<=0)break;k=Math.min(200,U)}const S=await p.getRecords({pageSize:k,pageToken:j,viewId:v}),{records:h,pageToken:R}=S,X=h.map(async U=>{try{const K=[];for(const G of y)try{const d=await p.getFieldById(G.id),o=await We(async()=>{try{return await d.getValue(U.recordId)}catch(P){throw console.warn(`\u83B7\u53D6\u5B57\u6BB5 ${G.id} \u7684\u503C\u5931\u8D25\uFF0C\u6B63\u5728\u91CD\u8BD5...`,P),P}}),b=D?Ke(o,G.type):null;K.push({name:G.name,value:D?b:o,type:G.type,field:G.id})}catch(d){console.warn(`\u83B7\u53D6\u5B57\u6BB5 ${G.id} \u7684\u503C\u5931\u8D25:`,d),K.push({name:G.name,value:null,type:G.type,field:G.id})}return{recordId:U.recordId,field:K}}catch(K){return console.warn("\u5904\u7406\u8BB0\u5F55\u65F6\u51FA\u9519:",K),null}}),q=(await Promise.all(X)).filter(Boolean);if(B&&B>0){const U=B-_.length,K=q.slice(0,U);_.push(...K),_.length>=B&&(z=!1)}else _.push(...q);if(g&&typeof g=="function"){const U=!R||B&&_.length>=B;g(_.slice(),J,U)}B&&_.length>=B?z=!1:(z=!!R,j=R)}return _}catch(p){throw console.error("\u83B7\u53D6\u8BB0\u5F55\u548C\u5B57\u6BB5\u503C\u65F6\u51FA\u9519:",p),p}}async function zu(f){try{return(await(await Q.base.getTableById(f)).getFieldMetaList()).filter(g=>g.type===17)}catch(v){throw console.error("\u83B7\u53D6\u9644\u4EF6\u5B57\u6BB5\u5931\u8D25:",v),v}}async function Ju(f,v=1){try{if(!window.pdfjsLib)throw new Error("PDF.js \u5E93\u672A\u52A0\u8F7D");const i=await f.arrayBuffer(),g=await window.pdfjsLib.getDocument({data:i}).promise;if(v<1||v>g.numPages)throw new Error(`\u65E0\u6548\u7684\u9875\u7801: ${v}\uFF0C\u6587\u6863\u5171\u6709 ${g.numPages} \u9875`);const B=await g.getPage(v),p=window.devicePixelRatio||2,m=B.getViewport({scale:p}),N=document.createElement("canvas"),y=N.getContext("2d");N.width=m.width,N.height=m.height;const _={canvasContext:y,viewport:m};return await B.render(_).promise,new Promise((j,z)=>{try{N.toBlob(J=>{J?j(J):z(new Error("\u8F6C\u6362\u4E3ABlob\u5931\u8D25"))},"image/jpeg",1)}catch(J){z(J)}})}catch(i){throw console.error("PDF\u8F6C\u56FE\u7247\u5931\u8D25:",i),i}}async function ju(f,v,i=1){try{const D=await Ju(f,i);return new File([D],`${v}.jpg`,{type:"image/jpeg"})}catch(D){throw console.error("PDF\u8F6C\u56FE\u7247\u6587\u4EF6\u5931\u8D25:",D),D}}async function Lu(f,v=1){try{if(!window.pdfjsLib)throw new Error("PDF.js \u5E93\u672A\u52A0\u8F7D");const i=await f.arrayBuffer(),g=await window.pdfjsLib.getDocument({data:i}).promise;if(v<1||v>g.numPages)throw new Error(`\u65E0\u6548\u7684\u9875\u7801: ${v}\uFF0C\u6587\u6863\u5171\u6709 ${g.numPages} \u9875`);const B=await g.getPage(v),p=window.devicePixelRatio||8,m=B.getViewport({scale:p*2}),N=document.createElement("canvas"),y=N.getContext("2d");N.width=m.width,N.height=m.height;const _={canvasContext:y,viewport:m};return await B.render(_).promise,new Promise((j,z)=>{try{N.toBlob(J=>{J?j(J):z(new Error("\u8F6C\u6362\u4E3APNG Blob\u5931\u8D25"))},"image/png")}catch(J){z(J)}})}catch(i){throw console.error("PDF\u8F6CPNG\u56FE\u7247\u5931\u8D25:",i),i}}async function Ru(f,v,i=1){try{const D=await Lu(f,i);return new File([D],`${v}.png`,{type:"image/png"})}catch(D){throw console.error("PDF\u8F6CPNG\u56FE\u7247\u6587\u4EF6\u5931\u8D25:",D),D}}const Mu={class:"print-data-selector"},Uu={class:"toolbar"},Gu={class:"toolbar-section"},Hu={key:0,class:"data-stats"},qu={class:"field-selection-card"},Ku={class:"card-header"},Wu={key:0,class:"data-preview-card"},Xu={class:"card-header"},Yu={class:"selection-controls"},Zu={class:"data-table-wrapper"},Qu={class:"field-value"},et={class:"pagination-container"},ut={class:"action-buttons-card"},tt={class:"card-header"},at={class:"button-grid"},st={key:1,class:"empty-state"},nt={key:0,class:"export-dialog-content"},lt={class:"field-selection-section"},ot={class:"section-header"},rt={class:"format-selection-section"},it={class:"section-header"},ct={class:"tips-section"},dt={class:"tip-item"},Ft={class:"tip-item"},pt={key:1,class:"export-progress-container"},ft={class:"progress-header"},vt={class:"progress-info"},gt={class:"progress-text"},mt={class:"progress-percentage"},Bt={class:"dialog-footer"},Re=200,Et=Ye({__name:"PrintDataSelector",props:{hiprintTemplate:{},initialFields:{},initialRecords:{}},emits:["print"],setup(f,{emit:v}){const i=f,D=v,g=A([]),B=A([]),p=A([]),m=A([]),N=A(!1),y=A(null),_=A(1),j=A(20),z=Se(()=>{const r=(_.value-1)*j.value;return p.value.slice(r,r+j.value)}),J=Se(()=>B.value.length===0?g.value.slice(0,4):g.value.filter(r=>B.value.includes(r.id)));Me(()=>i.initialFields,r=>{r&&r.length>0&&(g.value=r,B.value=r.slice(0,4).map(l=>l.id))},{immediate:!0}),Me(()=>i.initialRecords,r=>{r&&r.length>0&&(p.value=r)},{immediate:!0}),Ie(async()=>{(!i.initialFields||i.initialFields.length===0)&&await S()});function k(r){return r==null?"":Array.isArray(r)?r.join(", "):typeof r=="object"?JSON.stringify(r):String(r)}async function S(){try{const r=await Q.base.getActiveTable(),l=await r.getActiveView(),E=r.id,V=l.id;g.value=await tu(E,V),B.value=g.value.slice(0,4).map(O=>O.id)}catch(r){console.error("\u83B7\u53D6\u5B57\u6BB5\u4FE1\u606F\u5931\u8D25:",r),c.error("\u83B7\u53D6\u5B57\u6BB5\u4FE1\u606F\u5931\u8D25: "+(r.message||String(r)))}}async function h(){N.value=!0,p.value=[],m.value=[],_.value=1;try{const r=await Q.base.getActiveTable(),l=await r.getActiveView(),E=r.id,V=l.id,O=await he(E,V,Re,!0);p.value=O.map(s=>{const t={recordId:s.recordId,field:s.field};return s.field&&s.field.forEach(F=>{t[F.field]=F.value}),t}),O.length>=Re?c.warning(`\u5DF2\u83B7\u53D6 ${O.length} \u6761\u8BB0\u5F55\uFF0C\u8FBE\u5230\u6700\u5927\u9650\u5236 ${Re} \u6761`):c.success(`\u5DF2\u83B7\u53D6 ${O.length} \u6761\u8BB0\u5F55`)}catch(r){console.error("\u83B7\u53D6\u8BB0\u5F55\u6570\u636E\u5931\u8D25:",r),c.error("\u83B7\u53D6\u8BB0\u5F55\u6570\u636E\u5931\u8D25: "+(r.message||String(r)))}finally{N.value=!1}}function R(r){m.value=r}function X(r){j.value=r,_.value=1,y.value&&y.value.clearSelection()}function ee(r){_.value=r,y.value&&setTimeout(()=>{y.value.clearSelection(),z.value.forEach(l=>{m.value.some(E=>E.recordId===l.recordId)&&y.value.toggleRowSelection(l,!0)})},0)}function q(){if(m.value.length===0){c.warning("\u8BF7\u5148\u9009\u62E9\u8981\u6253\u5370\u7684\u6570\u636E");return}try{const r=K();D("print",r),c.success("\u5DF2\u53D1\u9001\u6253\u5370\u8BF7\u6C42")}catch(r){console.error("\u51C6\u5907\u6253\u5370\u6570\u636E\u5931\u8D25:",r),c.error("\u51C6\u5907\u6253\u5370\u6570\u636E\u5931\u8D25: "+(r.message||String(r)))}}function U(){if(m.value.length===0){c.warning("\u8BF7\u5148\u9009\u62E9\u8981\u5BFC\u51FA\u7684\u6570\u636E");return}try{const r=K();D("print",r,!0),c.success("\u5DF2\u53D1\u9001PDF\u5BFC\u51FA\u8BF7\u6C42")}catch(r){console.error("\u51C6\u5907\u5BFC\u51FA\u6570\u636E\u5931\u8D25:",r),c.error("\u51C6\u5907\u5BFC\u51FA\u6570\u636E\u5931\u8D25: "+(r.message||String(r)))}}function K(){try{const r=du(!0),l={fields:g.value,recordsData:p.value,testData:{}},E=r.prepareMultiplePrintData(l,m.value,{includeTableData:!0,maxRecords:100}),V=r.validatePrintData(E);if(!V.isValid)throw console.error("\u6253\u5370\u6570\u636E\u9A8C\u8BC1\u5931\u8D25:",V.errors),new Error("\u6253\u5370\u6570\u636E\u65E0\u6548: "+V.errors.join(", "));return console.log("\u51C6\u5907\u7684\u6253\u5370\u6570\u636E:",E),console.log("\u6570\u636E\u9A8C\u8BC1\u7ED3\u679C:",V),E}catch(r){throw console.error("\u51C6\u5907\u6253\u5370\u6570\u636E\u5931\u8D25:",r),r}}function G(){y.value&&(y.value.clearSelection(),p.value.forEach(r=>{y.value.toggleRowSelection(r,!0)}),m.value=[...p.value])}function d(){if(y.value){z.value.forEach(l=>{y.value.toggleRowSelection(l,!1)}),z.value.forEach(l=>{y.value.toggleRowSelection(l,!0)});const r=m.value.filter(l=>!z.value.some(E=>E.recordId===l.recordId));m.value=[...r,...z.value]}}function o(){y.value&&(y.value.clearSelection(),m.value=[])}function b(){if(y.value){y.value.clearSelection(),z.value.forEach(V=>{const O=m.value.some(s=>s.recordId===V.recordId);y.value.toggleRowSelection(V,!O)});const r=z.value,l=m.value.filter(V=>!r.some(O=>O.recordId===V.recordId)),E=r.filter(V=>!m.value.some(O=>O.recordId===V.recordId));m.value=[...l,...E]}}const P=A([]),x=A(""),Y=A(!1),oe=A(0),me=A(0),re=A(0),se=A(!1),le=A("pdf");async function Oe(){try{const l=(await Q.base.getActiveTable()).id,E=await zu(l);P.value=E,E.length>0&&(x.value=E[0].id)}catch(r){console.error("\u83B7\u53D6\u9644\u4EF6\u5B57\u6BB5\u5931\u8D25:",r),c.error("\u83B7\u53D6\u9644\u4EF6\u5B57\u6BB5\u5931\u8D25: "+(r.message||String(r)))}}async function Ne(){if(m.value.length===0){c.warning("\u8BF7\u5148\u9009\u62E9\u8981\u5BFC\u51FA\u7684\u6570\u636E");return}if(await Oe(),P.value.length===0){c.warning("\u5F53\u524D\u8868\u683C\u4E2D\u6CA1\u6709\u9644\u4EF6\u7C7B\u578B\u5B57\u6BB5\uFF0C\u8BF7\u5148\u6DFB\u52A0\u9644\u4EF6\u5B57\u6BB5");return}Y.value=!0}async function ye(){if(!x.value){c.warning("\u8BF7\u9009\u62E9\u4E00\u4E2A\u9644\u4EF6\u5B57\u6BB5");return}try{se.value=!0,oe.value=0,me.value=m.value.length,re.value=0;const l=await(await Q.base.getActiveTable()).getFieldById(x.value);for(const V of m.value){re.value++;try{const O=ze(V),s=await Je(O);if(!s)throw new Error("\u751F\u6210PDF\u5931\u8D25");const t=`\u8BB0\u5F55_${V.recordId}_${new Date().toISOString().split("T")[0]}`;let F;le.value==="pdf"?F=new File([s],`${t}.pdf`,{type:"application/pdf"}):le.value==="jpeg"?F=await ju(s,t):le.value==="png"&&(F=await Ru(s,t)),await l.setValue(V.recordId,F),oe.value=re.value/me.value*100,await new Promise(H=>setTimeout(H,300))}catch(O){console.error(`\u5904\u7406\u8BB0\u5F55 ${V.recordId} \u5931\u8D25:`,O),c.warning(`\u5904\u7406\u8BB0\u5F55 ${V.recordId} \u5931\u8D25: ${O.message||String(O)}`)}}const E=le.value==="pdf"?"PDF":le.value==="jpeg"?"JPEG\u56FE\u7247":"PNG\u56FE\u7247";c.success(`\u5DF2\u6210\u529F\u5BFC\u51FA ${re.value} \u6761\u8BB0\u5F55\u7684${E}\u5230\u591A\u7EF4\u8868\u683C`),Y.value=!1}catch(r){console.error("\u5BFC\u51FA\u81F3\u591A\u7EF4\u8868\u683C\u5931\u8D25:",r),c.error("\u5BFC\u51FA\u81F3\u591A\u7EF4\u8868\u683C\u5931\u8D25: "+(r.message||String(r)))}finally{se.value=!1}}function ze(r){try{const l=du(!0),E={fields:g.value,recordsData:[r],testData:{}},V=l.prepareSinglePrintData(E,{includeTableData:!0,preferTestData:!1}),O=l.validatePrintData(V);if(!O.isValid)throw console.error("\u5355\u6761\u8BB0\u5F55\u6253\u5370\u6570\u636E\u9A8C\u8BC1\u5931\u8D25:",O.errors),new Error("\u6253\u5370\u6570\u636E\u65E0\u6548: "+O.errors.join(", "));return console.log("\u51C6\u5907\u7684\u5355\u6761\u8BB0\u5F55\u6253\u5370\u6570\u636E:",V),V}catch(l){throw console.error("\u51C6\u5907\u5355\u6761\u8BB0\u5F55\u6253\u5370\u6570\u636E\u5931\u8D25:",l),l}}async function Je(r){return new Promise((l,E)=>{try{if(!i.hiprintTemplate){E(new Error("\u6253\u5370\u6A21\u677F\u672A\u521D\u59CB\u5316"));return}const V=`\u8BB0\u5F55_${new Date().toISOString().split("T")[0]}`;i.hiprintTemplate.toPdf([r],V,{isDownload:!1,type:"blob"}).then(O=>{O instanceof Blob?l(O):(console.error("PDF\u751F\u6210\u7ED3\u679C\u4E0D\u662FBlob\u5BF9\u8C61:",O),E(new Error("\u751F\u6210PDF\u5931\u8D25\uFF0C\u672A\u8FD4\u56DEBlob\u5BF9\u8C61")))}).catch(O=>{console.error("\u751F\u6210PDF\u5931\u8D25:",O),E(O||new Error("\u751F\u6210PDF\u5931\u8D25"))})}catch(V){console.error("\u751F\u6210PDF\u8FC7\u7A0B\u51FA\u9519:",V),E(V)}})}return(r,l)=>(C(),$("div",Mu,[u("div",Uu,[u("div",Gu,[a(e(I),{type:"primary",onClick:h,loading:N.value,icon:e(we),size:"default"},{default:n(()=>l[7]||(l[7]=[w(" \u83B7\u53D6\u6570\u636E ")])),_:1,__:[7]},8,["loading","icon"]),p.value.length>0?(C(),$("div",Hu,[a(e($e),{type:"info",size:"small"},{default:n(()=>[a(e(T),null,{default:n(()=>[a(e(De))]),_:1}),w(" \u603B\u8BB0\u5F55: "+M(p.value.length),1)]),_:1}),m.value.length>0?(C(),ne(e($e),{key:0,type:"success",size:"small"},{default:n(()=>[a(e(T),null,{default:n(()=>[a(e(lu))]),_:1}),w(" \u5DF2\u9009\u62E9: "+M(m.value.length),1)]),_:1})):W("",!0)])):W("",!0)])]),u("div",qu,[u("div",Ku,[u("h4",null,[a(e(T),null,{default:n(()=>[a(e(Ee))]),_:1}),l[8]||(l[8]=w(" \u9009\u62E9\u663E\u793A\u5B57\u6BB5 "))]),l[9]||(l[9]=u("p",null,"\u9009\u62E9\u8981\u5728\u6570\u636E\u8868\u683C\u4E2D\u663E\u793A\u7684\u5B57\u6BB5",-1))]),a(e(ke),{modelValue:B.value,"onUpdate:modelValue":l[0]||(l[0]=E=>B.value=E),multiple:"","collapse-tags":"","collapse-tags-tooltip":"",placeholder:"\u8BF7\u9009\u62E9\u8981\u663E\u793A\u7684\u5B57\u6BB5",class:"field-select"},{default:n(()=>[(C(!0),$(Fe,null,pe(g.value,E=>(C(),ne(e(Pe),{key:E.id,label:E.name,value:E.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),p.value.length>0?(C(),$("div",Wu,[u("div",Xu,[u("h4",null,[a(e(T),null,{default:n(()=>[a(e(pu))]),_:1}),l[10]||(l[10]=w(" \u9009\u62E9\u6253\u5370\u8BB0\u5F55 "))]),u("div",Yu,[a(e(fu),{size:"default"},{default:n(()=>[a(e(I),{onClick:G,icon:e(lu),size:"default"},{default:n(()=>l[11]||(l[11]=[w("\u5168\u9009")])),_:1,__:[11]},8,["icon"]),a(e(I),{onClick:d,icon:e(De),size:"default"},{default:n(()=>l[12]||(l[12]=[w("\u5F53\u524D\u9875")])),_:1,__:[12]},8,["icon"]),a(e(I),{onClick:o,icon:e(Au),size:"default"},{default:n(()=>l[13]||(l[13]=[w("\u6E05\u7A7A")])),_:1,__:[13]},8,["icon"]),a(e(I),{onClick:b,icon:e(wu),size:"default"},{default:n(()=>l[14]||(l[14]=[w("\u53CD\u9009")])),_:1,__:[14]},8,["icon"])]),_:1})])]),u("div",Zu,[a(e(vu),{ref_key:"dataTable",ref:y,data:z.value,class:"data-table",stripe:"",border:"",size:"small",onSelectionChange:R,"header-cell-style":{background:"transparent",color:"white"}},{default:n(()=>[a(e(ve),{type:"selection",width:"50"}),(C(!0),$(Fe,null,pe(J.value,E=>(C(),ne(e(ve),{key:E.id,prop:E.id,label:E.name,"min-width":E.width||120,"show-overflow-tooltip":""},{default:n(V=>[u("span",Qu,M(k(V.row[E.id])),1)]),_:2},1032,["prop","label","min-width"]))),128))]),_:1},8,["data"])]),u("div",et,[a(e(Cu),{"current-page":_.value,"onUpdate:currentPage":l[1]||(l[1]=E=>_.value=E),"page-size":j.value,"onUpdate:pageSize":l[2]||(l[2]=E=>j.value=E),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next",total:p.value.length,onSizeChange:X,onCurrentChange:ee,small:""},null,8,["current-page","page-size","total"])])])):W("",!0),u("div",ut,[u("div",tt,[u("h4",null,[a(e(T),null,{default:n(()=>[a(e(hu))]),_:1}),l[15]||(l[15]=w(" \u6253\u5370\u64CD\u4F5C "))]),l[16]||(l[16]=u("p",null,"\u9009\u62E9\u64CD\u4F5C\u7C7B\u578B\u5E76\u6267\u884C\u6253\u5370",-1))]),u("div",at,[a(e(I),{type:"success",onClick:q,disabled:m.value.length===0,icon:e(fe),class:"action-btn",size:"default"},{default:n(()=>l[17]||(l[17]=[w(" \u6253\u5370\u9009\u4E2D\u6570\u636E ")])),_:1,__:[17]},8,["disabled","icon"]),a(e(I),{type:"warning",onClick:U,disabled:m.value.length===0,icon:e(Ce),class:"action-btn",size:"default"},{default:n(()=>l[18]||(l[18]=[w(" \u5BFC\u51FAPDF ")])),_:1,__:[18]},8,["disabled","icon"]),a(e(I),{type:"info",onClick:Ne,disabled:m.value.length===0,icon:e(Ae),class:"action-btn",size:"default"},{default:n(()=>l[19]||(l[19]=[w(" \u5BFC\u51FA\u81F3\u591A\u7EF4\u8868\u683C ")])),_:1,__:[19]},8,["disabled","icon"])])]),!N.value&&p.value.length===0?(C(),$("div",st,[a(e(Ze),{description:"\u6682\u65E0\u6570\u636E"},{default:n(()=>[a(e(I),{type:"primary",onClick:h,icon:e(we),size:"default"},{default:n(()=>l[20]||(l[20]=[w(" \u83B7\u53D6\u6570\u636E ")])),_:1,__:[20]},8,["icon"])]),_:1})])):W("",!0),a(e(uu),{modelValue:Y.value,"onUpdate:modelValue":l[6]||(l[6]=E=>Y.value=E),title:"\u5BFC\u51FA\u81F3\u591A\u7EF4\u8868\u683C",width:"520px","close-on-click-modal":!1,"close-on-press-escape":!1,class:"export-dialog","align-center":""},{footer:n(()=>[u("div",Bt,[a(e(I),{onClick:l[5]||(l[5]=E=>Y.value=!1),disabled:se.value,class:"cancel-btn",size:"default"},{default:n(()=>l[32]||(l[32]=[w(" \u53D6\u6D88 ")])),_:1,__:[32]},8,["disabled"]),a(e(I),{type:"primary",onClick:ye,loading:se.value,disabled:se.value,class:"export-btn",size:"default"},yu({default:n(()=>[w(" "+M(se.value?"\u5BFC\u51FA\u4E2D...":"\u5F00\u59CB\u5BFC\u51FA"),1)]),_:2},[se.value?void 0:{name:"icon",fn:n(()=>[a(e(T),null,{default:n(()=>[a(e(Ae))]),_:1})]),key:"0"}]),1032,["loading","disabled"])])]),default:n(()=>[se.value?(C(),$("div",pt,[u("div",ft,[a(e(T),{class:"progress-icon"},{default:n(()=>[a(e(eu))]),_:1}),l[30]||(l[30]=u("h4",null,"\u6B63\u5728\u5BFC\u51FA\u81F3\u591A\u7EF4\u8868\u683C",-1))]),u("div",vt,[u("span",gt,"\u8FDB\u5EA6: "+M(re.value)+"/"+M(me.value),1),u("span",mt,M(Math.round(oe.value))+"%",1)]),a(e(bu),{percentage:oe.value,"stroke-width":8,"show-text":!1,class:"custom-progress"},null,8,["percentage"]),l[31]||(l[31]=u("p",{class:"progress-tip"},"\u8BF7\u8010\u5FC3\u7B49\u5F85\uFF0C\u6B63\u5728\u5904\u7406\u60A8\u7684\u6570\u636E...",-1))])):(C(),$("div",nt,[u("div",lt,[u("div",ot,[a(e(T),{class:"section-icon"},{default:n(()=>[a(e(Ae))]),_:1}),l[21]||(l[21]=u("h4",null,"\u9009\u62E9\u9644\u4EF6\u5B57\u6BB5",-1))]),l[22]||(l[22]=u("p",{class:"section-description"},"\u8BF7\u9009\u62E9\u8981\u5C06\u6587\u4EF6\u5BFC\u51FA\u5230\u7684\u9644\u4EF6\u5B57\u6BB5:",-1)),a(e(ke),{modelValue:x.value,"onUpdate:modelValue":l[3]||(l[3]=E=>x.value=E),placeholder:"\u9009\u62E9\u9644\u4EF6\u5B57\u6BB5",class:"field-selector",size:"large"},{default:n(()=>[(C(!0),$(Fe,null,pe(P.value,E=>(C(),ne(e(Pe),{key:E.id,label:E.name,value:E.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),u("div",rt,[u("div",it,[a(e(T),{class:"section-icon"},{default:n(()=>[a(e(De))]),_:1}),l[23]||(l[23]=u("h4",null,"\u9009\u62E9\u5BFC\u51FA\u683C\u5F0F",-1))]),l[27]||(l[27]=u("p",{class:"section-description"},"\u8BF7\u9009\u62E9\u5BFC\u51FA\u683C\u5F0F:",-1)),a(e(_u),{modelValue:le.value,"onUpdate:modelValue":l[4]||(l[4]=E=>le.value=E),class:"format-radio-group"},{default:n(()=>[a(e(je),{label:"pdf",class:"format-radio"},{default:n(()=>l[24]||(l[24]=[u("div",{class:"radio-content"},[u("div",{class:"format-title"},[u("strong",null,"PDF\u683C\u5F0F"),u("span",{class:"format-badge recommended"},"\u63A8\u8350")]),u("span",{class:"radio-desc"},"\u77E2\u91CF\u683C\u5F0F\uFF0C\u4FDD\u6301\u539F\u59CB\u8D28\u91CF\uFF0C\u6587\u4EF6\u9002\u4E2D\uFF0C\u517C\u5BB9\u6027\u597D")],-1)])),_:1,__:[24]}),a(e(je),{label:"jpeg",class:"format-radio"},{default:n(()=>l[25]||(l[25]=[u("div",{class:"radio-content"},[u("div",{class:"format-title"},[u("strong",null,"JPEG\u56FE\u7247"),u("span",{class:"format-badge compact"},"\u538B\u7F29")]),u("span",{class:"radio-desc"},"\u6709\u635F\u538B\u7F29\uFF0C\u6587\u4EF6\u8F83\u5C0F\uFF0C\u9002\u5408\u9884\u89C8\u548C\u5FEB\u901F\u5206\u4EAB")],-1)])),_:1,__:[25]}),a(e(je),{label:"png",class:"format-radio"},{default:n(()=>l[26]||(l[26]=[u("div",{class:"radio-content"},[u("div",{class:"format-title"},[u("strong",null,"PNG\u56FE\u7247"),u("span",{class:"format-badge quality"},"\u9AD8\u6E05")]),u("span",{class:"radio-desc"},"\u65E0\u635F\u538B\u7F29\uFF0C\u753B\u8D28\u6700\u4F73\uFF0C\u6587\u4EF6\u8F83\u5927\uFF0C\u6027\u80FD\u6D88\u8017\u9AD8")],-1)])),_:1,__:[26]})]),_:1},8,["modelValue"])]),u("div",ct,[u("div",dt,[a(e(T),{class:"tip-icon"},{default:n(()=>[a(e(Qe))]),_:1}),l[28]||(l[28]=u("span",null,"\u8BF7\u4ED4\u7EC6\u786E\u8BA4\u9644\u4EF6\u5B57\u6BB5\u9009\u62E9\uFF0C\u6587\u4EF6\u5C06\u4E0A\u4F20\u5230\u6240\u9009\u5B57\u6BB5\u4E2D\uFF0C\u9009\u9519\u5B57\u6BB5\u53EF\u80FD\u5BFC\u81F4\u6570\u636E\u6DF7\u4E71(\u5728\u591A\u7EF4\u8868\u683C\u4E2D\u53EF\u4F7F\u7528CTRL+Z\u8FDB\u884C\u64A4\u9500)",-1))]),u("div",Ft,[a(e(T),{class:"tip-icon"},{default:n(()=>[a(e(gu))]),_:1}),l[29]||(l[29]=u("span",null,"\u683C\u5F0F\u9009\u62E9\u5EFA\u8BAE\uFF1APDF\u9002\u5408\u6587\u6863\u5B58\u6863\uFF0CJPEG\u9002\u5408\u5FEB\u901F\u5206\u4EAB\uFF0CPNG\u9002\u5408\u9AD8\u8D28\u91CF\u56FE\u50CF\u4FDD\u5B58",-1))])])]))]),_:1},8,["modelValue"])]))}}),Dt=xe(Et,[["__scopeId","data-v-175f0f9a"]]),At={class:"field-info-viewer"},wt={class:"toolbar"},Ct={class:"toolbar-section"},ht={key:1,class:"stats-cards"},yt={class:"stat-card"},_t={class:"stat-icon"},bt={class:"stat-content"},Tt={class:"stat-number"},St={key:0,class:"stat-card"},$t={class:"stat-icon"},kt={class:"stat-content"},Pt={class:"stat-number"},Vt={key:2,class:"record-selector"},It={class:"selector-header"},xt={key:3,class:"fields-container"},Ot={class:"table-header"},Nt={class:"field-value"},zt={key:0},Jt={key:1,class:"empty-value"},jt={key:4,class:"empty-state"},Lt={__name:"FieldInfoViewer",setup(f){const v=A(""),i=A("info"),D=A(!1),g=A([]),B=A([]),p=A(""),m=A([]),N=A({}),y=Se(()=>{switch(i.value){case"success":return Eu;case"error":return Qe;default:return eu}});function _(k){return{Text:"primary",Number:"success",SingleSelect:"warning",MultiSelect:"info",DateTime:"danger",Checkbox:"success",User:"primary",Phone:"warning",Email:"info",Url:"primary",Attachment:"danger",SingleLink:"warning",Formula:"info",CreatedTime:"danger",ModifiedTime:"danger",CreatedUser:"primary",ModifiedUser:"primary"}[k]||"default"}Ie(async()=>{await j(),await z()});async function j(){D.value=!0,v.value="\u6B63\u5728\u83B7\u53D6\u5B57\u6BB5\u4FE1\u606F...",i.value="info",g.value=[],m.value=[],N.value={};try{const k=await Q.base.getActiveTable(),S=await k.getActiveView(),h=k.id,R=S.id;g.value=await tu(h,R),v.value=`\u6210\u529F\u83B7\u53D6 ${g.value.length} \u4E2A\u5B57\u6BB5\u4FE1\u606F`,i.value="success"}catch(k){v.value=`\u83B7\u53D6\u5B57\u6BB5\u4FE1\u606F\u5931\u8D25: ${k.message}`,i.value="error",console.error("\u83B7\u53D6\u5B57\u6BB5\u4FE1\u606F\u65F6\u51FA\u9519:",k)}finally{D.value=!1}}async function z(){v.value="\u6B63\u5728\u83B7\u53D6\u8BB0\u5F55\u5217\u8868...",i.value="info",B.value=[];try{const k=await Q.base.getActiveTable(),S=await k.getActiveView(),h=k.id,R=S.id,X=await he(h,R,null,!0);B.value=X,v.value=`\u6210\u529F\u83B7\u53D6 ${B.value.length} \u6761\u8BB0\u5F55`,i.value="success"}catch(k){v.value=`\u83B7\u53D6\u8BB0\u5F55\u5217\u8868\u5931\u8D25: ${k.message}`,i.value="error",console.error("\u83B7\u53D6\u8BB0\u5F55\u5217\u8868\u65F6\u51FA\u9519:",k)}}async function J(){if(!p.value){v.value="\u8BF7\u5148\u9009\u62E9\u4E00\u6761\u8BB0\u5F55",i.value="error";return}v.value="\u6B63\u5728\u83B7\u53D6\u8BB0\u5F55\u503C...",i.value="info",m.value=[],N.value={};try{const k=await Q.base.getActiveTable(),S=await k.getActiveView(),h=k.id,R=S.id,X=await he(h,R,p.value,!0);if(X.length>0){const ee=X[0];m.value=ee.field.map(q=>({fieldId:q.field,value:q.value})),N.value=ee.field.reduce((q,U)=>(q[U.field]=U.value,q),{}),v.value=`\u6210\u529F\u83B7\u53D6\u8BB0\u5F55\u7684 ${m.value.length} \u4E2A\u5B57\u6BB5\u503C`,i.value="success"}else v.value="\u672A\u627E\u5230\u6307\u5B9A\u8BB0\u5F55",i.value="error"}catch(k){v.value=`\u83B7\u53D6\u8BB0\u5F55\u503C\u5931\u8D25: ${k.message}`,i.value="error",console.error("\u83B7\u53D6\u8BB0\u5F55\u503C\u65F6\u51FA\u9519:",k)}}return(k,S)=>(C(),$("div",At,[u("div",wt,[u("div",Ct,[a(e(I),{type:"primary",onClick:j,icon:e(we),loading:D.value},{default:n(()=>S[1]||(S[1]=[w(" \u83B7\u53D6\u5B57\u6BB5\u4FE1\u606F ")])),_:1,__:[1]},8,["icon","loading"]),a(e(I),{type:"success",onClick:J,disabled:!p.value||g.value.length===0,icon:e(Ue)},{default:n(()=>S[2]||(S[2]=[w(" \u83B7\u53D6\u8BB0\u5F55\u503C ")])),_:1,__:[2]},8,["disabled","icon"])])]),v.value?(C(),$("div",{key:0,class:mu(["status-message",i.value])},[a(e(T),null,{default:n(()=>[(C(),ne(Bu(y.value)))]),_:1}),u("span",null,M(v.value),1)],2)):W("",!0),g.value.length>0?(C(),$("div",ht,[u("div",yt,[u("div",_t,[a(e(T),null,{default:n(()=>[a(e(Ge))]),_:1})]),u("div",bt,[u("div",Tt,M(g.value.length),1),S[3]||(S[3]=u("div",{class:"stat-label"},"\u5B57\u6BB5\u603B\u6570",-1))])]),B.value.length>0?(C(),$("div",St,[u("div",$t,[a(e(T),null,{default:n(()=>[a(e(De))]),_:1})]),u("div",kt,[u("div",Pt,M(B.value.length),1),S[4]||(S[4]=u("div",{class:"stat-label"},"\u8BB0\u5F55\u603B\u6570",-1))])])):W("",!0)])):W("",!0),B.value.length>0?(C(),$("div",Vt,[u("div",It,[u("h4",null,[a(e(T),null,{default:n(()=>[a(e(Tu))]),_:1}),S[5]||(S[5]=w(" \u9009\u62E9\u8BB0\u5F55\u67E5\u770B\u8BE6\u7EC6\u503C "))])]),a(e(ke),{modelValue:p.value,"onUpdate:modelValue":S[0]||(S[0]=h=>p.value=h),placeholder:"\u8BF7\u9009\u62E9\u8BB0\u5F55",filterable:"",clearable:"",onChange:J,class:"record-select"},{default:n(()=>[(C(!0),$(Fe,null,pe(B.value,h=>{var R;return C(),ne(e(Pe),{key:h.recordId,label:((R=h.field[0])==null?void 0:R.value)||h.recordId,value:h.recordId},null,8,["label","value"])}),128))]),_:1},8,["modelValue"])])):W("",!0),g.value.length>0?(C(),$("div",xt,[u("div",Ot,[u("h4",null,[a(e(T),null,{default:n(()=>[a(e(pu))]),_:1}),S[6]||(S[6]=w(" \u5B57\u6BB5\u8BE6\u7EC6\u4FE1\u606F "))])]),a(e(vu),{data:g.value,class:"fields-table",stripe:"",border:"",size:"small","header-cell-style":{background:"#f8f9fa",color:"#303133"}},{default:n(()=>[a(e(ve),{prop:"id",label:"\u5B57\u6BB5ID","min-width":"200","show-overflow-tooltip":""}),a(e(ve),{prop:"name",label:"\u5B57\u6BB5\u540D\u79F0","min-width":"120","show-overflow-tooltip":""}),a(e(ve),{prop:"type",label:"\u5B57\u6BB5\u7C7B\u578B","min-width":"100"},{default:n(h=>[a(e($e),{type:_(h.row.type),size:"small"},{default:n(()=>[w(M(h.row.type),1)]),_:2},1032,["type"])]),_:1}),m.value.length>0?(C(),ne(e(ve),{key:0,label:"\u5B57\u6BB5\u503C","min-width":"200"},{default:n(h=>[u("div",Nt,[N.value[h.row.id]?(C(),$("pre",zt,M(N.value[h.row.id]),1)):(C(),$("span",Jt,"\u6682\u65E0\u6570\u636E"))])]),_:1})):W("",!0)]),_:1},8,["data"])])):W("",!0),!D.value&&g.value.length===0?(C(),$("div",jt,[a(e(Ze),{description:"\u6682\u65E0\u5B57\u6BB5\u4FE1\u606F"},{default:n(()=>[a(e(I),{type:"primary",onClick:j,icon:e(we)},{default:n(()=>S[7]||(S[7]=[w(" \u83B7\u53D6\u5B57\u6BB5\u4FE1\u606F ")])),_:1,__:[7]},8,["icon"])]),_:1})])):W("",!0)]))}},Rt=xe(Lt,[["__scopeId","data-v-45ae9614"]]),Mt="hiprintDB",ce="templates",Ut=1;function au(){return new Promise((f,v)=>{const i=window.indexedDB.open(Mt,Ut);i.onerror=D=>v(D.target.error),i.onsuccess=D=>f(D.target.result),i.onupgradeneeded=D=>{const g=D.target.result;g.objectStoreNames.contains(ce)||g.createObjectStore(ce,{keyPath:"id"}).createIndex("description","description",{unique:!1})}})}async function Te(f,v,i=""){const D=await au();return new Promise((g,B)=>{try{const p=JSON.parse(JSON.stringify(v)),m=D.transaction(ce,"readwrite");m.objectStore(ce).put({id:f,data:p,description:i,createdAt:new Date().toISOString()}),m.oncomplete=()=>g(),m.onerror=y=>B(y.target.error)}catch(p){B(p)}})}async function Xe(){const f=await au();return new Promise((v,i)=>{const B=f.transaction(ce,"readonly").objectStore(ce).getAll();B.onsuccess=()=>v(B.result||[]),B.onerror=p=>i(p.target.error)})}async function Fu(f){const v=await au();return new Promise((i,D)=>{const g=v.transaction(ce,"readwrite");g.objectStore(ce).delete(f),g.oncomplete=()=>i(),g.onerror=p=>D(p.target.error)})}const Gt={class:"template-manager"},Ht={class:"stats-cards"},qt={class:"stat-card"},Kt={class:"stat-icon"},Wt={class:"stat-content"},Xt={class:"stat-number"},Yt={key:0,class:"stat-card"},Zt={class:"stat-icon"},Qt={class:"stat-content"},ea={class:"stat-number"},ua={class:"toolbar"},ta={class:"toolbar-section"},aa={class:"toolbar-section"},sa={class:"template-list-container"},na={key:0,class:"empty-state"},la={key:1,class:"template-cards"},oa={class:"card-header"},ra={class:"template-info"},ia={class:"template-name"},ca={class:"template-description"},da={class:"template-status"},Fa={class:"card-meta"},pa={class:"meta-item"},fa={class:"meta-value"},va={class:"card-actions"},ga={class:"dialog-footer"},ma=Ye({__name:"TemplateManager",props:{hiprintTemplate:Object},emits:["load-template"],setup(f,{emit:v}){const i=f,D=v,g=A([]),B=A(!1),p=A(""),m=A(!1),N=A("\u65B0\u589E\u6A21\u677F"),y=A(!1),_=A({id:"",name:"",description:"",data:null});A(!1),A("");async function j(){try{B.value=!0;const d=await Xe();g.value=d}catch(d){console.error("\u52A0\u8F7D\u6A21\u677F\u5217\u8868\u5931\u8D25:",d),c.error("\u52A0\u8F7D\u6A21\u677F\u5217\u8868\u5931\u8D25: "+(d.message||String(d)))}finally{B.value=!1}}function z(){y.value=!1,N.value="\u65B0\u589E\u6A21\u677F",_.value={id:"",name:"",description:"",data:i.hiprintTemplate?i.hiprintTemplate.getJson():null},m.value=!0}function J(d){y.value=!0,N.value="\u7F16\u8F91\u6A21\u677F",_.value={id:d.id,name:d.id,description:d.description||"",data:d.data},m.value=!0}async function k(){try{if(!_.value.name){c.warning("\u8BF7\u8F93\u5165\u6A21\u677F\u540D\u79F0");return}y.value&&_.value.id!==_.value.name&&await Fu(_.value.id);const d=JSON.parse(JSON.stringify(_.value.data));await Te(_.value.name,d,_.value.description||_.value.name),c.success("\u6A21\u677F\u4FDD\u5B58\u6210\u529F"),m.value=!1,await j()}catch(d){console.error("\u4FDD\u5B58\u6A21\u677F\u5931\u8D25:",d),c.error("\u4FDD\u5B58\u6A21\u677F\u5931\u8D25: "+(d.message||String(d)))}}async function S(d){try{await qe.confirm("\u786E\u5B9A\u8981\u5220\u9664\u8FD9\u4E2A\u6A21\u677F\u5417\uFF1F","\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}),await Fu(d),c.success("\u6A21\u677F\u5DF2\u5220\u9664"),await j()}catch(o){o!=="cancel"&&(console.error("\u5220\u9664\u6A21\u677F\u5931\u8D25:",o),c.error("\u5220\u9664\u6A21\u677F\u5931\u8D25: "+(o.message||String(o))))}}function h(d){D("load-template",d.data),c.success("\u6A21\u677F\u5DF2\u52A0\u8F7D\u5230\u8BBE\u8BA1\u5668")}function R(d){try{const o=JSON.stringify(d.data,null,2),b=new Blob([o],{type:"application/json"}),P=URL.createObjectURL(b),x=document.createElement("a");x.href=P,x.download=`${d.id}_${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(x),x.click(),document.body.removeChild(x),URL.revokeObjectURL(P),c.success("\u6A21\u677F\u5BFC\u51FA\u6210\u529F")}catch(o){console.error("\u5BFC\u51FA\u6A21\u677F\u5931\u8D25:",o),c.error("\u5BFC\u51FA\u6A21\u677F\u5931\u8D25: "+(o.message||String(o)))}}function X(){try{if(g.value.length===0){c.warning("\u6CA1\u6709\u53EF\u5BFC\u51FA\u7684\u6A21\u677F");return}const d={};g.value.forEach(Y=>{d[Y.id]=Y.data});const o=JSON.stringify(d,null,2),b=new Blob([o],{type:"application/json"}),P=URL.createObjectURL(b),x=document.createElement("a");x.href=P,x.download=`\u6240\u6709\u6A21\u677F_${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(x),x.click(),document.body.removeChild(x),URL.revokeObjectURL(P),c.success(`\u5DF2\u5BFC\u51FA ${g.value.length} \u4E2A\u6A21\u677F`)}catch(d){console.error("\u5BFC\u51FA\u6240\u6709\u6A21\u677F\u5931\u8D25:",d),c.error("\u5BFC\u51FA\u6240\u6709\u6A21\u677F\u5931\u8D25: "+(d.message||String(d)))}}function ee(){const d=document.createElement("input");d.type="file",d.accept="application/json",d.style.display="none",document.body.appendChild(d),d.addEventListener("change",async o=>{const b=o.target.files[0];if(!b){document.body.removeChild(d);return}try{const P=await q(b);await K(P)}catch(P){console.error("\u5BFC\u5165\u6A21\u677F\u5931\u8D25:",P),c.error("\u5BFC\u5165\u6A21\u677F\u5931\u8D25: "+(P.message||String(P)))}finally{document.body.removeChild(d)}}),d.click()}function q(d){return new Promise((o,b)=>{const P=new FileReader;P.onload=x=>{try{const Y=JSON.parse(x.target.result);o(Y)}catch{b(new Error("\u65E0\u6548\u7684JSON\u6587\u4EF6"))}},P.onerror=()=>b(new Error("\u8BFB\u53D6\u6587\u4EF6\u5931\u8D25")),P.readAsText(d)})}function U(d){return!d||typeof d!="object"?!1:!!(Array.isArray(d.panels)||d.width!==void 0&&d.height!==void 0||d.printElements!==void 0)}async function K(d){try{if(typeof d=="object"&&!Array.isArray(d))if(U(d))await qe.prompt("\u8BF7\u8F93\u5165\u6A21\u677F\u540D\u79F0","\u5BFC\u5165\u6A21\u677F",{confirmButtonText:"\u786E\u8BA4",cancelButtonText:"\u53D6\u6D88",inputPattern:/.+/,inputErrorMessage:"\u6A21\u677F\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A"}).then(async({value:o})=>{const b={...d,panels:d.panels||[],width:d.width||210,height:d.height||297,paperType:d.paperType||"A4",paperHeader:d.paperHeader||0,paperFooter:d.paperFooter||0,printElements:d.printElements||[]},P=JSON.parse(JSON.stringify(b));await Te(o,P,o),c.success("\u6A21\u677F\u5BFC\u5165\u6210\u529F")});else{let o=0,b=!1;for(const[P,x]of Object.entries(d))if(U(x)){b=!0;const Y={...x,panels:x.panels||[],width:x.width||210,height:x.height||297,paperType:x.paperType||"A4",paperHeader:x.paperHeader||0,paperFooter:x.paperFooter||0,printElements:x.printElements||[]},oe=JSON.parse(JSON.stringify(Y));await Te(P,oe,P),o++}if(b)c.success(`\u6210\u529F\u5BFC\u5165 ${o} \u4E2A\u6A21\u677F`);else{c.error("\u672A\u627E\u5230\u6709\u6548\u7684\u6A21\u677F\u6570\u636E");return}}else{c.error("\u65E0\u6548\u7684\u6A21\u677F\u6570\u636E\u683C\u5F0F");return}await j()}catch(o){o!=="cancel"&&(console.error("\u5BFC\u5165\u6A21\u677F\u5931\u8D25:",o),c.error("\u5BFC\u5165\u6A21\u677F\u5931\u8D25: "+(o.message||String(o))))}}const G=Se(()=>{if(!p.value)return g.value;const d=p.value.toLowerCase();return g.value.filter(o=>o.id.toLowerCase().includes(d)||o.description&&o.description.toLowerCase().includes(d))});return Ie(()=>{j()}),(d,o)=>(C(),$("div",Gt,[a(e(Su),{title:"\u6A21\u677F\u6570\u636E\u4FDD\u5B58\u5728\u6D4F\u89C8\u5668\u672C\u5730\u5B58\u50A8\u4E2D\uFF0C\u5EFA\u8BAE\u5B9A\u671F\u5BFC\u51FA\u5907\u4EFD",type:"warning",closable:!1,"show-icon":"",class:"warning-alert"}),u("div",Ht,[u("div",qt,[u("div",Kt,[a(e(T),null,{default:n(()=>[a(e(He))]),_:1})]),u("div",Wt,[u("div",Xt,M(g.value.length),1),o[5]||(o[5]=u("div",{class:"stat-label"},"\u6A21\u677F\u603B\u6570",-1))])]),G.value.length!==g.value.length?(C(),$("div",Yt,[u("div",Zt,[a(e(T),null,{default:n(()=>[a(e(Ue))]),_:1})]),u("div",Qt,[u("div",ea,M(G.value.length),1),o[6]||(o[6]=u("div",{class:"stat-label"},"\u641C\u7D22\u7ED3\u679C",-1))])])):W("",!0)]),u("div",ua,[u("div",ta,[a(e(ge),{modelValue:p.value,"onUpdate:modelValue":o[0]||(o[0]=b=>p.value=b),placeholder:"\u641C\u7D22\u6A21\u677F\u540D\u79F0...","prefix-icon":e(Ue),clearable:"",class:"search-input"},null,8,["modelValue","prefix-icon"])]),u("div",aa,[a(e(fu),null,{default:n(()=>[a(e(I),{type:"primary",onClick:z,icon:e(ou)},{default:n(()=>o[7]||(o[7]=[w(" \u4FDD\u5B58\u5F53\u524D\u6A21\u677F ")])),_:1,__:[7]},8,["icon"]),a(e(I),{type:"success",onClick:X,icon:e(Ce)},{default:n(()=>o[8]||(o[8]=[w(" \u5BFC\u51FA\u6240\u6709 ")])),_:1,__:[8]},8,["icon"]),a(e(I),{type:"info",onClick:ee,icon:e(Ae)},{default:n(()=>o[9]||(o[9]=[w(" \u5BFC\u5165\u6A21\u677F ")])),_:1,__:[9]},8,["icon"]),a(e(I),{onClick:j,icon:e(we)},{default:n(()=>o[10]||(o[10]=[w(" \u5237\u65B0 ")])),_:1,__:[10]},8,["icon"])]),_:1})])]),u("div",sa,[G.value.length===0&&!B.value?(C(),$("div",na,[a(e(Ze),{description:"\u6682\u65E0\u6A21\u677F\u6570\u636E"},{default:n(()=>[a(e(I),{type:"primary",onClick:z,icon:e(ou)},{default:n(()=>o[11]||(o[11]=[w(" \u4FDD\u5B58\u5F53\u524D\u6A21\u677F ")])),_:1,__:[11]},8,["icon"])]),_:1})])):(C(),$("div",la,[(C(!0),$(Fe,null,pe(G.value,b=>(C(),$("div",{key:b.id,class:"template-card"},[u("div",oa,[u("div",ra,[u("h4",ia,[a(e(T),null,{default:n(()=>[a(e(De))]),_:1}),w(" "+M(b.id),1)]),u("p",ca,M(b.description||"\u6682\u65E0\u63CF\u8FF0"),1)]),u("div",da,[a(e($e),{type:"success",size:"small"},{default:n(()=>[a(e(T),null,{default:n(()=>[a(e(Eu))]),_:1}),o[12]||(o[12]=w(" \u5DF2\u4FDD\u5B58 "))]),_:1,__:[12]})])]),u("div",Fa,[u("div",pa,[o[13]||(o[13]=u("span",{class:"meta-label"},"\u521B\u5EFA\u65F6\u95F4\uFF1A",-1)),u("span",fa,M(b.createdAt?new Date(b.createdAt).toLocaleString():"\u672A\u77E5"),1)])]),u("div",va,[a(e(I),{type:"primary",size:"small",onClick:P=>h(b),icon:e(ie),class:"action-btn"},{default:n(()=>o[14]||(o[14]=[w(" \u52A0\u8F7D\u5230\u8BBE\u8BA1\u5668 ")])),_:2,__:[14]},1032,["onClick","icon"]),a(e(I),{type:"success",size:"small",onClick:P=>R(b),icon:e(Ce),class:"action-btn"},{default:n(()=>o[15]||(o[15]=[w(" \u5BFC\u51FA ")])),_:2,__:[15]},1032,["onClick","icon"]),a(e(I),{type:"warning",size:"small",onClick:P=>J(b),icon:e(ie),class:"action-btn"},{default:n(()=>o[16]||(o[16]=[w(" \u7F16\u8F91 ")])),_:2,__:[16]},1032,["onClick","icon"]),a(e(I),{type:"danger",size:"small",onClick:P=>S(b.id),icon:e($u),class:"action-btn"},{default:n(()=>o[17]||(o[17]=[w(" \u5220\u9664 ")])),_:2,__:[17]},1032,["onClick","icon"])])]))),128))]))]),a(e(uu),{modelValue:m.value,"onUpdate:modelValue":o[4]||(o[4]=b=>m.value=b),title:N.value,width:"500px"},{footer:n(()=>[u("span",ga,[a(e(I),{onClick:o[3]||(o[3]=b=>m.value=!1)},{default:n(()=>o[18]||(o[18]=[w("\u53D6\u6D88")])),_:1,__:[18]}),a(e(I),{type:"primary",onClick:k},{default:n(()=>o[19]||(o[19]=[w("\u786E\u8BA4")])),_:1,__:[19]})])]),default:n(()=>[a(e(Du),{model:_.value,"label-width":"100px"},{default:n(()=>[a(e(Ve),{label:"\u6A21\u677F\u540D\u79F0"},{default:n(()=>[a(e(ge),{modelValue:_.value.name,"onUpdate:modelValue":o[1]||(o[1]=b=>_.value.name=b),placeholder:"\u8BF7\u8F93\u5165\u6A21\u677F\u540D\u79F0"},null,8,["modelValue"])]),_:1}),a(e(Ve),{label:"\u6A21\u677F\u63CF\u8FF0"},{default:n(()=>[a(e(ge),{modelValue:_.value.description,"onUpdate:modelValue":o[2]||(o[2]=b=>_.value.description=b),type:"textarea",placeholder:"\u8BF7\u8F93\u5165\u6A21\u677F\u63CF\u8FF0"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])]))}}),Ba=xe(ma,[["__scopeId","data-v-7e5ab442"]]),Ea={class:"hiprint-viewer"},Da={class:"viewer-header"},Aa={class:"header-content"},wa={class:"header-left"},Ca={class:"header-actions"},ha={key:0,class:"status-message error"},ya={key:1,class:"status-message info"},_a={key:2,class:"loading-overlay"},ba={class:"hiprint-container"},Ta={class:"nav-tabs"},Sa={class:"tab-buttons"},$a=["data-tab","onClick"],ka={class:"tab-icon"},Pa={key:1,class:"emoji-icon"},Va={class:"tab-content"},Ia={key:0,class:"tab-panel"},xa={class:"panel-header"},Oa={class:"recommendation-banner"},Na={class:"banner-content"},za={class:"banner-icon"},Ja={class:"banner-actions"},ja={class:"toolbar"},La={class:"toolbar-container"},Ra={class:"toolbar-group template-group"},Ma={class:"group-header"},Ua={class:"group-content"},Ga={class:"input-group"},Ha={class:"toolbar-group operations-group"},qa={class:"group-header"},Ka={class:"group-content"},Wa={class:"paper-size-group"},Xa={class:"toolbar-group preview-group"},Ya={class:"group-header"},Za={class:"group-content"},Qa={class:"design-workspace"},es={class:"elements-panel"},us={class:"panel-title"},ts={class:"properties-panel"},as={class:"panel-title"},ss={key:1,class:"tab-panel"},ns={class:"panel-header"},ls={key:2,class:"tab-panel"},os={class:"panel-header"},rs={key:3,class:"tab-panel"},is={class:"panel-header"},cs={class:"hiprint-printPagination"},ds={class:"dialog-footer"},Fs=Ye({__name:"hiprintViewer",setup(f){const v=ku(),i=A(""),D=A([]),g=A([]),B=A("design");let p=null,m=A(!0);const N=A(!1),y=A(""),_=A([{label:"A4",value:"A4",width:210,height:297},{label:"A5",value:"A5",width:148,height:210},{label:"B5",value:"B5",width:176,height:250},{label:"\u81EA\u5B9A\u4E49",value:"custom",width:100,height:150}]),j=A("A4"),z=A(!1),J=A({width:100,height:150}),k=A([]),S=A(""),h=A("");let R=null;const X=A([{name:"design",label:"\u8BBE\u8BA1\u6A21\u677F",icon:_e(ie),emoji:"\u{1F3A8}"},{name:"print",label:"\u6570\u636E\u6253\u5370",icon:_e(fe),emoji:"\u{1F5A8}\uFE0F"},{name:"template-manager",label:"\u6A21\u677F\u7BA1\u7406",icon:_e(He),emoji:"\u{1F4C1}"},{name:"field-info",label:"\u5B57\u6BB5\u4FE1\u606F",icon:_e(Ge),emoji:"\u{1F4CA}"}]);Me(B,async(s,t)=>{s==="design"&&t!=="design"&&p&&(console.log("\u5207\u6362\u5230\u8BBE\u8BA1\u6807\u7B7E\u9875\uFF0C\u51C6\u5907\u91CD\u65B0\u6E32\u67D3hiprint\u7EC4\u4EF6"),await cu(),setTimeout(()=>{K()},150))}),Ie(async()=>{try{m.value=!0,i.value="\u6B63\u5728\u521D\u59CB\u5316...",R=Ou();const s=R.listenForMessages(Je);window.addEventListener("beforeunload",s),i.value="\u6B63\u5728\u52A0\u8F7D\u5B57\u6BB5\u4FE1\u606F...",await ee(),i.value="\u6B63\u5728\u83B7\u53D6\u6D4B\u8BD5\u6570\u636E...",await q(),i.value="\u6B63\u5728\u521D\u59CB\u5316\u6253\u5370\u7EC4\u4EF6...",await G(),await ze()||(i.value="\u6B63\u5728\u52A0\u8F7D\u9ED8\u8BA4\u6A21\u677F...",await V()),await l(),m.value=!1,i.value="",U()}catch(s){console.error("\u521D\u59CB\u5316\u5931\u8D25:",s),i.value="\u521D\u59CB\u5316\u5931\u8D25: "+(s.message||String(s)),m.value=!1}});async function ee(){try{const s=await Q.base.getActiveTable(),t=await s.getActiveView(),F=s.id,H=t.id;return D.value=await tu(F,H),{fields:D.value,tableId:F,viewId:H}}catch(s){throw console.error("\u83B7\u53D6\u5B57\u6BB5\u5931\u8D25:",s),s}}async function q(){try{const s=await Q.base.getActiveTable(),t=await s.getActiveView(),F=s.id,H=t.id,L=await he(F,H,null,!0,null,1);if(window.fieldTestData={},L&&L.length>0){const ue=L[0];ue&&ue.field&&ue.field.forEach(Z=>{try{const te=Ke(Z.value,Z.type);window.fieldTestData[Z.field]=te!==void 0?te:Z.value}catch(te){console.warn(`\u683C\u5F0F\u5316\u5B57\u6BB5 ${Z.field} \u5931\u8D25:`,te),window.fieldTestData[Z.field]=Z.value}}),console.log("\u7B2C\u4E00\u4E2A\u8BB0\u5F55\u7684\u6D4B\u8BD5\u6570\u636E\u5DF2\u52A0\u8F7D\u5E76\u683C\u5F0F\u5316:",window.fieldTestData)}else console.warn("\u6CA1\u6709\u627E\u5230\u8BB0\u5F55\u6570\u636E\uFF0C\u4F7F\u7528\u7A7A\u7684\u6D4B\u8BD5\u6570\u636E");return window.fieldTestData}catch(s){return console.error("\u83B7\u53D6\u7B2C\u4E00\u4E2A\u8BB0\u5F55\u6D4B\u8BD5\u6570\u636E\u5931\u8D25:",s),window.fieldTestData={},window.fieldTestData}}async function U(){try{N.value=!0,y.value="\u6B63\u5728\u52A0\u8F7D\u5B8C\u6574\u8BB0\u5F55\u6570\u636E\uFF0C\u8FD9\u53EF\u80FD\u9700\u8981\u4E00\u4E9B\u65F6\u95F4...";const s=await Q.base.getActiveTable(),t=await s.getActiveView(),F=s.id,H=t.id;await he(F,H,null,!0,(L,ue,Z)=>{g.value=L.map(te=>{const su={recordId:te.recordId,field:te.field};return te.field&&te.field.forEach(nu=>{su[nu.field]=nu.value}),su}),Z?(y.value=`\u5DF2\u6210\u529F\u52A0\u8F7D ${L.length} \u6761\u8BB0\u5F55`,setTimeout(()=>{y.value=""},3e3)):y.value=`\u5DF2\u52A0\u8F7D ${L.length} \u6761\u8BB0\u5F55\uFF0C\u6B63\u5728\u7EE7\u7EED\u52A0\u8F7D...\uFF08\u6279\u6B21 ${ue}\uFF09`})}catch(s){console.error("\u83B7\u53D6\u8BB0\u5F55\u5931\u8D25:",s),y.value="\u83B7\u53D6\u8BB0\u5F55\u5931\u8D25: "+(s.message||String(s)),setTimeout(()=>{y.value=""},5e3)}finally{N.value=!1}}function K(){try{if(!p){console.warn("hiprintTemplate\u672A\u521D\u59CB\u5316\uFF0C\u65E0\u6CD5\u91CD\u65B0\u6E32\u67D3");return}const s=ae("#hiprint-printTemplate"),t=ae("#provider-container");if(s.length===0){console.warn("\u6A21\u677F\u5BB9\u5668\u4E0D\u5B58\u5728\uFF0C\u65E0\u6CD5\u91CD\u65B0\u6E32\u67D3");return}p.design("#hiprint-printTemplate",{grid:!0}),t.length>0&&(t.empty(),de.exports.hiprint.PrintElementTypeManager.build(t,"defaultModule"),de.exports.hiprint.PrintElementTypeManager.build(t,"customModule"),setTimeout(()=>{ae(".ep-draggable-item-group").each(function(){const F=ae(this).children(".ep-draggable-item");F.length>0&&F.wrapAll('<div class="ep-draggable-item-list"></div>')})},200)),console.log("hiprint\u7EC4\u4EF6\u91CD\u65B0\u6E32\u67D3\u5B8C\u6210")}catch(s){console.error("\u91CD\u65B0\u6E32\u67D3hiprint\u7EC4\u4EF6\u5931\u8D25:",s)}}async function G(){try{ae("#provider-container").empty(),ae("#hiprint-printTemplate").empty(),de.exports.hiprint.init({providers:[de.exports.defaultElementTypeProvider(),Nu(D.value,window.fieldTestData)()]}),de.exports.hiprint.PrintElementTypeManager.build(ae("#provider-container"),"defaultModule"),de.exports.hiprint.PrintElementTypeManager.build(ae("#provider-container"),"customModule"),p=new de.exports.hiprint.PrintTemplate({template:{},settingContainer:"#PrintElementOptionSetting",paginationContainer:".hiprint-printPagination",fontList:[{title:"\u5FAE\u8F6F\u96C5\u9ED1",value:"Microsoft YaHei"},{title:"\u9ED1\u4F53",value:"STHeitiSC-Light"},{title:"\u601D\u6E90\u9ED1\u4F53",value:"SourceHanSansCN-Normal"},{title:"\u5B8B\u4F53",value:"SimSun"},{title:"\u534E\u4E3A\u6977\u4F53",value:"STKaiti"}],dataMode:1,history:!0,onDataChanged:(s,t)=>{console.log("\u6A21\u677F\u53D8\u66F4\u7C7B\u578B:",s),console.log("\u6A21\u677F\u6570\u636E:",t)},onUpdateError:s=>{console.error("\u66F4\u65B0\u5931\u8D25:",s)}}),p.design("#hiprint-printTemplate",{grid:!0}),setTimeout(()=>{ae(".ep-draggable-item-group").each(function(){const s=ae(this).children(".ep-draggable-item");s.length>0&&s.wrapAll('<div class="ep-draggable-item-list"></div>')})},500)}catch(s){throw console.error("\u521D\u59CB\u5316\u6253\u5370\u7EC4\u4EF6\u5931\u8D25:",s),i.value="\u521D\u59CB\u5316\u6253\u5370\u7EC4\u4EF6\u5931\u8D25: "+(s.message||String(s)),s}}function d(){const s=p.getJson();return console.log("\u6A21\u677FJSON:",s),s}function o(s){try{ae("#hiprint-printTemplate").empty(),p.update(s),p.design("#hiprint-printTemplate",{grid:!0}),B.value==="design"&&setTimeout(()=>{K()},100),c.success("\u6A21\u677F\u5BFC\u5165\u6210\u529F")}catch(t){console.error("\u5BFC\u5165\u6A21\u677F\u5931\u8D25:",t),c.error("\u5BFC\u5165\u6A21\u677F\u5931\u8D25: "+(t.message||String(t)))}}function b(s){try{const t=_.value.find(F=>F.value===s);if(!t)return;p.setPaper(s),c.success(`\u5DF2\u8BBE\u7F6E\u7EB8\u5F20\u5927\u5C0F: ${t.label}`)}catch(t){console.error("\u8BBE\u7F6E\u7EB8\u5F20\u5927\u5C0F\u5931\u8D25:",t),c.error("\u8BBE\u7F6E\u7EB8\u5F20\u5927\u5C0F\u5931\u8D25: "+(t.message||String(t)))}}function P(){try{const s=parseFloat(J.value.width.toString()),t=parseFloat(J.value.height.toString());if(isNaN(s)||s<=0||isNaN(t)||t<=0){c.error("\u8BF7\u8F93\u5165\u6709\u6548\u7684\u7EB8\u5F20\u5C3A\u5BF8");return}p.setPaper(s,t),c.success(`\u5DF2\u8BBE\u7F6E\u81EA\u5B9A\u4E49\u7EB8\u5F20\u5927\u5C0F: ${s}mm x ${t}mm`),z.value=!1}catch(s){console.error("\u8BBE\u7F6E\u81EA\u5B9A\u4E49\u7EB8\u5F20\u5931\u8D25:",s),c.error("\u8BBE\u7F6E\u81EA\u5B9A\u4E49\u7EB8\u5F20\u5931\u8D25: "+(s.message||String(s)))}}function x(s){j.value=s,s==="custom"?(J.value={width:100,height:150},z.value=!0):b(s)}function Y(s){switch(s){case"export":le();break;case"import":oe();break;case"paste":me();break}}function oe(){const s=document.createElement("input");s.type="file",s.accept="application/json",s.style.display="none",document.body.appendChild(s),s.addEventListener("change",t=>{const F=t.target.files[0];if(!F){document.body.removeChild(s);return}const H=new FileReader;H.onload=L=>{try{const ue=JSON.parse(L.target.result);o(ue),c.success("\u6A21\u677F\u5BFC\u5165\u6210\u529F")}catch(ue){console.error("\u89E3\u6790JSON\u5931\u8D25:",ue),c.error("\u65E0\u6548\u7684\u6A21\u677F\u6587\u4EF6")}},H.onerror=()=>{c.error("\u8BFB\u53D6\u6587\u4EF6\u5931\u8D25")},H.readAsText(F),document.body.removeChild(s)}),s.click()}function me(){qe.prompt("\u8BF7\u7C98\u8D34\u6A21\u677FJSON\u6570\u636E","\u5BFC\u5165\u6A21\u677F",{confirmButtonText:"\u5BFC\u5165",cancelButtonText:"\u53D6\u6D88",inputType:"textarea",inputPlaceholder:"\u7C98\u8D34JSON\u6570\u636E..."}).then(({value:s})=>{try{if(!s){c.warning("\u672A\u63D0\u4F9BJSON\u6570\u636E");return}const t=JSON.parse(s);o(t),c.success("\u6A21\u677F\u5BFC\u5165\u6210\u529F")}catch(t){console.error("\u5BFC\u5165JSON\u5931\u8D25:",t),c.error("\u65E0\u6548\u7684JSON\u6570\u636E: "+(t.message||String(t)))}}).catch(()=>{})}function re(s){p.print(s)}function se(s,t){p.toPdf(s,t)}function le(){try{const s=d(),t=JSON.stringify(s,null,2),F=new Blob([t],{type:"application/json"}),H=URL.createObjectURL(F),L=document.createElement("a");L.href=H,L.download=`\u6253\u5370\u6A21\u677F_${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(L),L.click(),document.body.removeChild(L),URL.revokeObjectURL(H),c.success("\u6A21\u677F\u5BFC\u51FA\u6210\u529F")}catch(s){console.error("\u5BFC\u51FA\u6A21\u677F\u5931\u8D25:",s),c.error("\u5BFC\u51FA\u6A21\u677F\u5931\u8D25")}}function Oe(){try{const s=D.value.length>0?{fields:D.value}:{};re(s),c.success("\u6253\u5370\u9884\u89C8\u5DF2\u751F\u6210")}catch(s){console.error("\u6253\u5370\u9884\u89C8\u5931\u8D25:",s),c.error("\u6253\u5370\u9884\u89C8\u5931\u8D25")}}function Ne(s,t=!1){try{if(!s||Array.isArray(s)&&s.length===0){c.warning("\u6CA1\u6709\u53EF\u6253\u5370\u7684\u6570\u636E");return}if(t){const F=`\u6253\u5370\u6570\u636E_${new Date().toISOString().split("T")[0]}.pdf`;se(s,F),c.success("PDF\u5BFC\u51FA\u6210\u529F")}else re(s),c.success("\u6253\u5370\u9884\u89C8\u5DF2\u751F\u6210");console.log("\u6253\u5370\u6570\u636E\u7ED3\u6784:",JSON.stringify(s))}catch(F){console.error("\u6253\u5370\u5904\u7406\u5931\u8D25:",F),c.error("\u6253\u5370\u5904\u7406\u5931\u8D25: "+(F.message||String(F)))}}async function ye(){try{const s=p?p.getJson():{},t=JSON.parse(JSON.stringify(D.value||[])),F=JSON.parse(JSON.stringify(window.fieldTestData||{})),H=JSON.parse(JSON.stringify(g.value||[])),L={template:s,fields:t,testData:F,recordsData:H,timestamp:new Date().getTime()};console.log("\u51C6\u5907\u53D1\u9001\u5B8C\u6574\u6570\u636E\u5230\u72EC\u7ACB\u8BBE\u8BA1\u5668:",L);const ue=window.location.origin+window.location.pathname+"#/template-designer";try{const Z=await R.openWindowAndSendData(ue,L,{windowFeatures:"width=1200,height=800",timeout:8e3,onStatusChange:te=>{switch(te){case be.WAITING:console.log("\u7B49\u5F85\u5B50\u7A97\u53E3\u51C6\u5907\u5C31\u7EEA...");break;case be.CONNECTED:c.success("\u6A21\u677F\u8BBE\u8BA1\u5668\u5DF2\u6253\u5F00\uFF0C\u5B8C\u6574\u6570\u636E\u4F20\u8F93\u6210\u529F");break;case be.TIMEOUT:console.log("\u901A\u4FE1\u8D85\u65F6\uFF0C\u4F46\u6570\u636E\u53EF\u80FD\u5DF2\u53D1\u9001");break;case be.ERROR:console.log("\u901A\u4FE1\u51FA\u73B0\u9519\u8BEF");break}}});console.log("\u7A97\u53E3\u901A\u4FE1\u7ED3\u679C:",Z)}catch(Z){console.error("\u7A97\u53E3\u901A\u4FE1\u5931\u8D25:",Z),c.error(Z.message||"\u6253\u5F00\u6A21\u677F\u8BBE\u8BA1\u5668\u5931\u8D25")}}catch(s){console.error("\u6253\u5F00\u6A21\u677F\u8BBE\u8BA1\u5668\u5931\u8D25:",s),c.error("\u6253\u5F00\u6A21\u677F\u8BBE\u8BA1\u5668\u5931\u8D25: "+(s.message||String(s)))}}async function ze(){return new Promise(s=>{try{const t=localStorage.getItem("templateDesignerData");if(!t){console.log("\u6CA1\u6709\u627E\u5230\u4FDD\u5B58\u7684\u6A21\u677F\u6570\u636E"),s(!1);return}try{const F=JSON.parse(t);console.log("\u53D1\u73B0\u4FDD\u5B58\u7684\u6A21\u677F\u6570\u636E"),F&&F.template?(console.log("\u6B63\u5728\u5BFC\u5165\u6A21\u677F..."),o(F.template),localStorage.removeItem("templateDesignerData"),console.log("\u5DF2\u5220\u9664\u4FDD\u5B58\u7684\u6A21\u677F\u6570\u636E"),c.success("\u5DF2\u6210\u529F\u5BFC\u5165\u6A21\u677F\u8BBE\u8BA1\u5668\u4E2D\u4FDD\u5B58\u7684\u6A21\u677F"),s(!0)):(console.warn("\u4FDD\u5B58\u7684\u6A21\u677F\u6570\u636E\u4E0D\u5B8C\u6574"),s(!1))}catch(F){console.error("\u89E3\u6790\u4FDD\u5B58\u7684\u6A21\u677F\u6570\u636E\u5931\u8D25:",F),c.error("\u89E3\u6790\u4FDD\u5B58\u7684\u6A21\u677F\u6570\u636E\u5931\u8D25: "+(F.message||String(F))),s(!1)}}catch(t){console.error("\u68C0\u67E5\u4FDD\u5B58\u7684\u6A21\u677F\u5931\u8D25:",t),s(!1)}})}function Je(s){try{console.log("\u6536\u5230\u6A21\u677F\u8BBE\u8BA1\u9875\u9762\u53D1\u9001\u7684\u6A21\u677F\u6570\u636E"),s.template?(o(s.template),c.success("\u5DF2\u6210\u529F\u5BFC\u5165\u6A21\u677F\u8BBE\u8BA1\u5668\u4E2D\u4FDD\u5B58\u7684\u6A21\u677F")):(console.warn("\u6536\u5230\u7684\u6A21\u677F\u6570\u636E\u4E0D\u5B8C\u6574"),c.warning("\u6536\u5230\u7684\u6A21\u677F\u6570\u636E\u4E0D\u5B8C\u6574"))}catch(t){console.error("\u5904\u7406\u6A21\u677F\u8BBE\u8BA1\u9875\u9762\u6D88\u606F\u5931\u8D25:",t),c.error("\u5904\u7406\u6A21\u677F\u8BBE\u8BA1\u9875\u9762\u6D88\u606F\u5931\u8D25: "+(t.message||String(t)))}}async function r(){try{if(!h.value){c.warning("\u8BF7\u8F93\u5165\u6A21\u677F\u540D\u79F0");return}const s=p.getJson(),t=JSON.parse(JSON.stringify(s));await Te(h.value,t,h.value),c.success("\u6A21\u677F\u5DF2\u4FDD\u5B58\u5230\u672C\u5730\u6570\u636E\u5E93"),await l()}catch(s){console.error("\u4FDD\u5B58\u6A21\u677F\u5931\u8D25:",s),c.error("\u4FDD\u5B58\u6A21\u677F\u5931\u8D25: "+(s.message||String(s)))}}async function l(){try{const s=await Xe();k.value=s}catch(s){console.error("\u52A0\u8F7D\u6A21\u677F\u5217\u8868\u5931\u8D25:",s),c.error("\u52A0\u8F7D\u6A21\u677F\u5217\u8868\u5931\u8D25: "+(s.message||String(s)))}}function E(s){try{if(!s){c.warning("\u6A21\u677F\u6570\u636E\u4E3A\u7A7A");return}console.log("\u4ECE\u6A21\u677F\u7BA1\u7406\u5668\u52A0\u8F7D\u6A21\u677F\u6570\u636E:",s),B.value="design",cu(()=>{try{if(!document.getElementById("hiprint-printTemplate")){console.error("\u627E\u4E0D\u5230\u6A21\u677F\u5BB9\u5668\u5143\u7D20"),c.error("\u6A21\u677F\u5BB9\u5668\u672A\u51C6\u5907\u597D\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5");return}let F=s;typeof s=="string"&&(F=JSON.parse(s)),console.log("\u51C6\u5907\u5BFC\u5165\u7684\u539F\u59CB\u6A21\u677F\u6570\u636E:",F),o(F),setTimeout(()=>{K()},200),c.success("\u6A21\u677F\u5DF2\u6210\u529F\u52A0\u8F7D\u5230\u8BBE\u8BA1\u5668")}catch(t){console.error("\u5BFC\u5165\u6A21\u677F\u65F6\u53D1\u751F\u9519\u8BEF:",t),c.error("\u5BFC\u5165\u6A21\u677F\u5931\u8D25: "+(t.message||String(t)))}})}catch(t){console.error("\u52A0\u8F7D\u6A21\u677F\u5931\u8D25:",t),c.error("\u52A0\u8F7D\u6A21\u677F\u5931\u8D25: "+(t.message||String(t)))}}async function V(){try{const s=p.getJson();if(s&&Object.keys(s).length>0&&(s.printElements||[]).length>0){console.log("\u5DF2\u6709\u6A21\u677F\u6570\u636E\uFF0C\u4E0D\u9700\u8981\u52A0\u8F7D\u9ED8\u8BA4\u6A21\u677F");return}const F=await Xe();if(F&&F.length>0){const L=F[0];console.log(`\u4ECE\u6570\u636E\u5E93\u52A0\u8F7D\u6A21\u677F: ${L.id}`),o(L.data),S.value=L.id,h.value=L.description||L.id,c.success(`\u5DF2\u81EA\u52A8\u52A0\u8F7D\u6A21\u677F: ${L.id}`);return}console.log("\u6570\u636E\u5E93\u4E2D\u6CA1\u6709\u6A21\u677F\uFF0C\u4F7F\u7528\u9ED8\u8BA4\u7A7A\u767D\u6A21\u677F");const H={width:210,height:297,paperHeader:0,paperFooter:0,printElements:[]};p.clear(),p.setPaper("A4"),p.design("#hiprint-printTemplate",{grid:!0})}catch(s){console.error("\u52A0\u8F7D\u9ED8\u8BA4\u6A21\u677F\u5931\u8D25:",s)}}function O(){v.push("/help")}return(s,t)=>(C(),$("div",Ea,[u("div",Da,[u("div",Aa,[u("div",wa,[a(e(T),{class:"header-icon"},{default:n(()=>[a(e(fe))]),_:1}),t[6]||(t[6]=u("div",{class:"header-text"},[u("h1",null,"\u6253\u5370\u6A21\u677F\u8BBE\u8BA1\u7CFB\u7EDF"),u("p",{class:"header-subtitle"},"\u4E13\u4E1A\u7684\u6A21\u677F\u8BBE\u8BA1\u4E0E\u6570\u636E\u6253\u5370\u5DE5\u5177")],-1))]),u("div",Ca,[a(e(I),{onClick:O,type:"primary",size:"small",icon:e(Pu)},{default:n(()=>t[7]||(t[7]=[w(" \u4F7F\u7528\u5E2E\u52A9 ")])),_:1,__:[7]},8,["icon"])])])]),i.value?(C(),$("div",ha,[a(e(T),null,{default:n(()=>[a(e(Qe))]),_:1}),u("span",null,M(i.value),1)])):W("",!0),y.value?(C(),$("div",ya,[a(e(T),null,{default:n(()=>[a(e(eu))]),_:1}),u("span",null,M(y.value),1)])):W("",!0),e(m)?(C(),$("div",_a,t[8]||(t[8]=[u("div",{class:"loading-content"},[u("div",{class:"loading-spinner"}),u("div",{class:"loading-text"},"\u7CFB\u7EDF\u521D\u59CB\u5316\u4E2D..."),u("div",{class:"loading-subtitle"},"\u8BF7\u7A0D\u5019\uFF0C\u6B63\u5728\u52A0\u8F7D\u7EC4\u4EF6\u548C\u6570\u636E")],-1)]))):W("",!0),ru(u("div",ba,[u("div",Ta,[u("div",Sa,[(C(!0),$(Fe,null,pe(X.value,F=>(C(),$("button",{key:F.name,class:mu(["tab-button",{active:B.value===F.name}]),"data-tab":F.name,onClick:H=>B.value=F.name},[u("div",ka,[F.icon?(C(),ne(e(T),{key:0},{default:n(()=>[(C(),ne(Bu(F.icon)))]),_:2},1024)):(C(),$("span",Pa,M(F.emoji),1))]),u("span",null,M(F.label),1)],10,$a))),128))])]),u("div",Va,[B.value==="design"?(C(),$("div",Ia,[u("div",xa,[u("h3",null,[a(e(T),null,{default:n(()=>[a(e(ie))]),_:1}),t[9]||(t[9]=w(" \u6A21\u677F\u8BBE\u8BA1 "))]),t[10]||(t[10]=u("p",null,"\u62D6\u62FD\u5143\u7D20\u5230\u753B\u5E03\uFF0C\u8BBE\u8BA1\u60A8\u7684\u6253\u5370\u6A21\u677F",-1))]),u("div",Oa,[u("div",Na,[u("div",za,[a(e(T),null,{default:n(()=>[a(e(gu))]),_:1})]),t[12]||(t[12]=u("div",{class:"banner-text"},[u("h4",null,"\u{1F4A1} \u63A8\u8350\u4F7F\u7528\u72EC\u7ACB\u8BBE\u8BA1\u5668"),u("p",null,"\u4E3A\u4E86\u83B7\u5F97\u66F4\u597D\u7684\u8BBE\u8BA1\u4F53\u9A8C\uFF0C\u5EFA\u8BAE\u4F7F\u7528\u72EC\u7ACB\u8BBE\u8BA1\u5668\u8FDB\u884C\u6A21\u677F\u8BBE\u8BA1\uFF0C\u529F\u80FD\u66F4\u5B8C\u6574\uFF0C\u64CD\u4F5C\u66F4\u6D41\u7545\uFF01")],-1)),u("div",Ja,[a(e(I),{type:"primary",size:"small",onClick:ye,class:"recommend-button"},{default:n(()=>[a(e(T),null,{default:n(()=>[a(e(ie))]),_:1}),t[11]||(t[11]=w(" \u7ACB\u5373\u4F7F\u7528 "))]),_:1,__:[11]})])])]),u("div",ja,[u("div",La,[u("div",Ra,[u("div",Ma,[a(e(T),{class:"group-icon"},{default:n(()=>[a(e(ie))]),_:1}),t[13]||(t[13]=u("span",{class:"group-title"},"\u6A21\u677F\u7BA1\u7406",-1))]),u("div",Ua,[u("div",Ga,[t[14]||(t[14]=u("label",{class:"input-label"},"\u6A21\u677F\u540D\u79F0",-1)),a(e(ge),{modelValue:h.value,"onUpdate:modelValue":t[0]||(t[0]=F=>h.value=F),placeholder:"\u8F93\u5165\u6A21\u677F\u540D\u79F0",size:"small",class:"template-name-input"},null,8,["modelValue"])]),a(e(I),{type:"primary",size:"small",onClick:r,icon:e(Ce),class:"action-button save-button"},{default:n(()=>t[15]||(t[15]=[w(" \u4FDD\u5B58\u6A21\u677F ")])),_:1,__:[15]},8,["icon"])])]),t[25]||(t[25]=u("div",{class:"toolbar-divider"},null,-1)),u("div",Ha,[u("div",qa,[a(e(T),{class:"group-icon"},{default:n(()=>[a(e(Ee))]),_:1}),t[16]||(t[16]=u("span",{class:"group-title"},"\u6A21\u677F\u64CD\u4F5C",-1))]),u("div",Ka,[a(e(xu),{onCommand:Y,trigger:"click",class:"operation-dropdown"},{dropdown:n(()=>[a(e(Vu),{class:"custom-dropdown-menu"},{default:n(()=>[a(e(Le),{command:"export",icon:e(Ce)},{default:n(()=>t[18]||(t[18]=[u("span",{class:"dropdown-item-text"},"\u5BFC\u51FAJSON",-1)])),_:1,__:[18]},8,["icon"]),a(e(Le),{command:"import",icon:e(Ae)},{default:n(()=>t[19]||(t[19]=[u("span",{class:"dropdown-item-text"},"\u5BFC\u5165\u6A21\u677F",-1)])),_:1,__:[19]},8,["icon"]),a(e(Le),{command:"paste",icon:e(ie)},{default:n(()=>t[20]||(t[20]=[u("span",{class:"dropdown-item-text"},"\u7C98\u8D34\u5BFC\u5165",-1)])),_:1,__:[20]},8,["icon"])]),_:1})]),default:n(()=>[a(e(I),{type:"info",size:"small",icon:e(Ee),class:"action-button"},{default:n(()=>[t[17]||(t[17]=w(" \u6A21\u677F\u64CD\u4F5C ")),a(e(T),{class:"el-icon--right"},{default:n(()=>[a(e(Iu))]),_:1})]),_:1,__:[17]},8,["icon"])]),_:1}),u("div",Wa,[t[21]||(t[21]=u("label",{class:"input-label"},"\u7EB8\u5F20\u5927\u5C0F",-1)),a(e(ke),{modelValue:j.value,"onUpdate:modelValue":t[1]||(t[1]=F=>j.value=F),placeholder:"\u9009\u62E9\u7EB8\u5F20",size:"small",onChange:x,class:"paper-select"},{default:n(()=>[(C(!0),$(Fe,null,pe(_.value,F=>(C(),ne(e(Pe),{key:F.value,label:F.label,value:F.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])])]),t[26]||(t[26]=u("div",{class:"toolbar-divider"},null,-1)),u("div",Xa,[u("div",Ya,[a(e(T),{class:"group-icon"},{default:n(()=>[a(e(fe))]),_:1}),t[22]||(t[22]=u("span",{class:"group-title"},"\u9884\u89C8\u4E0E\u8BBE\u8BA1",-1))]),u("div",Za,[a(e(I),{type:"success",size:"small",onClick:ye,class:"action-button designer-button"},{default:n(()=>[a(e(T),null,{default:n(()=>[a(e(ie))]),_:1}),t[23]||(t[23]=w(" \u72EC\u7ACB\u8BBE\u8BA1\u5668 "))]),_:1,__:[23]}),a(e(I),{type:"warning",size:"small",onClick:Oe,class:"action-button preview-button"},{default:n(()=>[a(e(T),null,{default:n(()=>[a(e(fe))]),_:1}),t[24]||(t[24]=w(" \u6253\u5370\u9884\u89C8 "))]),_:1,__:[24]})])])])]),u("div",Qa,[u("div",es,[u("div",us,[a(e(T),null,{default:n(()=>[a(e(Ee))]),_:1}),t[27]||(t[27]=u("span",null,"\u5143\u7D20\u5E93",-1))]),t[28]||(t[28]=u("div",{id:"provider-container",class:"provider-container"},null,-1))]),t[31]||(t[31]=u("div",{class:"canvas-panel"},[u("div",{class:"canvas-header"},[u("span",null,"\u8BBE\u8BA1\u753B\u5E03")]),u("div",{id:"hiprint-printTemplate",class:"template-container"})],-1)),u("div",ts,[u("div",as,[a(e(T),null,{default:n(()=>[a(e(Ee))]),_:1}),t[29]||(t[29]=u("span",null,"\u5C5E\u6027\u8BBE\u7F6E",-1))]),t[30]||(t[30]=u("div",{id:"PrintElementOptionSetting",class:"setting-container"},null,-1))])])])):B.value==="print"?(C(),$("div",ss,[u("div",ns,[u("h3",null,[a(e(T),null,{default:n(()=>[a(e(fe))]),_:1}),t[32]||(t[32]=w(" \u6570\u636E\u6253\u5370 "))]),t[33]||(t[33]=u("p",null,"\u9009\u62E9\u6570\u636E\u5E76\u6267\u884C\u6253\u5370\u64CD\u4F5C",-1))]),a(Dt,{hiprintTemplate:e(p),initialFields:D.value,initialRecords:g.value,onPrint:Ne},null,8,["hiprintTemplate","initialFields","initialRecords"])])):B.value==="template-manager"?(C(),$("div",ls,[u("div",os,[u("h3",null,[a(e(T),null,{default:n(()=>[a(e(He))]),_:1}),t[34]||(t[34]=w(" \u6A21\u677F\u7BA1\u7406 "))]),t[35]||(t[35]=u("p",null,"\u7BA1\u7406\u60A8\u7684\u6253\u5370\u6A21\u677F",-1))]),a(Ba,{hiprintTemplate:e(p),onLoadTemplate:E},null,8,["hiprintTemplate"])])):B.value==="field-info"?(C(),$("div",rs,[u("div",is,[u("h3",null,[a(e(T),null,{default:n(()=>[a(e(Ge))]),_:1}),t[36]||(t[36]=w(" \u5B57\u6BB5\u4FE1\u606F "))]),t[37]||(t[37]=u("p",null,"\u67E5\u770B\u5F53\u524D\u8868\u683C\u7684\u5B57\u6BB5\u4FE1\u606F",-1))]),a(Rt)])):W("",!0)])],512),[[iu,!e(m)]]),ru(u("div",cs,null,512),[[iu,!e(m)&&B.value==="design"]]),a(e(uu),{modelValue:z.value,"onUpdate:modelValue":t[5]||(t[5]=F=>z.value=F),title:"\u81EA\u5B9A\u4E49\u7EB8\u5F20\u5927\u5C0F",width:"400px","close-on-click-modal":!1,"show-close":!0},{footer:n(()=>[u("span",ds,[a(e(I),{onClick:t[4]||(t[4]=F=>z.value=!1)},{default:n(()=>t[38]||(t[38]=[w("\u53D6\u6D88")])),_:1,__:[38]}),a(e(I),{type:"primary",onClick:P},{default:n(()=>t[39]||(t[39]=[w("\u786E\u8BA4")])),_:1,__:[39]})])]),default:n(()=>[a(e(Du),{model:J.value,"label-width":"100px"},{default:n(()=>[a(e(Ve),{label:"\u5BBD\u5EA6 (mm)"},{default:n(()=>[a(e(ge),{modelValue:J.value.width,"onUpdate:modelValue":t[2]||(t[2]=F=>J.value.width=F),type:"number",min:"1",placeholder:"\u8BF7\u8F93\u5165\u7EB8\u5F20\u5BBD\u5EA6"},null,8,["modelValue"])]),_:1}),a(e(Ve),{label:"\u9AD8\u5EA6 (mm)"},{default:n(()=>[a(e(ge),{modelValue:J.value.height,"onUpdate:modelValue":t[3]||(t[3]=F=>J.value.height=F),type:"number",min:"1",placeholder:"\u8BF7\u8F93\u5165\u7EB8\u5F20\u9AD8\u5EA6"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])]))}}),vs=xe(Fs,[["__scopeId","data-v-459fda3a"]]);export{vs as default};
